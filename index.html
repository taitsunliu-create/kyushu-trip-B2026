<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¹å·è¦ªå­è‡ªé§•éŠ 2026</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563EB">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563EB;      /* ä¸»è‰²è— */
            --secondary: #F59E0B;    /* è¼”è‰²é»ƒ */
            --bg: #F3F4F6;           /* èƒŒæ™¯ç° */
            --white: #FFFFFF;
            --text-main: #1F2937;
            --text-sub: #6B7280;
            --danger: #EF4444;
            --food-choice: #8B5CF6;  /* ç´«è‰²ç”¨æ–¼é¤é£Ÿé¸æ“‡ */
            --tag-food-bg: #EDE9FE;
            --tag-toyota: #E0E7FF;   /* æ·ºè—ç´« for Toyota */
            --info-bg: #E0F2F1;      /* è³‡è¨Šé èƒŒæ™¯è‰² */
            --info-text: #0D9488;    /* è³‡è¨Šé æ–‡å­—è‰² */
            --kumamoto-info-bg: #F0F9FF; /* ç†Šæœ¬è³‡è¨ŠèƒŒæ™¯ */
            --kumamoto-info-text: #0E7490; /* ç†Šæœ¬è³‡è¨Šæ–‡å­— */
            --beppu-info: #14B8A6;   /* åˆ¥åºœåœ°ç„å°ˆç”¨è‰² */
            --beppu-bg: #E0F2F1;
            
            /* Safe Area Variables */
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            padding-bottom: calc(80px + var(--safe-area-bottom)); /* åº•éƒ¨å°èˆªç©ºé–“ + å®‰å…¨å€åŸŸ */
        }

        /* Header - Modified for Side-by-Side Layout */
        header {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: var(--white);
            padding: 15px 20px;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
            position: relative;
            z-index: 10;
        }
        
        .header-content {
            display: flex;
            flex-direction: row; 
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap; 
        }

        .header-title-area {
            flex: 1;
            min-width: 200px;
        }

        .header-title-area h1 { margin: 0; font-size: 1.6rem; font-weight: 700; white-space: nowrap; }
        .header-title-area .subtitle { font-size: 0.9rem; opacity: 0.9; margin-top: 5px; }
        .header-title-area .badge-trip { 
            background: rgba(255,255,255,0.2); 
            padding: 4px 10px; 
            border-radius: 20px; 
            font-size: 0.8rem; 

            display: inline-flex;
            align-items: center;
             gap: 6px; 
    
            margin-top: 8px;
        }   
     /* [ä¿®æ”¹] SOS æµ®å‹•åˆ†äº«æŒ‰éˆ• (å±¤ç´šåŠ å¼·ç‰ˆ) */
     /* [æ–°å¢] è¡Œå‰æª¢æŸ¥æ¸…å–®æ¨£å¼ */
        /* [ä¿®æ”¹] è¡Œå‰æª¢æŸ¥æ¸…å–®æ¨£å¼ (åŠ å…¥æŠ˜ç–ŠåŠŸèƒ½) */
        /* [ä¿®æ”¹] è¡Œå‰æª¢æŸ¥æ¸…å–®æ¨£å¼ (å«æ²å‹•èˆ‡æ–°å¢åˆªé™¤åŠŸèƒ½) */
        .checklist-card-header {
            border-bottom: 1px dashed #E5E7EB; 
            padding-bottom: 10px; 
            margin-bottom: 0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .checklist-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.2s ease-out;
            opacity: 0;
        }
        
        .checklist-container.show {
            /* è¨­å®šé«˜åº¦ç´„ç‚º 5 è¡Œçš„é«˜åº¦ (æ¯è¡Œç´„ 50px)ï¼Œè¶…éå‡ºç¾æ²è»¸ */
            max-height: 280px; 
            opacity: 1;
            margin-top: 15px;
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; 
        }

        .checklist-grid { 
            display: flex; 
            flex-direction: column; /* æ”¹ç‚ºå‚ç›´æ’åˆ— */
            gap: 8px; 
            padding-bottom: 5px;
        }

        .check-item {
            display: flex; 
            align-items: center; 
            justify-content: space-between; /* è®“åˆªé™¤æŒ‰éˆ•é å³ */
            gap: 8px;
            background: #F9FAFB; padding: 10px 12px; border-radius: 8px;
            font-size: 0.9rem; transition: all 0.2s;
            border: 1px solid #E5E7EB; user-select: none;
        }
        
        .check-item:has(input:checked) {
            background: #ECFDF5; border-color: #10B981; color: #065F46; font-weight: 600;
        }
        .check-item input { accent-color: #10B981; width: 18px; height: 18px; cursor: pointer; }
        
        /* åˆªé™¤æŒ‰éˆ•æ¨£å¼ */
        .btn-del-item {
            color: #EF4444; background: none; border: none; font-size: 1.2rem;
            line-height: 1; cursor: pointer; padding: 0 8px; opacity: 0.6;
        }
        .btn-del-item:hover { opacity: 1; transform: scale(1.1); }

        /* æ–°å¢é …ç›®è¼¸å…¥æ¡†å€åŸŸ */
        .add-item-box {
            display: flex; gap: 8px; margin-bottom: 10px; padding: 5px;
            position: sticky; top: 0; background: var(--bg); z-index: 5; /* èƒŒæ™¯è‰²èˆ‡bodyä¸€è‡´é¿å…é€æ˜ */
            border-bottom: 1px solid #eee;
        }
        .input-add-item {
            flex: 1; padding: 10px; border: 1px solid #D1D5DB; border-radius: 6px; outline: none; font-size: 0.9rem;
        }
        .btn-add-item {
            background: var(--secondary); color: white; border: none; 
            padding: 0 16px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1.2rem;
        }
        /* [æ–°å¢] éš¨èº«ç­†è¨˜æµ®å‹•æŒ‰éˆ• (ä½æ–¼åˆ†äº«æŒ‰éˆ•ä¸Šæ–¹) */
        /* [ä¿®æ”¹] éš¨èº«ç­†è¨˜æµ®å‹•æŒ‰éˆ• (è—è‰²) - ç¸®å°èˆ‡é€æ˜åŒ– */
        .float-note-btn {
            position: fixed;
            bottom: 155px; /* [èª¿æ•´] å› ç‚ºæŒ‰éˆ•è®Šå°äº†ï¼Œé«˜åº¦ç¨å¾®é™ä½é è¿‘ä¸‹æ–¹ */
            left: 20px;
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            padding: 16px;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
            z-index: 9999;
            cursor: pointer;
            transition: all 0.2s; /* æ”¹ç‚º all ä»¥æ”¯æ´ opacity è®ŠåŒ– */
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-user-select: none;
            user-select: none;
            
            /* [æ–°å¢] ç¸®å°èˆ‡é€æ˜åº¦è¨­å®š */
            transform: scale(0.7);   /* ç¸®å°è‡³ 70% */
            opacity: 0.6;            /* é€æ˜åº¦ 60% */
            transform-origin: center center; /* ä»¥ä¸­å¿ƒé»ç¸®æ”¾ */
        }
        
        /* è®“ä½¿ç”¨è€…é»æ“Š(æŒ‰ä½)æ™‚ï¼Œç¨å¾®è®Šå›ä¸é€æ˜ï¼Œå¢åŠ å›é¥‹æ„Ÿ */
        .float-note-btn:active { 
            transform: scale(0.65); /* æŒ‰ä¸‹æ™‚ç¨å¾®æ›´å°ä¸€é»é» */
            opacity: 1;             /* æŒ‰ä¸‹æ™‚è®Šæ¸…æ¥š */
        }

        /* [ä¿®æ”¹] åŒ¯ç‡è¨ˆç®—æ©Ÿæµ®å‹•æŒ‰éˆ• (æ©˜è‰²) - ç¸®å°èˆ‡é€æ˜åŒ– */
        .float-calc-btn {
            position: fixed;
            bottom: 205px; /* [èª¿æ•´] é…åˆè—è‰²æŒ‰éˆ•çš„é«˜åº¦èª¿æ•´ */
            left: 20px;
            
            background: rgba(245, 158, 11, 0.65); 
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            padding: 16px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            z-index: 9999;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-user-select: none;
            user-select: none;

            /* [æ–°å¢] ç¸®å°èˆ‡é€æ˜åº¦è¨­å®š */
            transform: scale(0.7);   /* ç¸®å°è‡³ 70% */
            opacity: 0.6;            /* é€æ˜åº¦ 60% (æœƒç–ŠåŠ èƒŒæ™¯æœ¬èº«çš„é€æ˜åº¦) */
            transform-origin: center center;
        }

        /* é»æ“Šæ™‚çš„å›é¥‹ */
        .float-calc-btn:active { 
            transform: scale(0.65); 
            opacity: 1;
            background: rgba(245, 158, 11, 0.85); 
        }
        
        .float-note-btn svg, .float-calc-btn svg { width: 20px; height: 20px; stroke-width: 2.5; }
        .float-calc-btn:active { 
            transform: scale(0.95); 
            background: rgba(245, 158, 11, 0.85); /* æŒ‰ä¸‹æ™‚è®Šå¯¦å¿ƒä¸€é» */
        }
        .float-calc-btn svg { width: 20px; height: 20px; stroke-width: 2.5; }

        /* è¨ˆç®—æ©Ÿè¦–çª—æ¨£å¼ */
        .calc-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .calc-input { width: 60%; padding: 10px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1.2rem; text-align: right; outline: none; }
        .calc-input:focus { border-color: #F59E0B; }
        .calc-label { font-weight: 600; color: #4B5563; }

/* --- æ’å…¥çµæŸ --- */

        .float-note-btn:active { transform: scale(0.95); }
        .float-note-btn svg { width: 20px; height: 20px; stroke-width: 2.5; }
        .float-share-btn {
            position: fixed;
            bottom: 90px; /* ä½æ–¼åº•éƒ¨å°èˆªæ¬„ä¸Šæ–¹ */
            left: 20px;
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
            border: 2px solid white; /* æ–°å¢ï¼šç™½è‰²é‚Šæ¡†ï¼Œå¢åŠ è¾¨è­˜åº¦ */
            border-radius: 50px;
            padding: 16px;
            font-size: 0.9rem;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.5); /* é™°å½±åŠ æ·± */
            display: flex;
            align-items: center;
            gap: 8px;
            
            
            z-index: 9999; /* è¨­åˆ°æœ€é«˜ï¼Œç¢ºä¿æµ®åœ¨æ‰€æœ‰å…§å®¹ä¹‹ä¸Š */
            
            cursor: pointer;
            transition: transform 0.2s;
            -webkit-user-select: none;
            user-select: none;
        }
        .float-share-btn:active { transform: scale(0.95); }
        .float-share-btn svg { width: 20px; height: 20px; stroke-width: 2.5; }
        
.header-title-area .badge-trip::before {
    content: '';
    display: block;
    width: 16px;
    height: 16px;
    background-color: currentColor; /* è‡ªå‹•è®Šæˆç™½è‰² */
    
    /* è¦ªå­/ç¾¤çµ„ SVG åœ–ç¤º (Users Icon) */
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2'%3E%3C/path%3E%3Ccircle cx='9' cy='7' r='4'%3E%3C/circle%3E%3Cpath d='M23 21v-2a4 4 0 0 0-3-3.87'%3E%3C/path%3E%3Cpath d='M16 3.13a4 4 0 0 1 0 7.75'%3E%3C/path%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2'%3E%3C/path%3E%3Ccircle cx='9' cy='7' r='4'%3E%3C/circle%3E%3Cpath d='M23 21v-2a4 4 0 0 0-3-3.87'%3E%3C/path%3E%3Cpath d='M16 3.13a4 4 0 0 1 0 7.75'%3E%3C/path%3E%3C/svg%3E");
    
    -webkit-mask-size: contain;
    mask-size: contain;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
}
        /* New Header Weather Box - Side Layout */
        .header-weather-box {
            flex: 0 0 auto; 
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 50px; /* Pill shape */
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 70px;
        }

        /* Weather Columns */
        /* [æ–°å¢] Header æˆ‘çš„ä½ç½®å€å¡Šæ¨£å¼ */
        .hw-col-my-loc {
            padding-right: 10px;
            margin-right: 5px;
            border-right: 1px solid rgba(255,255,255,0.3);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 60px;
            text-align: left;
        }

        .hw-sub-label {
            font-size: 0.65rem;
            opacity: 0.8;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .hw-my-data {
            font-size: 0.9rem;
            font-weight: 700;
            white-space: nowrap;
            display: flex;
            gap: 4px;
            align-items: center;
        }

        /* æ‰‹æ©Ÿç‰ˆå¾®èª¿ */
        @media (max-width: 600px) {
            .hw-col-my-loc {
                padding-right: 8px;
                margin-right: 0;
                border-right: 1px solid rgba(255,255,255,0.2); 
                
                /* [æ–°å¢] ä¸‹é¢é€™å…©è¡Œæ˜¯è§£æ±ºæ“ å£“çš„é—œéµ */
                min-width: auto;  /* [ä¿®æ­£] æ”¹ç‚º autoï¼Œè®“å¯¬åº¦éš¨å…§å®¹èª¿æ•´ */
                flex-shrink: 0;   /* [æ–°å¢] é˜²æ­¢å…§å®¹è¢«æ“ æ‰ */
                white-space: nowrap; /* ç¦æ­¢æ–‡å­—æ›è¡Œ */
            }
        }
        
        .hw-loc { font-size: 1.1rem; font-weight: 700; display: block; line-height: 1.2; }
        .hw-date { font-size: 0.75rem; opacity: 0.9; display: block; margin-top: 4px; }

        .hw-col-main {
            padding: 0 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hw-icon svg { width: 36px; height: 36px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1)); }
        
        .hw-temp-group { text-align: center; }
        .hw-temp { font-size: 1.4rem; font-weight: 700; line-height: 1; }
        .hw-desc { font-size: 0.8rem; font-weight: 500; display: block; margin-top: 2px; }
        .hw-range { font-size: 0.7rem; opacity: 0.9; display: block; margin-top: 2px; font-family: monospace; }

        .hw-col-advice {
            padding-left: 15px;
            border-left: 1px solid rgba(255,255,255,0.3);
            max-width: 140px;
            font-size: 0.75rem;
            line-height: 1.3;
            opacity: 0.95;
            display: flex;
            align-items: center;
            min-height: 50px; /* Ensure height for border */
        }

        /* Container & Tabs */
        .container { display: none; padding: 20px; animation: fadeIn 0.3s ease; max-width: 800px; margin: 0 auto; }
        .container.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        .card-title { font-weight: 700; color: var(--primary); font-size: 1.05rem; }

        /* Day specific styles */
        .day-wrapper {
            background: var(--white);
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: box-shadow 0.2s;
        }

        .day-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            border-radius: 12px;
            border-left: 5px solid transparent; 
            transition: background-color 0.2s, border-left-color 0.3s;
        }
        
        .day-toggle:active { background-color: #F8F9FB; }
        .day-toggle.open { border-left-color: var(--primary); }

        .day-info h3 { margin: 0; font-size: 1.1rem; color: var(--text-main); }
        .day-info span { font-size: 0.85rem; color: var(--text-sub); }
        
        .toggle-icon { transition: transform 0.3s; font-size: 0.8rem; color: var(--text-sub); font-weight: 700; }
        .day-toggle.open .toggle-icon { transform: rotate(180deg); color: var(--primary); }

        .timeline { display: none; padding: 15px 15px 5px 30px; border-top: 1px solid #F3F4F6; }
        .timeline.show { display: block; }

        .event { position: relative; padding-left: 20px; margin-bottom: 24px; }
        .event:last-child { margin-bottom: 0; }
        .event::before {
            content: ''; position: absolute; left: -7px; top: 6px;
            width: 12px; height: 12px; border-radius: 50%;
            background: var(--white); border: 3px solid var(--secondary);
            z-index: 1;
        }
        
        /* Event Styles */
        .event-meal .activity { color: var(--food-choice); }
        .event-meal .desc { border-left: 2px solid var(--food-choice); padding-left: 8px; margin-top: 5px; }
        .time { font-size: 0.85rem; color: var(--text-sub); font-weight: 600; font-family: monospace; }
        .activity { font-size: 1rem; font-weight: 700; margin: 4px 0; color: var(--text-main); }
        .desc { font-size: 0.9rem; color: #555; line-height: 1.5; margin-bottom: 8px; }

        /* Tags */
        .tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .tag { font-size: 0.75rem; padding: 2px 8px; border-radius: 6px; font-weight: 500; }
        .tag-food { background: var(--tag-food-bg); color: var(--food-choice); }
        .tag-move { background: #DBEAFE; color: #1E40AF; }
        .tag-stay { background: #D1FAE5; color: #059669; }
        .tag-spot { background: #FCE7F3; color: #BE185D; }
        .tag-kids { background: #E0F2FE; color: #0284C7; border: 1px solid #BAE6FD; }
        .tag-car { background: var(--tag-toyota); color: #4338CA; }
        .tag-relax { background: #FFFBEB; color: #D97706; border: 1px solid #FCD34D; }
        .tag-shrine { background: #FEE2E2; color: #B91C1C; border: 1px solid #FCA5A5; }
        .tag-flight { background: #BFDBFE; color: #1D4ED8; }
        .tag-tip { background: var(--info-bg); color: var(--info-text); }
        .tag-shop { background: var(--kumamoto-info-bg); color: var(--kumamoto-info-text); }
        .tag-beppu { background: var(--beppu-bg); color: var(--beppu-info); }
        .tag-snow { background: #E0F2FE; color: #0369A1; border: 1px solid #BAE6FD; }

        /* Buttons */
        .btn-map { display: inline-flex; align-items: center; text-decoration: none; color: var(--primary); font-size: 0.85rem; font-weight: 600; margin-top: 4px; padding: 4px 0; }
        .btn-map::before { 
    content: ''; 
    display: inline-block;
    width: 16px; 
    height: 16px; 
    margin-right: 4px;
    
    /* é€™è£¡è¨­å®šåœ–ç¤ºé¡è‰²è·Ÿéš¨æ–‡å­—é¡è‰² (å³æ‚¨çš„ä¸»è‰²è—) */
    background-color: currentColor; 
    
    /* ä½¿ç”¨ SVG ä½œç‚ºé®ç½©å½¢ç‹€ */
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'%3E%3C/path%3E%3Ccircle cx='12' cy='10' r='3'%3E%3C/circle%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'%3E%3C/path%3E%3Ccircle cx='12' cy='10' r='3'%3E%3C/circle%3E%3C/svg%3E");
    
    -webkit-mask-size: contain;
    mask-size: contain;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    
    /* å¾®èª¿å‚ç›´ä½ç½®ï¼Œè®“åœ–ç¤ºèˆ‡æ–‡å­—å°é½Š */
    vertical-align: text-bottom;
}
        .btn-link { background: var(--primary); color: white; text-decoration: none; padding: 10px 16px; border-radius: 8px; font-size: 0.9rem; display: block; text-align: center; margin-top: 10px; }
        .btn-link-sub { background: #EBF5FF; color: var(--primary); text-decoration: none; padding: 8px 12px; border-radius: 6px; font-size: 0.85rem; display: block; text-align: center; margin-top: 8px; border: 1px solid var(--primary); }
        .btn-link-tel { background: #D1FAE5; color: #059669; text-decoration: none; padding: 8px 12px; border-radius: 6px; font-size: 0.85rem; display: block; text-align: center; margin-top: 8px; border: 1px solid #059669; }
        .btn-link-tel::before { content: 'ğŸ“'; margin-right: 4px; }

        /* Info Grid */
        .info-grid { display: grid; grid-template-columns: 100px 1fr; gap: 10px; font-size: 0.9rem; margin-bottom: 8px; }
        .info-label { color: var(--text-sub); }
        .info-val { font-weight: 500; }
        .info-detail-box { border: 1px solid #D1D5DB; padding: 12px; border-radius: 8px; margin-top: 10px; }
        .info-detail-box h4 { margin: 0 0 8px 0; font-size: 1rem; color: var(--primary); }

        /* Info Sections */
        .info-section { background-color: var(--info-bg); padding: 15px; border-radius: 12px; margin-bottom: 16px; border: 1px solid #5EEAD4; }
        .info-section.kumamoto { background-color: var(--kumamoto-info-bg); border-color: #90CDF4; }
        .info-section.kumamoto h3 { color: var(--kumamoto-info-text); border-bottom: 2px solid #90CDF4; }
        .info-section.winter-drive { background-color: #FEF2F2; border-color: #FCA5A5; color: #B91C1C; }
        .info-section.winter-drive h3 { color: #B91C1C; border-bottom: 2px solid #FCA5A5; }
        .info-section h3 { color: var(--info-text); font-size: 1.2rem; margin-top: 0; border-bottom: 2px solid #5EEAD4; padding-bottom: 5px; margin-bottom: 15px; }

        /* Price table */
        .price-table { display: grid; grid-template-columns: 1fr 80px 80px; gap: 8px; font-size: 0.9rem; margin-top: 10px; }
        .price-header { font-weight: 700; color: var(--primary); padding-bottom: 4px; border-bottom: 1px solid var(--primary); }
        .price-item { padding: 4px 0; border-bottom: 1px dashed #DDD; }
        .price-item:last-child { border-bottom: none; }
        .price-item .detail { font-size: 0.8rem; color: var(--text-sub); }

        .safari-method { margin-top: 15px; padding: 10px; border-radius: 8px; border: 1px dashed var(--info-text); }
        .method-title { font-weight: 700; color: var(--primary); display: block; margin-bottom: 5px; font-size: 1rem; }
        .method-title.recommended { color: var(--danger); }
        .method-detail { font-size: 0.9rem; line-height: 1.5; color: #444; }

        /* Step List */
        .step-list { counter-reset: step-counter; padding-left: 0; list-style: none; margin-top: 10px; }
        .step-list li { position: relative; padding-left: 30px; margin-bottom: 10px; font-size: 0.9rem; line-height: 1.5; }
        .step-list li::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute; left: 0; top: 0;
            width: 20px; height: 20px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 0.75rem;
            line-height: 20px;
        }

        /* Bottom Nav - Optimized for Safe Area */
        .nav-bar { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            background: rgba(255,255,255,0.95); 
            backdrop-filter: blur(10px); 
            border-top: 1px solid #eee; 
            display: flex; 
            justify-content: space-around; 
            padding: 8px 0 calc(8px + var(--safe-area-bottom)); 
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05); 
            z-index: 100; 
        }
        .nav-item { 
            text-align: center; 
            color: #9CA3AF; 
            font-size: 0.7rem; 
            cursor: pointer; 
            transition: color 0.2s; 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            padding: 4px; /* Touch target */
        }
        .nav-item.active { color: var(--primary); }
        
        .nav-icon { 
            display: block; 
            margin-bottom: 4px; 
            height: 22px; 
            width: 22px;
        }
        .nav-icon svg {
            width: 100%;
            height: 100%;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .alert-box { background: #FEF2F2; border: 1px solid #FECACA; color: #991B1B; padding: 10px; border-radius: 8px; font-size: 0.85rem; margin-top: 8px; display: flex; gap: 8px; align-items: start; margin-bottom: 15px; }
        /* é€šç”¨ Alert åœ–ç¤ºè¨­å®š */
.alert-icon {
    width: 20px;
    height: 20px;
    background-color: currentColor; /* è‡ªå‹•æŠ“å–æç¤ºæ¡†çš„æ–‡å­—é¡è‰² (ç¶ /è—) */
    flex-shrink: 0; /* é˜²æ­¢åœ–ç¤ºè¢«æ–‡å­—æ“ å£“è®Šå½¢ */
    margin-top: 1px; /* å¾®èª¿å‚ç›´å°é½Š */
    
    -webkit-mask-size: contain;
    mask-size: contain;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
    mask-position: center;
}
/* --- Header å¤©æ°£åœ–ç¤ºå„ªåŒ– (CSS Mask) --- */
.weather-icon {
    width: 36px;
    height: 36px;
    background-color: white; /* è·Ÿéš¨ Header æ–‡å­—é¡è‰² (ç™½) */
    
    -webkit-mask-size: contain;
    mask-size: contain;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
    mask-position: center;
    
    /* å¢åŠ ä¸€é»é™°å½±è®“ç™½è‰²åœ–ç¤ºæ›´æ¸…æ¥š */
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
}

/* å„ç¨®å¤©æ°£å°æ‡‰çš„ SVG å½¢ç‹€ */
.weather-icon.sun {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='5'%3E%3C/circle%3E%3Cline x1='12' y1='1' x2='12' y2='3'%3E%3C/line%3E%3Cline x1='12' y1='21' x2='12' y2='23'%3E%3C/line%3E%3Cline x1='4.22' y1='4.22' x2='5.64' y2='5.64'%3E%3C/line%3E%3Cline x1='18.36' y1='18.36' x2='19.78' y2='19.78'%3E%3C/line%3E%3Cline x1='1' y1='12' x2='3' y2='12'%3E%3C/line%3E%3Cline x1='21' y1='12' x2='23' y2='12'%3E%3C/line%3E%3Cline x1='4.22' y1='19.78' x2='5.64' y2='18.36'%3E%3C/line%3E%3Cline x1='18.36' y1='5.64' x2='19.78' y2='4.22'%3E%3C/line%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='5'%3E%3C/circle%3E%3Cline x1='12' y1='1' x2='12' y2='3'%3E%3C/line%3E%3Cline x1='12' y1='21' x2='12' y2='23'%3E%3C/line%3E%3Cline x1='4.22' y1='4.22' x2='5.64' y2='5.64'%3E%3C/line%3E%3Cline x1='18.36' y1='18.36' x2='19.78' y2='19.78'%3E%3C/line%3E%3Cline x1='1' y1='12' x2='3' y2='12'%3E%3C/line%3E%3Cline x1='21' y1='12' x2='23' y2='12'%3E%3C/line%3E%3Cline x1='4.22' y1='19.78' x2='5.64' y2='18.36'%3E%3C/line%3E%3Cline x1='18.36' y1='5.64' x2='19.78' y2='4.22'%3E%3C/line%3E%3C/svg%3E");
}

.weather-icon.cloud {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z'%3E%3C/path%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z'%3E%3C/path%3E%3C/svg%3E");
}

.weather-icon.cloud-sun {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v2'%3E%3C/path%3E%3Cpath d='m4.93 4.93 1.41 1.41'%3E%3C/path%3E%3Cpath d='M20 12h2'%3E%3C/path%3E%3Cpath d='m19.07 4.93-1.41 1.41'%3E%3C/path%3E%3Cpath d='M15.947 12.65a4 4 0 0 0-5.925-4.128'%3E%3C/path%3E%3Cpath d='M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z'%3E%3C/path%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v2'%3E%3C/path%3E%3Cpath d='m4.93 4.93 1.41 1.41'%3E%3C/path%3E%3Cpath d='M20 12h2'%3E%3C/path%3E%3Cpath d='m19.07 4.93-1.41 1.41'%3E%3C/path%3E%3Cpath d='M15.947 12.65a4 4 0 0 0-5.925-4.128'%3E%3C/path%3E%3Cpath d='M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z'%3E%3C/path%3E%3C/svg%3E");
}

.weather-icon.snow {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M4.5 10H4a7 7 0 1 1 7-7v.5'%3E%3C/path%3E%3Cpath d='M10 14a6 6 0 0 0-6-6'%3E%3C/path%3E%3Cline x1='12' y1='16' x2='12' y2='22'%3E%3C/line%3E%3Cline x1='12' y1='22' x2='9' y2='19'%3E%3C/line%3E%3Cline x1='12' y1='22' x2='15' y2='19'%3E%3C/line%3E%3Cline x1='18.5' y1='12' x2='22' y2='12'%3E%3C/line%3E%3Cline x1='22' y1='12' x2='19.5' y2='9.5'%3E%3C/line%3E%3Cline x1='22' y1='12' x2='19.5' y2='14.5'%3E%3C/line%3E%3Cline x1='5' y1='18.5' x2='2' y2='18.5'%3E%3C/line%3E%3Cline x1='2' y1='18.5' x2='4.5' y2='21'%3E%3C/line%3E%3Cline x1='2' y1='18.5' x2='4.5' y2='16'%3E%3C/line%3E%3Cline x1='17.5' y1='18.5' x2='20.5' y2='21'%3E%3C/line%3E%3Cline x1='17.5' y1='18.5' x2='20.5' y2='16'%3E%3C/line%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M4.5 10H4a7 7 0 1 1 7-7v.5'%3E%3C/path%3E%3Cpath d='M10 14a6 6 0 0 0-6-6'%3E%3C/path%3E%3Cline x1='12' y1='16' x2='12' y2='22'%3E%3C/line%3E%3Cline x1='12' y1='22' x2='9' y2='19'%3E%3C/line%3E%3Cline x1='12' y1='22' x2='15' y2='19'%3E%3C/line%3E%3Cline x1='18.5' y1='12' x2='22' y2='12'%3E%3C/line%3E%3Cline x1='22' y1='12' x2='19.5' y2='9.5'%3E%3C/line%3E%3Cline x1='22' y1='12' x2='19.5' y2='14.5'%3E%3C/line%3E%3Cline x1='5' y1='18.5' x2='2' y2='18.5'%3E%3C/line%3E%3Cline x1='2' y1='18.5' x2='4.5' y2='21'%3E%3C/line%3E%3Cline x1='2' y1='18.5' x2='4.5' y2='16'%3E%3C/line%3E%3Cline x1='17.5' y1='18.5' x2='20.5' y2='21'%3E%3C/line%3E%3Cline x1='17.5' y1='18.5' x2='20.5' y2='16'%3E%3C/line%3E%3C/svg%3E");
}

.weather-icon.rain {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M16 13v8'%3E%3C/path%3E%3Cpath d='M8 13v8'%3E%3C/path%3E%3Cpath d='M12 15v8'%3E%3C/path%3E%3Cpath d='M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25'%3E%3C/path%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M16 13v8'%3E%3C/path%3E%3Cpath d='M8 13v8'%3E%3C/path%3E%3Cpath d='M12 15v8'%3E%3C/path%3E%3Cpath d='M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25'%3E%3C/path%3E%3C/svg%3E");
}

/* 2. éœ§ (Fog) - é é˜²ä¹‹å¾Œé‡åˆ°éœ§å¤©ä¹Ÿè®Šæ–¹å¡Š */
.weather-icon.fog {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M5 6h14M4 10h16M6 14h12M4 18h16'%3E%3C/path%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M5 6h14M4 10h16M6 14h12M4 18h16'%3E%3C/path%3E%3C/svg%3E");
}

/* 3. é›·é›¨ (Lightning) - é é˜²é‡åˆ°é›·é›¨è®Šæ–¹å¡Š */
.weather-icon.lightning {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9'%3E%3C/path%3E%3Cpolyline points='13 11 9 17 15 17 11 23'%3E%3C/polyline%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9'%3E%3C/path%3E%3Cpolyline points='13 11 9 17 15 17 11 23'%3E%3C/polyline%3E%3C/svg%3E");
}
/* Day 2: è¨ˆæ™‚å™¨/ç¢¼è¡¨åœ–ç¤º (Timer) */
.alert-icon.time {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='13' r='8'%3E%3C/circle%3E%3Cpath d='M12 9v4l2 2'%3E%3C/path%3E%3Cpath d='M5 3 2 6'%3E%3C/path%3E%3Cpath d='m22 6-3-3'%3E%3C/path%3E%3Cpath d='M12 2v4'%3E%3C/path%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='13' r='8'%3E%3C/circle%3E%3Cpath d='M12 9v4l2 2'%3E%3C/path%3E%3Cpath d='M5 3 2 6'%3E%3C/path%3E%3Cpath d='m22 6-3-3'%3E%3C/path%3E%3Cpath d='M12 2v4'%3E%3C/path%3E%3C/svg%3E");
}

/* Day 3: æº«æ³‰/ç†±æ°£åœ–ç¤º (Hot Springs) */
.alert-icon.onsen {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 20a4 4 0 1 1 0-8 4 4 0 0 1 0 8z'%3E%3C/path%3E%3Cpath d='M8 8c0-2.5 2-3 2-3s2 0.5 2 3'%3E%3C/path%3E%3Cpath d='M12 6c0-2.5 2-3 2-3s2 0.5 2 3'%3E%3C/path%3E%3Cpath d='M16 8c0-2.5 2-3 2-3s2 0.5 2 3'%3E%3C/path%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 20a4 4 0 1 1 0-8 4 4 0 0 1 0 8z'%3E%3C/path%3E%3Cpath d='M8 8c0-2.5 2-3 2-3s2 0.5 2 3'%3E%3C/path%3E%3Cpath d='M12 6c0-2.5 2-3 2-3s2 0.5 2 3'%3E%3C/path%3E%3Cpath d='M16 8c0-2.5 2-3 2-3s2 0.5 2 3'%3E%3C/path%3E%3C/svg%3E");
}
        .event.optimized { border-left: 2px solid var(--secondary); padding-left: 28px; margin-left: -8px; background-color: #FFFDF5; padding-top: 5px; padding-bottom: 5px; border-radius: 4px; }
        
        /* AI Features Styles (Integrated) */
        .btn-ai-guide {
            background: linear-gradient(90deg, #8B5CF6, #EC4899);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            font-weight: 600;
        }
        .btn-ai-guide:active { transform: scale(0.95); }
        .btn-ai-guide svg { width: 14px; height: 14px; fill: currentColor; }

        /* New Style for Replay Button (Blue Theme) */
        .btn-ai-play {
            background: linear-gradient(135deg, #2563EB, #3B82F6); /* Blue Gradient */
            color: white;
            border: none;
            /* Icon Only Style */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            padding: 0;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(37, 99, 235, 0.2);
            transition: transform 0.2s;
        }
        .btn-ai-play:active { transform: scale(0.95); }
        .btn-ai-play svg { 
            width: 20px; 
            height: 20px; 
            fill: none; 
            stroke: currentColor; 
            stroke-width: 2; 
            stroke-linecap: round; 
            stroke-linejoin: round; 
        }

        /* Weather Tab Specific Styles */
        .weather-search-box {
            display: flex; gap: 10px; margin-bottom: 20px;
        }
        .weather-input {
            flex: 1; padding: 12px; border: 2px solid #E5E7EB; border-radius: 12px; font-size: 1rem; outline: none;
        }
        .weather-input:focus { border-color: var(--primary); }
        .btn-weather-search {
            background: var(--primary); color: white; border: none; padding: 0 20px; border-radius: 12px; font-weight: 600; cursor: pointer;
        }
        
        .weather-card-main {
            background: linear-gradient(135deg, #60A5FA, #2563EB);
            color: white; border-radius: 20px; padding: 20px; text-align: center;
            margin-bottom: 20px; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
            position: relative; overflow: hidden;
        }
        .weather-card-main::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
            animation: rotate 20s linear infinite;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .wc-temp-big { font-size: 4rem; font-weight: 700; line-height: 1; margin: 10px 0; position: relative; z-index: 1; }
        .wc-loc { font-size: 1.5rem; font-weight: 500; position: relative; z-index: 1; }
        /* Add flexbox to center content and icon */
        .wc-desc { 
            font-size: 1.1rem; 
            opacity: 0.9; 
            margin-bottom: 10px; 
            position: relative; 
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* New: Mini Icon Style for Weather Tab */
        .icon-mini {
            width: 18px;
            height: 18px;
            vertical-align: text-bottom;
            margin-right: 4px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            display: inline-block;
        }

        .weather-compare-row {
            display: flex; gap: 10px; margin-bottom: 20px;
        }
        .wc-mini-card {
            flex: 1; background: white; padding: 15px; border-radius: 16px; border: 1px solid #E5E7EB; text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .wc-mini-title { font-size: 0.85rem; color: #6B7280; margin-bottom: 5px; }
        .wc-mini-temp { font-size: 1.5rem; font-weight: 700; color: #1F2937; }
        .wc-diff-tag { 
            display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; margin-top: 5px; 
        }
        .wc-diff-hot { background: #FEE2E2; color: #DC2626; }
        .wc-diff-cold { background: #DBEAFE; color: #1D4ED8; }
        
        .advice-box {
            background: #F0FDF4; border: 1px solid #BBF7D0; padding: 15px; border-radius: 16px;
            color: #166534; font-size: 0.95rem; line-height: 1.6;
        }

        /* æ–°å¢ï¼šè‡ªå®šç¾©å½ˆå‡ºè¦–çª— (Modal) æ¨£å¼ - å–ä»£åŸç”Ÿ alert/prompt */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: 2000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(3px);
            animation: fadeIn 0.2s;
        }
        .modal-box {
            background: white; width: 90%; max-width: 320px;
            border-radius: 16px; padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            transform: scale(0.95);
            animation: popIn 0.2s forwards;
        }
        @keyframes popIn { to { transform: scale(1); } }
        
        .modal-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; color: #1F2937; }
        .modal-desc { font-size: 0.9rem; color: #4B5563; margin-bottom: 15px; line-height: 1.5; }
        .modal-input {
            width: 100%; padding: 10px; border: 2px solid #E5E7EB; border-radius: 8px;
            font-size: 1rem; margin-bottom: 15px; outline: none;
        }
        .modal-input:focus { border-color: var(--primary); }
        
        .modal-btns { display: flex; gap: 10px; }
        .modal-btn {
            flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;
        }
        .btn-cancel { background: #F3F4F6; color: #4B5563; }
        .btn-confirm { background: var(--primary); color: white; }

        /* AI Container Styles */
        .ai-header { font-size: 1.4rem; font-weight: 700; margin-bottom: 15px; color: #4B5563; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #E5E7EB; padding-bottom: 10px; }
        
        /* Chat History Box (Replaces old result box) */
        .chat-history {
            background: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 16px;
            padding: 16px;
            min-height: 200px;
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }

        /* Chat Bubbles */
        .chat-row { display: flex; width: 100%; animation: slideIn 0.2s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .chat-row.user { justify-content: flex-end; }
        .chat-row.ai { justify-content: flex-start; }

        .chat-bubble {
            max-width: 85%;
            padding: 12px 16px;
            font-size: 1rem;
            line-height: 1.6;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .chat-bubble.user {
            background: var(--primary);
            color: white;
            border-radius: 18px 18px 4px 18px;
        }

        .chat-bubble.ai {
            background: white;
            border: 1px solid #E5E7EB;
            color: #374151;
            border-radius: 18px 18px 18px 4px;
        }
        
        .chat-bubble strong { font-weight: 600; }
        .chat-bubble.ai strong { color: var(--primary); }

        /* Inline Audio Button in Bubble */
        .btn-audio-inline {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: #E0F2FE;
            color: var(--primary);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            vertical-align: middle;
            margin-left: 8px;
            transition: transform 0.2s;
        }
        .btn-audio-inline:active { transform: scale(0.9); background: #BAE6FD; }
        .btn-audio-inline svg { width: 16px; height: 16px; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }

        /* Updated Input Area Layout */
        .ai-input-wrapper { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        
        /* New: Voice Language Toggle */
        .voice-lang-switch {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: -5px;
            padding: 0 5px;
            font-size: 0.85rem;
            color: #4B5563;
        }
        .lang-option {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 6px 12px; /* åŠ å¤§ä¸€é»é»æ“Šç¯„åœ */
            border-radius: 20px; /* åœ“è§’æ›´æ˜é¡¯ */
            border: 1px solid transparent; /* é ç•™é‚Šæ¡†ç©ºé–“ */
            transition: all 0.2s;
            background: #fff;
        }
        .lang-option:hover { background: #F3F4F6; }
        /* éš±è—åŸç”Ÿ radioï¼Œæ”¹ç”¨æ¨£å¼æ§åˆ¶ */
        .lang-option input { display: none; }
        
        /* é¸ä¸­æ™‚çš„æ¨£å¼ */
        .lang-option:has(input:checked) {
            background: #EFF6FF;
            border-color: var(--primary);
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        /* åœ‹æ—— SVG æ¨£å¼ - æ”¹ç‚ºåœ“å½¢ç°¡ç´„é¢¨ */
        .flag-icon {
            width: 24px;  /* æ­£æ–¹å½¢ */
            height: 24px; /* æ­£æ–¹å½¢ */
            border-radius: 50%; /* åœ“å½¢ */
            object-fit: cover;
            display: block;
            /* ç§»é™¤é™°å½±ï¼Œæ”¹ç”¨ SVG å…§éƒ¨é‚Šæ¡†ï¼Œæ›´æ‰å¹³ */
        }

        /* Mobile: Prevent Zoom on Input */
        .ai-input {
            width: 100%; padding: 14px; border: 2px solid #E5E7EB;
            border-radius: 12px; outline: none; 
            font-size: 16px; /* 16px prevents iOS zoom */
            transition: border-color 0.2s;
        }
        .ai-input:focus { border-color: #3b82f6; }

        .ai-actions-row { display: flex; gap: 8px; width: 100%; }
        
        .btn-mode {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; 
            font-size: 0.95rem;
            transition: transform 0.1s, opacity 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 48px; /* Ensure touch target size */
            /* Mobile touch fix: Prevent text selection/callout on long press */
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            touch-action: manipulation;
        }
        .btn-mode:active { transform: scale(0.96); opacity: 0.9; }
        
        .btn-mode svg {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .btn-mode.consult { background: linear-gradient(135deg, #1D4ED8, #3B82F6); }
        .btn-mode.trans { background: linear-gradient(135deg, #0EA5E9, #38BDF8); }
        .btn-mode.voice { background: linear-gradient(135deg, #06B6D4, #22D3EE); }
        
        .btn-mode.voice.recording {
            background: linear-gradient(135deg, #EF4444, #F87171); 
            animation: pulse 1.5s infinite;
        }
/* [æ–°å¢] ç›¸æ©ŸæŒ‰éˆ•æ¨£å¼ */
        .btn-mode.camera { background: linear-gradient(135deg, #8B5CF6, #D946EF); }
        
        /* éš±è—åŸæœ¬çš„æª”æ¡ˆä¸Šå‚³ Inputï¼Œæ”¹ç”¨æŒ‰éˆ•è§¸ç™¼ */
        #img-upload-input { display: none; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .btn-ai-reset {
            background: #F3F4F6; color: #6B7280; border: 1px solid #D1D5DB;
            padding: 10px 16px; border-radius: 8px; font-size: 0.9rem;
            cursor: pointer; margin-bottom: 15px; display: none;
            align-self: flex-end;
            width: 100%; /* Full width on mobile usually better for back buttons */
            text-align: center;
        }
        .btn-ai-reset:hover { background: #E5E7EB; }

        .loading-bubble { 
            color: #9CA3AF; font-style: italic; font-size: 0.9rem; display: flex; align-items: center; gap: 4px;
        }
        .loading-dots:after {
            content: ' .';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80%, 100% { content: ' ....'; }
        }
/* [æ–°å¢] SVG Sprite é€šç”¨æ¨£å¼ */
        .icon-sprite {
            width: 100%;
            height: 100%;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        /* Mobile Optimization - ä¿®æ­£å¾Œçš„å®Œæ•´æ‰‹æ©Ÿç‰ˆè¨­å®š */
        @media (max-width: 600px) {
            .container { padding: 15px 12px; } 
            
            /* Header èª¿æ•´ */
            .header-content { flex-direction: column; align-items: flex-start; gap: 10px; }
            .header-title-area h1 { font-size: 1.5rem; white-space: normal; line-height: 1.3; }
            
            /* å¤©æ°£å€å¡Šå®¹å™¨ï¼šç¸®å°é–“è· */
            .header-weather-box { 
                width: 100%; 
                justify-content: space-between; 
                padding: 10px 8px ; /*15px*/
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.15);
                min-height: auto;
                flex-wrap: wrap; 
                gap: 5px; /* [ä¿®æ­£] é–“è·ç¸®å° */
            }

            /* 1. å·¦å´ï¼šæˆ‘çš„ä½ç½® (ä¿®æ­£å¯¬åº¦) */
            .hw-col-my-loc {
                padding-right: 8px;
                margin-right: 0;
                border-right: 1px solid rgba(255,255,255,0.2); 
                min-width: auto;
                flex-shrink: 0;
                white-space: nowrap;
            }

            /* 2. ä¸­é–“ï¼šç›®çš„åœ° (é—œéµä¿®æ­£ï¼šå¡«æ»¿å‰©é¤˜ç©ºé–“) */
            .hw-col-loc { 
                flex: 1; /* [é—œéµ] è‡ªå‹•å¡«æ»¿ä¸­é–“å‰©é¤˜æ‰€æœ‰ç©ºé–“ */
                min-width: 0; /* [é—œéµ] å…è¨±å…§å®¹å£“ç¸®ï¼Œé˜²æ­¢æ’ç ´ */
                border: none; 
                padding: 0 4px;
                text-align: left; 
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            .hw-col-loc .hw-loc {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis; /* æ–‡å­—å¤ªé•·è®Š ... */
                font-size: 1rem; /* [æ–°å¢] æ‰‹æ©Ÿç‰ˆå­—é«”ç¸®å°ä¸€é» (åŸæœ¬æ˜¯ 1.1rem)ï¼Œé¿å…é•·åœ°åæ“ å£“ */
            }
            
            /* 3. å³å´ï¼šå¤©æ°£ (é—œéµä¿®æ­£ï¼šä¸å‡†æ¶ç©ºé–“) */
            .hw-col-main { 
                flex: 0 0 auto; /* [é—œéµ] å›ºå®šå¯¬åº¦ï¼Œä¸å‡†è‡ªå‹•è®Šå¤§ */
                padding: 0;     /* [é—œéµ] ç§»é™¤å…§è· */
                justify-content: flex-end; 
                gap: 5px;
            }

            /* åº•éƒ¨å»ºè­°æ–‡å­— */
            .hw-col-advice { 
                display: block; 
                width: 100%; 
                border-left: none; 
                border-top: 1px solid rgba(255,255,255,0.3); 
                padding-left: 0;
                padding-top: 8px;
                max-width: none;
                min-height: auto;
                font-size: 0.8rem;
                line-height: 1.4;
                margin-top: 5px;
            }
            
            /* å…¶ä»–æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
            .timeline { padding-left: 15px; padding-right: 5px; } 
            .event { padding-left: 15px; }
            .event::before { left: -6px; }

            .ai-actions-row { gap: 8px; }
            .btn-mode {
                padding: 10px 4px;
                font-size: 0.8rem;
                flex-direction: column; 
                gap: 6px;
                line-height: 1.2;
                height: 70px; 
            }
            .btn-mode svg { width: 24px; height: 24px; margin-bottom: 0; }
            
            .price-table { font-size: 0.85rem; }
        }
        /* [æœ€çµ‚ä¿®æ­£] å¼·åˆ¶é™åˆ¶ AI æŒ‰éˆ•åœ–ç¤ºå¤§å° */
        .btn-mode .icon-sprite {
            width: 24px !important;
            height: 24px !important;
            margin-bottom: 5px;
            flex-shrink: 0;
        }
        /* [ä¿®æ”¹] 2D é«˜æ•ˆèƒ½æ»‘å‹•å¼•æ“æ¨£å¼ (High Performance Slide) */
        
        body {
            overflow-x: hidden;
            /* ç§»é™¤ perspectiveï¼Œæ”¹ç‚ºå¹³é¢æ»‘å‹• */
        }

        .container {
            /* ğŸ’¡ [å„ªåŒ–] å¼·åˆ¶é–‹å•Ÿ GPU ç¡¬é«”åŠ é€Ÿï¼Œæ¸›å°‘é–ƒçˆ */
            transform: translate3d(0, 0, 0); 
            will-change: transform, opacity; 
            
            /* ä¿æŒéš±è—èƒŒé¢çš„è¨­å®šï¼Œé›–ç„¶æ˜¯ 2D ä½†å¯ä»¥é˜²æ­¢æ¸²æŸ“éŒ¯èª¤ */
            backface-visibility: hidden; 
        }

        /* 2. æ‰‹æŒ‡æ‹–æ›³ä¸­ (çµ•å°è·Ÿéš¨ï¼Œç„¡å»¶é²) */
        .container.is-dragging {
            transition: none !important;
            cursor: grabbing;
        }

        /* 3. æ”¾æ‰‹å¾Œçš„æ…£æ€§å‹•ç•« (ä½¿ç”¨æ‚¨æŒ‡å®šçš„ Bezier æ›²ç·š) */
        .container.is-animating {
            /* ğŸ’¡ [å„ªåŒ–] ä½¿ç”¨ cubic-bezier(0.23, 1, 0.32, 1) è®“å›å½ˆæ›´è‡ªç„¶ */
            transition: transform 0.25s cubic-bezier(0.23, 1, 0.32, 1), 
                        opacity 0.25s ease !important;
        }

        /* è¼”åŠ©ï¼šç•¶é é¢è¢«éš±è—æ™‚çš„ç‹€æ…‹ */
        .container.page-hidden {
            display: none;
        }
        /* [æ–°å¢] åœ–ç‰‡é»æ“Šæ”¾å¤§ (Lightbox) æ¨£å¼ */
        .lightbox-overlay {
            display: none; /* é è¨­éš±è— */
            position: fixed;
            z-index: 10000; /* æœ€é«˜å±¤ç´šï¼Œè“‹éæ‰€æœ‰æŒ‰éˆ• */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); /* æ·±é»‘èƒŒæ™¯ */
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.2s;
        }
        
        .lightbox-content {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            /* [ä¿®æ”¹] ç§»é™¤ transition ä»¥å¯¦ç¾å³æ™‚è·Ÿæ‰‹æ•ˆæœ */
            /* transform: scale(1); */ 
            
            /* [æ–°å¢] æ¸¸æ¨™è®Šæ›´èˆ‡è§¸æ§å„ªåŒ– */
            cursor: grab;
            touch-action: none; /* é—œéµï¼šé˜²æ­¢æ‰‹æ©Ÿæ»‘å‹•æ™‚è§¸ç™¼ç€è¦½å™¨æ›é æˆ–æ²å‹• */
            transform-origin: center center;
            will-change: transform; /* æ•ˆèƒ½å„ªåŒ– */
        }
        
        .lightbox-content:active {
            cursor: grabbing;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 25px;
            color: #fff;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
    /* [æ–°å¢] PWA å•Ÿå‹•éå ´ç•«é¢ (Splash Screen) */
#splash-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #2563EB; /* å¿…é ˆèˆ‡æ‚¨çš„ theme-color ä¸€è‡´ */
    z-index: 99999; /* ç¢ºä¿è“‹åœ¨æ‰€æœ‰å…§å®¹æœ€ä¸Šé¢ */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: opacity 0.6s ease-out, visibility 0.6s;
}

/* è®“éå ´ç•«é¢æ¶ˆå¤±çš„ç‹€æ…‹ */
#splash-screen.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none; /* ç©¿é€é»æ“Š */
}

/* ä¸­é–“çš„é£›æ©Ÿåœ–ç¤º */
.splash-logo {
    width: 120px; /* å¯ä¾éœ€æ±‚èª¿æ•´å¤§å° */
    height: 120px;
    margin-bottom: 20px;
    /* é€™è£¡å¯ä»¥åŠ å‹•ç•«ï¼Œä¾‹å¦‚è¼•å¾®æµ®å‹• */
    animation: floatPlane 3s ease-in-out infinite;
}

/* ä¸‹æ–¹çš„æ–‡å­— */
.splash-text {
    color: white;
    font-size: 1.2rem;
    font-weight: 700;
    letter-spacing: 2px;
    opacity: 0.9;
}

/* ç°¡å–®çš„æµ®å‹•å‹•ç•« */
@keyframes floatPlane {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
  /* --- [æ–°å¢] ä½å®¿é é¢å„ªåŒ–æ¨£å¼ Start --- */
.stay-card-grid {
    display: grid;
    gap: 12px;
    font-size: 0.95rem;
}
.stay-row {
    display: grid;
    grid-template-columns: 85px 1fr;
    align-items: center;
    gap: 10px;
    padding-bottom: 8px;
    border-bottom: 1px dashed #E5E7EB;
}
.stay-row:last-child { border-bottom: none; }

.stay-label { 
    color: #6B7280; 
    font-weight: 500; 
    display: flex; 
    align-items: center; 
    gap: 4px;
}
/* åœ°å€èˆ‡ MapCode çš„é¡¯ç¤ºå€å¡Š */
.stay-val { 
    font-weight: 600; 
    color: #1F2937; 
    word-break: break-all;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
}

/* è¤‡è£½æŒ‰éˆ• */
.btn-copy-small {
    background: white;
    border: 1px solid #D1D5DB;
    color: #4B5563;
    font-size: 0.75rem;
    padding: 3px 8px;
    border-radius: 6px;
    cursor: pointer;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.2s;
}
.btn-copy-small:active { transform: scale(0.95); background: #F3F4F6; }
.btn-copy-small.copied { 
    border-color: #10B981; 
    color: #059669; 
    background: #ECFDF5; 
}

/* åº•éƒ¨å¤§å°èˆªæŒ‰éˆ• */
.btn-nav-large {
    width: 100%;
    background: linear-gradient(135deg, #2563EB, #1D4ED8);
    color: white;
    font-size: 1rem;
    font-weight: 700;
    padding: 14px;
    border-radius: 12px;
    border: none;
    text-decoration: none; /* ç§»é™¤åº•ç·š */
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 15px;
    box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
    transition: transform 0.2s;
}
.btn-nav-large:active { transform: scale(0.98); }

/* MapCode å°ˆç”¨æ¨£å¼ */
.map-code-box {
    font-family: 'Roboto Mono', monospace;
    color: #D97706;
    background: #FFFBEB;
    padding: 2px 6px;
    border-radius: 4px;
    border: 1px solid #FCD34D;
    letter-spacing: 1px;
}
/* --- [æ–°å¢] ä½å®¿é é¢å„ªåŒ–æ¨£å¼ End --- */
  </style>
</head>
<body>
        <div id="splash-screen">
        <img src="icon-512.png" alt="App Logo" class="splash-logo">
        <div class="splash-text">ä¹å·è¦ªå­è‡ªé§•éŠ</div>
    </div>

    
<svg style="display: none;">
        <defs>
            <symbol id="icon-schedule" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </symbol>
            
            <symbol id="icon-stay" viewBox="0 0 24 24">
                <path d="M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3zm12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4z"></path>
            </symbol>
            
            <symbol id="icon-car" viewBox="0 0 24 24">
                <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/>
                <circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/>
                <path d="M5 17h2"/><path d="M15 17h2"/>
            </symbol>
            
            <symbol id="icon-info" viewBox="0 0 24 24">
                <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/>
                <path d="M9 18h6"/><path d="M10 22h4"/>
            </symbol>
            
            <symbol id="icon-weather" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="5"></circle>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
            </symbol>
            
            <symbol id="icon-ai" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
            </symbol>
            <symbol id="icon-consult" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
            </symbol>

            <symbol id="icon-trans" viewBox="0 0 24 24">
                <path d="M7 10h14"></path>
                <path d="M17 6l4 4-4 4"></path>
                <path d="M17 14H3"></path>
                <path d="M7 18l-4-4 4-4"></path>
            </symbol>

            <symbol id="icon-voice" viewBox="0 0 24 24">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
            </symbol>

            <symbol id="icon-camera" viewBox="0 0 24 24">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </symbol>

            <symbol id="icon-loc" viewBox="0 0 24 24">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </symbol>
            <symbol id="icon-earth" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            </symbol>

            <symbol id="icon-temp" viewBox="0 0 24 24">
                <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"></path>
            </symbol>

            <symbol id="icon-shirt" viewBox="0 0 24 24">
                <path d="M20.38 3.46L16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"></path>
            </symbol>

            <symbol id="icon-reset" viewBox="0 0 24 24">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </symbol>

            <symbol id="icon-nav-arrow" viewBox="0 0 24 24">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
            </symbol>
        </defs>
    </svg>
    <header>
        <div class="header-content">
            <div class="header-title-area">
                <h1>ä¹å·è¦ªå­è‡ªé§•éŠ</h1>
                <div class="subtitle">2026/01/25 - 01/30 (6å¤©5å¤œ)</div>
                <div class="badge-trip">è¦ªå­è‡ªç”±è¡Œ â€¢ ç†Šæœ¬é€²ç¦å²¡å‡º</div>
            </div>

            <!-- å¤©æ°£è³‡è¨Šç›’ (æ“ºæ”¾åœ¨å³å´ï¼Œä¸‰æ¬„å¼è¨­è¨ˆ) -->
            <div class="header-weather-box" id="header-weather">
                
                <div class="hw-col-my-loc" id="hw-my-loc-box" onclick="getLocalWeather()">
                    <div class="hw-sub-label">
                        <svg class="icon-mini" style="width:12px;height:12px;vertical-align:text-top;"><use href="#icon-nav-arrow"></use></svg>
                        æˆ‘çš„ä½ç½®
                    </div>
                    <div class="hw-my-data">
                        <span id="header-my-loc">å®šä½ä¸­..</span>
                        <span id="header-my-temp" style="color: var(--secondary);">--</span>
                    </div>
                </div>

                <div class="hw-col-loc">
                    <span class="hw-loc" id="hw-loc">ç†Šæœ¬å¸‚</span>
                    <span class="hw-date" id="hw-date">1/25 (Day 1)</span>
                </div>
                <!-- 2. æº«åº¦ç‹€æ…‹ -->
                <div class="hw-col-main">
                    <div class="hw-icon" id="hw-icon">
                        <!-- SVG Icon -->
                    </div>
                    <div class="hw-temp-group">
                        <div class="hw-temp" id="hw-temp">10Â°C</div>
                        <span class="hw-desc" id="hw-desc">æ™´æ™‚å¤šé›²</span>
                        <span class="hw-range" id="hw-range">2Â°C ~ 11Â°C</span>
                    </div>
                </div>
                <!-- 3. ç©¿è¡£å»ºè­° -->
                <div class="hw-col-advice" id="hw-advice">
                    æ°£æº«é©ä¸­ä½†æ—©æ™šåæ¶¼ï¼Œé•·è¢–é…å¤–å¥—ã€‚
                </div>
            </div>
        </div>
    </header>

    <!-- TAB 1: è¡Œç¨‹è¡¨ -->
    <div id="view-schedule" class="container active">
                <div class="card" style="border-left: 5px solid #F59E0B; margin-bottom: 20px;">
            <div class="card-header checklist-card-header" onclick="toggleChecklist(this)">
                <div class="card-title" style="display: flex; align-items: center; gap: 6px;">
                    <svg class="icon-mini" style="color: #F59E0B;" viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
                    è¡Œå‰æº–å‚™ Check List
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="tag tag-tip" id="checklist-progress" style="background:#FFFBEB; color:#D97706; font-weight:700;">è¨ˆç®—ä¸­...</div>
                    <div class="toggle-icon" style="font-size: 0.8rem; color: #6B7280; font-weight: 700; transition: transform 0.3s;">â–¼</div>
                </div>
            </div>
            
            <div id="checklist-container" class="checklist-container">
                <div class="add-item-box" onclick="event.stopPropagation()">
                    <input type="text" id="new-item-input" class="input-add-item" placeholder="æ–°å¢æº–å‚™é …ç›®...">
                    <button class="btn-add-item" onclick="addNewCheckItem()">ï¼‹</button>
                </div>
                <div class="checklist-grid" id="checklist-list-area"></div>
            </div>
        </div>

        
        <!-- Day 1 -->
        <div class="day-wrapper">
            <div class="day-toggle" id="toggle-d1" onclick="toggleTimeline('d1', this)">
                <div class="day-info">
                    <h3>Day 1: æŠµé”èˆ‡ç†Šæœ¬å¸‚å€</h3>
                    <span>1/25 (æ—¥) â€¢ ä½å®¿: ç†Šæœ¬ The Blossom</span>
                </div>
                <div class="toggle-icon">â–¼</div>
            </div>
            <div id="d1" class="timeline">
                <div class="event">
                    <div class="time">11:00</div>
                    <div class="activity">æŠµé”ç†Šæœ¬æ©Ÿå ´ (KMJ)</div>
                    <div class="desc">é ˜å–è¡Œæå¾Œï¼Œå‰å¾€1æ¨“å…¥å¢ƒå¤§å»³å¤– 4è™Ÿä¹˜è»Šè™•ã€‚</div>
                    <div class="tags"><span class="tag tag-move">æ˜Ÿå®‡èˆªç©º</span></div>
                </div>
                <div class="event">
                    <div class="time">12:00</div>
                    <div class="activity">å‰å¾€ç†Šæœ¬å¸‚å€ (äº¤é€šé¸æ“‡)</div>
                    <div class="desc">
                        <ul style="list-style-type: disc; padding-left: 20px;">
                            <li><b>é¸é … A (ç›´é”å·´å£«)ï¼š</b> æ­ä¹˜åˆ©æœ¨æ´¥å·´å£«å¾€ã€Œç†Šæœ¬ç«™ã€ã€‚è»Šç¨‹ç´„60åˆ†ï¼Œæˆäººç´„1000å††ã€‚æœ€è¼•é¬†ï¼Œè¡Œæå…æ¬é‹ã€‚</li>
                            <li><b>é¸é … B (å…è²»æ¥é§+JR)ï¼š</b> æ­ä¹˜å…è²»ã€Œç©ºæ¸¯Linerã€è‡³è‚¥å¾Œå¤§æ´¥ç«™ (15åˆ†)ï¼Œè½‰ä¹˜ JR è±è‚¥æœ¬ç·šè‡³ç†Šæœ¬ç«™ (40åˆ†ï¼Œç´„480å††)ã€‚ä¸æ€•å¡è»Šï¼Œä½†éœ€è½‰ä¹˜ã€‚</li>
                            <li><b>é¸é … C (è¨ˆç¨‹è»Š)ï¼š</b> ç›´æ¥å‰å¾€é£¯åº—ï¼Œè»Šç¨‹ç´„ 45-50 åˆ†ï¼Œè»Šè³‡ç´„ 5000-6000å††ã€‚</li>
                        </ul>
                    </div>
                    <div class="tags"><span class="tag tag-move">å·´å£«</span><span class="tag tag-move">JRé›»è»Š</span></div>
                </div>
                <div class="event">
                    <div class="time">13:10</div>
                    <div class="activity">é£¯åº— Check-in / å¯„æ”¾è¡Œæ</div>
                    <div class="desc">The Blossom Kumamoto (JRç†Šæœ¬ç«™æ— Amu Plazaæ¨“ä¸Š)ã€‚</div>
                    <a href="https://www.google.com/maps/search/?api=1&query=THE+BLOSSOM+KUMAMOTO" target="_blank" class="btn-map">å°èˆª</a>
                </div>
                <div class="event event-meal">
                    <div class="time">13:30</div>
                    <div class="activity">åˆé¤/é»å¿ƒæ™‚æ®µï¼šç†Šæœ¬ç«™å‘¨é‚Š</div>
                    <div class="desc">
                        <ul style="list-style-type: disc;">
                            <li><b>è‚¥å¾Œå¥½ç‰©å¸‚å ´ï¼šï¼š</b> (ç†Šæœ¬ç«™å…§) æ¨è–¦ï¼šã„ããªã‚Šå›£å­ (é•·å£½åºµ)ã€ç«¹è¼ªæ²™æ‹‰ (ãƒ’ãƒ©ã‚¤)ã€‚å¿«é€Ÿè§£æ±ºã€‚</li>
                            <li><b>ç†Šæœ¬æ‹‰éºµï¼šï¼š</b> ç«™å‰æœ‰å¹¾é–“æ‹‰éºµåº—ï¼Œå¯å¿«é€Ÿé£½é¤ä¸€é “ã€‚</li>
                        </ul>
                    </div>
                    <div class="tags"><span class="tag tag-food">é¸æ“‡åˆé¤</span></div>
                </div>
                <div class="event">
                    <div class="time">15:00</div>
                    <div class="activity">ç†Šæœ¬åŸ / æ«»ä¹‹é¦¬å ´ åŸå½©è‹‘</div>
                    <div class="desc">
                        æ¬£è³å¤©å®ˆé–£å¤–è§€(ä¿®å¾©ä¸­)ï¼ŒåŸå½©è‹‘æœ‰è¨±å¤šè©¦åƒèˆ‡ç´€å¿µå“ã€‚
                        <div style="margin-top: 8px; border-top: 1px dashed #ccc; padding-top: 5px;">
                            <strong style="color: var(--food-choice); font-size: 0.9rem;">ğŸ˜‹ åŸå½©è‹‘å¿…åƒæ¨è–¦ï¼š</strong>
                            <ul style="list-style-type: disc; margin-top: 5px; padding-left: 20px; font-size: 0.9rem; color: #555;">
                                <li><b>æµ·è†½å¯æ¨‚é¤… (ã†ã«ã‚³ãƒ­ãƒƒã‚±)ï¼š</b> æ¿ƒéƒæµ·è†½å…§é¤¡ï¼Œå¤–é…¥å…§è»Ÿã€‚</li>
                                <li><b>è…ä¹ƒå±‹ é¦¬è‚‰å¯æ¨‚é¤…ï¼š</b> ä¸æ•¢åƒç”Ÿé¦¬è‚‰å¯ä»¥å˜—è©¦é€™å€‹ï¼Œç„¡è…¥å‘³ã€‚</li>
                                <li><b>æŠ¹èŒ¶éœœæ·‡æ·‹ (TENTE)ï¼š</b> ç†Šæœ¬ç”¢èŒ¶è‘‰è£½ä½œï¼ŒèŒ¶é¦™æ¿ƒåšã€‚</li>
                            </ul>
                        </div>
                    </div>
                    <button class="btn-ai-guide" onclick="askGeminiGuide('ç†Šæœ¬åŸå¤©å®ˆé–£èˆ‡å¿è€…', 'å‘Šè¨´5æ­²å°å­©é—œæ–¼é€™åº§åŸå ¡çš„å¿è€…æ•…äº‹æˆ–æ­¦å£«æ•…äº‹ï¼Œä¸¦çµ¦ä»–ä¸€å€‹å°‹æ‰¾åŸç‰†ä¸Šç‰¹æ®ŠçŸ³é ­çš„ä»»å‹™ã€‚')">
                        âœ¨ èªªæ•…äº‹çµ¦å­©å­è½
                    </button>
                    <a href="https://www.google.com/maps/search/?api=1&query=Sakuranobaba+Josaien" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-spot">è¦ªå­æ•£æ­¥</span><span class="tag tag-food">é‚Šèµ°é‚Šåƒ</span></div>
                </div>
                <div class="event">
                    <div class="time">16:45</div>
                    <div class="activity">æ°´å‰å¯ºæˆè¶£åœ’ (æ—¥å¼åº­åœ’å‚™æ¡ˆ)</div>
                    <div class="desc">è‹¥ç†Šæœ¬åŸè¡Œç¨‹çµæŸå¾—æ—©ï¼Œå¯æ­å¸‚é›»Aç³»çµ±è‡³ã€Œæ°´å‰å¯ºå…¬åœ’ã€ã€‚æ—¥å¼åº­åœ’é€ æ™¯å„ªç¾ã€‚</div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Suizenji+Jojuen" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-kids">å‚™æ¡ˆ</span><span class="tag tag-spot">å…¬åœ’</span></div>
                </div>
                <div class="event">
                    <div class="time">18:00</div>
                    <div class="activity" style="color: var(--kumamoto-info-text);">ä¸Šé€š/ä¸‹é€š è³¼ç‰©è¡—æ•£ç­–</div>
                    <div class="desc">
                        åœ¨æ™šé¤å‰äº«å—å¸‚å€ç†±é¬§çš„æ‹±å»Šå•†åº—è¡—ã€‚å¯æ­ä¹˜å¸‚é›»è‡³ã€Œé€šç”ºç­‹ã€æˆ–ã€Œè¾›å³¶ç”ºã€ç«™ã€‚
                        <span style="display:block; font-weight: 600; margin-top: 5px;">***è©³ç›¡æ”»ç•¥èˆ‡ç¾é£Ÿé¸æ“‡è«‹è¦‹ã€Œæ—…éŠè³‡è¨Šã€é ç±¤ã€‚***</span>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Kamitori+Shopping+Street" target="_blank" class="btn-map">å°èˆªè‡³ä¸Šé€šè¡—</a>
                    <div class="tags"><span class="tag tag-shop">è³¼ç‰©</span><span class="tag tag-relax">ç¾é£Ÿé¸æ“‡å¤š</span></div>
                </div>
                <div class="event event-meal">
                    <div class="time">19:30</div>
                    <div class="activity">æ™šé¤æ™‚æ®µï¼šç†Šæœ¬å¸‚å€/è»Šç«™é¸æ“‡</div>
                    <div class="desc">
                        <ul style="list-style-type: disc;">
                            <li><b>å‹çƒˆäº­è±¬æ’ï¼šï¼š</b> (æ–°å¸‚è¡—/Amu Plaza) çŸ¥åæ—¥å¼è±¬æ’è€åº—ï¼Œç™½é£¯é«˜éº—èœå¯çºŒã€‚</li>
                            <li><b>å¤©å¤–å¤©æ‹‰éºµï¼šï¼šï¼š</b> (æ–°å¸‚è¡—) çŸ¥åè’œå‘³è±šéª¨æ‹‰éºµï¼Œé‡å£å‘³ã€‚</li>
                        </ul>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Katsuretsutei+Amu+Plaza+Kumamoto" target="_blank" class="btn-map">å‹çƒˆäº­å°èˆª</a>
                    <div class="tags"><span class="tag tag-food">é¸æ“‡æ™šé¤</span></div>
                </div>
                <div class="event">
                    <div class="time">21:00</div>
                    <div class="activity">æ™šé¤å¾Œå»ºè­°è¡Œç¨‹ (è‡ªç”±é¸æ“‡)</div>
                    <div class="desc">
                        <ul style="list-style-type: disc;">
                            <li><b>Amu Plaza è³¼ç‰© (æ¨è–¦)ï¼šï¼š</b> é£¯åº—æ¨“ä¸‹ï¼Œå¯é€›é€›è—¥å¦åº—æˆ–ä¼´æ‰‹ç¦®åº—ã€‚</li>
                            <li><b>è»Šç«™è¶…å¸‚è£œè²¨ï¼šï¼šï¼š</b> è³¼è²·éš”å¤©é›¶é£ŸåŠé£²å“ã€‚</li>
                            <li><b>é£¯åº—æ³¡æ¾¡ä¼‘æ¯ï¼šï¼šï¼š</b> ç¬¬ä¸€å¤©é•·é€”æ—…è¡Œï¼Œææ—©å›æˆ¿è®“å­©å­ä¼‘æ¯ã€‚</li>
                        </ul>
                    </div>
                    <div class="tags"><span class="tag tag-spot">è¼•é¬†</span><span class="tag tag-kids">è³¼ç‰©</span></div>
                </div>
            </div>
        </div>

        <!-- Day 2 -->
        <div class="day-wrapper">
            <div class="day-toggle" id="toggle-d2" onclick="toggleTimeline('d2', this)">
                <div class="day-info">
                    <h3>Day 2: è§€å…‰åˆ—è»Š & é»‘å·æº«æ³‰</h3>
                    <span>1/26 (ä¸€) â€¢ ä½å®¿: é»‘å·æº«æ³‰ éº“æ—…é¤¨</span>
                </div>
                <div class="toggle-icon">â–¼</div>
            </div>
            <div id="d2" class="timeline">
                <div class="alert-box" style="background: #F7FCEF; border: 1px solid #D9F99D; color: #3F6212;">
                    <div class="alert-icon time"></div>
                    <div><b>å„ªåŒ–ç›®æ¨™ï¼šï¼š</b>èª¿æ•´ä¸‹åˆè¡Œç¨‹æ™‚é–“ï¼Œç¢ºä¿ **17:05 å¾å¤§è§€å³°å‡ºç™¼**ï¼Œæ–¼ **18:00 æŠµé”é»‘å·æº«æ³‰**ã€‚</div>
                </div>
                <div class="event">
                    <div class="time">09:00</div>
                    <div class="activity">Check-out & å‰å¾€ç†Šæœ¬ç«™ JR æœˆå°</div>
                    <div class="desc">The Blossom å°±åœ¨ç†Šæœ¬ç«™æ—ï¼Œç§»å‹•éå¸¸æ–¹ä¾¿ï¼Œä½†ä»å»ºè­°é ç•™æ™‚é–“ã€‚</div>
                    <div class="tags"><span class="tag tag-move">ç§»å‹•</span></div>
                </div>
                <div class="event">
                    <div class="time">09:57</div>
                    <div class="activity">JR è§€å…‰åˆ—è»Šã€Œé˜¿è˜‡ç”·å­©!ã€</div>
                    <div class="desc">
                        ç¬¬3ç¯€è»Šå»‚è¨­æœ‰**æœ¨çƒæ± ã€å…’ç«¥åœ–æ›¸å®¤**å’Œå“ºä¹³å®¤ï¼Œè«‹é ç•™æ™‚é–“å¸¶å­©å­å»ç©ã€‚
                    </div>
                    <button class="btn-ai-guide" onclick="askGeminiGuide('é˜¿è˜‡ç”·å­©è™Ÿåˆ—è»Š', 'å‘å­©å­ä»‹ç´¹é€™å°ç«è»Šä¸Šçš„å°ç‹— Kuro é†¬æ˜¯èª°ï¼Œä¸¦å»ºè­°ä¸€å€‹åœ¨ç«è»Šä¸Šå¯ä»¥ç©çš„å°‹å¯¶éŠæˆ²ã€‚')">
                        âœ¨ Kuro é†¬æ˜¯èª°ï¼Ÿ
                    </button>
                    <!-- å‚™æ¡ˆ -->
                    <div style="margin-top:8px; border-top:1px dashed #ccc; padding-top:5px; font-size:0.85rem; color:#666;">
                        ğŸš‚ <b>åœé§›å‚™æ¡ˆï¼š</b> è‹¥é‡åœé§›ï¼Œå¯æ”¹æ­ <b>ä¹å·æ©«æ–·ç‰¹æ€¥ (09:11ç™¼)</b> æˆ– <b>æ™®é€šåˆ—è»Š</b>ã€‚é›–ç„¡è¦ªå­è¨­æ–½ï¼Œä½†ä»å¯æ¬£è³æ²¿é€”é¢¨æ™¯ã€‚
                    </div>
                    <div class="tags"><span class="tag tag-move">ç«è»Š</span><span class="tag tag-kids">è¦ªå­å¿…éŠ</span></div>
                </div>
                <div class="event">
                    <div class="time">11:27</div>
                    <div class="activity">æŠµé”é˜¿è˜‡ç«™ (å–è»Šæº–å‚™)</div>
                    <div class="desc">åˆ—è»Šæº–æ™‚æŠµé”é˜¿è˜‡ç«™ã€‚è«‹æº–å‚™å‰å¾€ç§Ÿè»Šè¡Œã€‚</div>
                    <div class="tags"><span class="tag tag-move">æŠµé”</span></div>
                </div>
                <div class="event">
                    <div class="time">11:40</div>
                    <div class="activity">Toyota ç§Ÿè»Š - é˜¿è˜‡ç«™å‰åº— (å–è»Š)</div>
                    <div class="desc">
                        <b>ç§Ÿè»Šè¡Œï¼šï¼š</b> Toyota Rent a Car é˜¿è˜‡ç«™å‰åº— (ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼é˜¿è˜‡é§…å‰åº—)ã€‚å»ºè­°é ç•™ 30-45 åˆ†é˜è¾¦ç†æ‰‹çºŒã€‚
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Toyota+Rent+a+Car+é˜¿è˜‡é§…å‰åº—" target="_blank" class="btn-map">å°èˆªè‡³ç§Ÿè»Šè¡Œ</a>
                    <div class="tags"><span class="tag tag-car">Toyota</span><span class="tag tag-move">ç§Ÿè»Šé–‹å§‹</span></div>
                </div>
                <div class="event event-meal optimized">
                    <div class="time">12:20</div>
                    <div class="activity" style="color: var(--secondary);">åˆé¤æ™‚æ®µï¼šé˜¿è˜‡èµ¤ç‰›ä¸¼ (ç²¾ç°¡)</div>
                    <div class="desc">
                        <ul style="list-style-type: disc;">
                            <li>**èµ¤ç‰›ä¸¼ï¼š** æ¨è–¦å‰å¾€ **ã„ã¾ãã‚“é£Ÿå ‚** (éœ€è‡ªé§•ï¼Œç´„ 15-20 åˆ†é˜)ã€‚å› éœ€æ§åˆ¶æ™‚é–“ï¼Œå»ºè­°äº‹å…ˆé›»è©±é ç´„ï¼Œæˆ–é¸æ“‡äººæ½®è¼ƒå°‘çš„åŒé¡å‹é¤å»³ï¼Œ**å°‡ç”¨é¤æ™‚é–“æ§åˆ¶åœ¨ 60 åˆ†é˜å…§**ã€‚</li>
                        </ul>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=ã„ã¾ãã‚“é£Ÿå ‚+é˜¿è˜‡" target="_blank" class="btn-map">å°èˆªè‡³ ã„ã¾ãã‚“é£Ÿå ‚</a>
                     <div class="tags"><span class="tag tag-food">æ™‚é–“ç·Šæ¹Š</span><span class="tag tag-car">éœ€è‡ªé§•</span></div>
                </div>
                 <div class="event optimized">
                    <div class="time">13:40</div>
                    <div class="activity" style="color: var(--secondary);">é˜¿è˜‡ç¥ç¤¾ (Aso Shrine)</div>
                    <div class="desc">
                        æŠµé”ç¥ç¤¾ä¸¦åƒè§€é–€å‰ç”ºï¼Œ**å»ºè­°åœç•™æ™‚é–“ç´„ 45 åˆ†é˜**ã€‚
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Aso+Shine" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-shrine">åœç•™ 45åˆ†</span></div>
                </div>
                <div class="event optimized">
                    <div class="time">14:45</div>
                    <div class="activity" style="color: var(--secondary);">è‰åƒé‡Œå’–å•¡çƒ˜ç„™åŠ (Kusasenri)</div>
                    <div class="desc">
                        æ¬£è³é˜¿è˜‡ç«å±±ç¾¤èˆ‡è‰åƒé‡Œæ”¾ç‰§ç¾æ™¯ï¼Œä¸¦äº«ç”¨å’–å•¡ã€‚**å»ºè­°åœç•™æ™‚é–“ç´„ 60 åˆ†é˜**ï¼Œé¿å…é€—ç•™éä¹…ã€‚
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Kusasenri+Coffee+Roastery" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-spot">åœç•™ 60åˆ†</span></div>
                </div>
                <div class="event optimized">
                    <div class="time">16:00</div>
                    <div class="activity" style="color: var(--secondary);">é˜¿è˜‡å¤§è§€å³° (Daikanbo Lookout)</div>
                    <div class="desc">
                        çœºæœ›é˜¿è˜‡äº”å²³ã€Œæ¶…æ§ƒåƒã€çµ•æ™¯ï¼Œåœè»Šå ´æ—æœ‰ä¼´æ‰‹ç¦®èˆ‡é»å¿ƒåº—ã€‚
                        <span style="color:var(--danger); font-weight: 600;">***é‡è¦ï¼šè«‹å‹™å¿…åœ¨ 17:05 å‰ä¸Šè»Šå‡ºç™¼***</span>ã€‚
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Daikanbo+Lookout" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-spot">æ™¯è§€</span></div>
                </div>
                <div class="event optimized">
                    <div class="time">17:05</div>
                    <div class="activity" style="color: var(--danger); font-weight: 700;">å‰å¾€é»‘å·æº«æ³‰ (è‡ªé§• 55åˆ†)</div>
                    <div class="desc">
                        <span style="color:var(--danger); font-weight: 600;">âš ï¸ å±±è·¯é§•é§›è«‹å°å¿ƒï¼šï¼š</span> å†¬å­£å±±è·¯ï¼Œè«‹å‹¿è¶…é€Ÿä¸¦æ³¨æ„å®‰å…¨ã€‚
                    </div>
                    <div class="tags"><span class="tag tag-move">æº–æ™‚å‡ºç™¼ï¼</span></div>
                </div>
                <div class="event event-meal">
                    <div class="time" style="color: var(--primary); font-weight: 700;">18:00</div>
                    <div class="activity" style="color: var(--primary); font-weight: 700;">æˆåŠŸæŠµé”é»‘å·æº«æ³‰æ—…é¤¨</div>
                    <div class="desc">è¾¦ç†å…¥ä½æ‰‹çºŒï¼Œæ”¾é¬†ä¼‘æ¯ã€‚</div>
                    <div class="info-detail-box" style="border: 1px dashed #10B981; margin-top: 15px;">
                        <h4 style="color:#10B981;">ğŸ‘‰ æ—…é¤¨å°èˆªè³‡è¨Š (é›»è©±)</h4>
                        <div class="info-grid">
                            <div class="info-label">éº“æ—…é¤¨</div>
                            <div class="info-val">0967-44-0103</div>
                        </div>
                        <div class="info-grid">
                            <div class="info-label">æ¹¯æœ¬èŠ</div>
                            <div class="info-val">0967-44-0211</div>
                        </div>
                        <span style="display: block; font-size: 0.8rem; color: #666; margin-top: 5px;">å»ºè­°ä½¿ç”¨é›»è©±è™Ÿç¢¼è¼¸å…¥è»Šç”¨å°èˆªã€‚</span>
                    </div>
                </div>
                <div class="event event-meal">
                    <div class="time">19:00</div>
                    <div class="activity">æ™šé¤: æ—…é¤¨æœƒå¸­æ–™ç†</div>
                    <div class="desc">åœ¨æ—…é¤¨äº«ç”¨ç²¾ç·»çš„æ—¥å¼æœƒå¸­æ™šé¤ (é€šå¸¸æ™šé¤æ™‚é–“ç‚º 18:30-19:30)ã€‚</div>
                    <div class="tags"><span class="tag tag-stay">æº«æ³‰æ—…é¤¨</span><span class="tag tag-food">å·²åŒ…å«</span></div>
                </div>
                <div class="event">
                    <div class="time">21:00</div>
                    <div class="activity">é»‘å·æº«æ³‰è¡— å¤œé–“æ•£ç­– (æ¥µæ¨è–¦)</div>
                    <div class="desc">
                        ç©¿è‘—æµ´è¡£ï¼Œæ¼«æ­¥æ–¼é»ç¶´è‘—æŸ”å’Œç‡ˆç± çš„æº«æ³‰è¡—ã€‚æ°£æ°›å¯§éœï¼Œéå¸¸é©åˆæ”¾é¬†ã€‚
                        <span style="display:block; margin-top: 5px;">âš ï¸ è«‹æ³¨æ„å†¬å­£ä¿æš–ï¼Œä¸¦ç¢ºä¿å­©å­è…³æ­¥å®‰å…¨ã€‚</span>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Kurokawa+Onsen+Town" target="_blank" class="btn-map">æº«æ³‰è¡—ä¸­å¿ƒå°èˆª</a>
                    <div class="tags"><span class="tag tag-relax">æ”¾é¬†</span><span class="tag tag-kids">è¦ªå­é«”é©—</span></div>
                </div>
            </div>
        </div>

        <!-- Day 3 -->
        <div class="day-wrapper">
            <div class="day-toggle" id="toggle-d3" onclick="toggleTimeline('d3', this)">
                <div class="day-info">
                    <h3>Day 3: åˆ¥åºœæµ·åœ°ç„ã€é‡ç”Ÿå‹•ç‰©åœ’ & ç”±å¸ƒé™¢</h3>
                    <span>1/27 (äºŒ) â€¢ ä½å®¿: ç”±å¸ƒé™¢ æ¹¯å¸ƒé™¢å±±ç‡ˆèˆ˜</span>
                </div>
                <div class="toggle-icon">â–¼</div>
            </div>
            <div id="d3" class="timeline">
                <div class="alert-box" style="background: var(--beppu-bg); border: 1px solid var(--beppu-info); color: #075985;">
                    <div class="alert-icon onsen"></div>
                    <div><b>è¡Œç¨‹æç¤ºï¼šï¼š</b>æµ·åœ°ç„å·²åŠ å…¥æ­¤è¡Œç¨‹ï¼æ‚¨å°‡å¾é»‘å·æº«æ³‰å‡ºç™¼ï¼Œ**åœ¨å‰å¾€ç”±å¸ƒé™¢çš„é€”ä¸­ç¶“éåˆ¥åºœä¸¦åƒè§€æµ·åœ°ç„**ï¼Œå®Œç¾ä¸²è¯è¡Œç¨‹ã€‚</div>
                </div>
                <div class="event event-meal">
                    <div class="time">06:30</div>
                    <div class="activity">æ—©é¤: æ—…é¤¨å…§äº«ç”¨</div>
                    <div class="desc">äº«ç”¨é»‘å·æº«æ³‰æ—…é¤¨è±ç››çš„æ—¥å¼æ—©é¤ã€‚</div>
                     <div class="tags"><span class="tag tag-stay">æº«æ³‰æ—…é¤¨</span><span class="tag tag-food">å·²åŒ…å«</span></div>
                </div>
                <div class="event">
                    <div class="time">08:00</div>
                    <div class="activity">é»‘å·æº«æ³‰æ•£ç­– & Check-out</div>
                    <div class="desc">åœ¨é€€æˆ¿å‰è³¼è²·ã€Œå…¥æ¹¯æ‰‹å½¢ã€é€›æº«æ³‰è¡—ï¼Œäº«å—æ—©æ™¨çš„å¯§éœã€‚</div>
                    <div class="tags"><span class="tag tag-relax">æ•£æ­¥</span></div>
                </div>
                <div class="event">
                    <div class="time">09:00</div>
                    <div class="activity">ç§»å‹•è‡³åˆ¥åºœåœ°ç„å€ (è‡ªé§• 1å°æ™‚30åˆ†)</div>
                    <div class="desc">è»Šç¨‹è¼ƒé•·ï¼Œå»ºè­°æº–å‚™å¥½å­©å­çš„é›¶é£Ÿå’Œå¨›æ¨‚ã€‚</div>
                    <div class="tags"><span class="tag tag-move">ç§»å‹•</span><span class="tag tag-car">é«˜é€Ÿ/å±±è·¯</span></div>
                </div>
                <div class="event">
                    <div class="time" style="color: var(--beppu-info); font-weight: 700;">10:30</div>
                    <div class="activity" style="color: var(--beppu-info); font-weight: 700;">æŠµé” åˆ¥åºœ æµ·åœ°ç„ (Umi Jigoku)</div>
                    <div class="desc">
                        åœ°ç„å·¡ç¦®ä¸­æœ€å¤¢å¹»çš„ä¸€è™•ï¼å› ä½”åœ°è¼ƒå¤§ï¼Œå»ºè­°åœç•™ç´„ **75åˆ†é˜**ã€‚
                        <ul style="list-style-type: disc; margin-top: 5px; padding-left: 20px;">
                            <li>**å¿…çœ‹ï¼šï¼š** éˆ·è—è‰²çš„æº«æ³‰æ°´ã€ç†±å¸¶ç¡è“®æ± ï¼ˆé¬¼è“®ï¼‰ã€æº«æ³‰é›è›‹ã€‚</li>
                            <li>**å‚™æ¡ˆï¼šï¼š** æµ·åœ°ç„æ—çš„ **ç¶åœ°ç„ï¼ˆKamado Jigokuï¼‰** ä¹Ÿå¾ˆæ¨è–¦ï¼Œä»¥å¤šç¨®é¡è‰²çš„æº«æ³‰å’Œé£²ç”¨æº«æ³‰èåï¼Œè‹¥æ™‚é–“è¨±å¯å¯ä¸€ä½µåƒè§€ï¼ˆå¤šåŠ  30 åˆ†é˜ï¼‰ã€‚</li>
                        </ul>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=åˆ¥åºœ+æµ·åœ°ç„" target="_blank" class="btn-map">å°èˆªè‡³æµ·åœ°ç„</a>
                    <div class="tags"><span class="tag tag-beppu">åˆ¥åºœåœ°ç„</span><span class="tag tag-spot">æ™¯è§€</span></div>
                </div>
                <div class="event event-meal">
                    <div class="time">13:45</div>
                    <div class="activity">åˆé¤æ™‚æ®µï¼šåœ°ç„å‘¨é‚Šè¼•é£Ÿ/ç§»å‹•ä¸­</div>
                    <div class="desc">
                         <ul style="list-style-type: disc;">
                            <li><b>åœ°ç„è’¸æ–™ç†/æº«æ³‰è›‹ï¼šï¼š</b> åœ¨åœ°ç„å€å¿«é€Ÿè³¼è²·è¼•é£Ÿ (å¦‚æº«æ³‰è›‹æˆ–åœ°ç„è’¸å¸ƒä¸) ç•¶ä½œåˆé¤ã€‚</li>
                            <li><b>å‹•ç‰©åœ’åœ’å…§é¤å»³ï¼šï¼šï¼š</b> è‹¥åœ¨åœ°ç„å€æœªç”¨é¤ï¼Œå‰‡ç›´æ¥å‰å¾€å‹•ç‰©åœ’åœ¨åœ’å…§ç”¨é¤ã€‚</li>
                        </ul>
                    </div>
                     <div class="tags"><span class="tag tag-food">é¸æ“‡åˆé¤</span></div>
                </div>
                <div class="event">
                    <div class="time">12:30</div>
                    <div class="activity">æŠµé” ä¹å·è‡ªç„¶å‹•ç‰©å…¬åœ’ (African Safari)</div>
                    <div class="desc">å¾åœ°ç„å€è‡ªé§•ç´„ 15-20 åˆ†é˜å¯æŠµé”ã€‚åœè»Šå ´å¾ˆå¤§ï¼Œè«‹ç•™æ„è·¯æ¨™ã€‚</div>
                    <a href="https://www.google.com/maps/search/?api=1&query=African+Safari+Oita" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-move">æŠµé”</span></div>
                </div>
                <div class="event">
                    <div class="time">12:30 - 16:30</div>
                    <div class="activity">ä¹å·è‡ªç„¶å‹•ç‰©å…¬åœ’ (4å°æ™‚éŠç©)</div>
                    <div class="desc">
                        **æ™‚é–“å»ºè­°ï¼š** è‡ªé§•è§€è³ (30åˆ†é˜) + å¢æ—å·´å£« (50åˆ†é˜) + è¦ªè¿‘å€ (1å°æ™‚30åˆ†é˜)ã€‚
                        **è«‹å‹™å¿…ææ—©é ç´„å¢æ—å·´å£«å ´æ¬¡ï¼Œä¸¦å®‰æ’åœ¨ 15:00 å·¦å³é–‹å§‹ã€‚** è©³æƒ…è«‹è¦‹ã€Œæ—…éŠè³‡è¨Šã€é ç±¤ã€‚
                    </div>
                    <button class="btn-ai-guide" onclick="askGeminiGuide('ä¹å·è‡ªç„¶å‹•ç‰©å…¬åœ’', 'è«‹ç”¨èª‡å¼µæœ‰è¶£çš„èªæ°£ï¼Œå‘Šè¨´å­©å­ç­‰ä¸€ä¸‹æœƒçœ‹åˆ°ç…å­è€è™å°±åœ¨è»Šå­æ—é‚Šï¼Œä¸¦æé†’ä»–å€‘è¦æ³¨æ„çœ‹ä»€éº¼å‹•ç‰©çš„ç‰™é½’ã€‚')">
                        âœ¨ å•Ÿå‹•æ¢éšªæ¨¡å¼
                    </button>
                    <div class="tags"><span class="tag tag-kids">è¦ªå­å¿…éŠ</span><span class="tag tag-spot">å‹•ç‰©åœ’</span></div>
                </div>
                <div class="event">
                    <div class="time">16:30</div>
                    <div class="activity">å‰å¾€ç”±å¸ƒé™¢æº«æ³‰ (å±±ç‡ˆé¤¨)</div>
                    <div class="desc">è»Šç¨‹ç´„ 40åˆ†é˜ï¼Œå¤©è‰²å·²æš—ï¼Œè«‹å°å¿ƒé§•é§›ã€‚</div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Yufuin+Santoukan" target="_blank" class="btn-map">å°èˆªè‡³å±±ç‡ˆé¤¨</a>
                    <div class="tags"><span class="tag tag-move">ç§»å‹•</span><span class="tag tag-stay">ä½å®¿ç¢ºèª</span></div>
                </div>
                <div class="event event-meal">
                    <div class="time">18:30</div>
                    <div class="activity">æ™šé¤: æ—…é¤¨æœƒå¸­æ–™ç†</div>
                    <div class="desc">ç”±å¸ƒé™¢æ—…é¤¨è²»ç”¨é€šå¸¸åŒ…å«ç²¾ç·»çš„æ—¥å¼æœƒå¸­æ™šé¤ï¼Œè«‹ç›¡æƒ…äº«å—ï¼</div>
                    <div class="tags"><span class="tag tag-stay">æº«æ³‰æ—…é¤¨</span><span class="tag tag-food">å·²åŒ…å«</span></div>
                </div>
                <div class="event">
                    <div class="time">20:30</div>
                    <div class="activity">ç”±å¸ƒé™¢æº«æ³‰å€ æ‚ é–’æ•£æ­¥</div>
                    <div class="desc">
                        æ¹¯ä¹‹åªè¡—é“åº—å®¶å¤šå·²æ‰“çƒŠï¼Œä½†å¤œæ™šçš„ç”±å¸ƒé™¢å®‰éœä¸”æ˜Ÿç©ºæ¸…æ™°ã€‚å¯æ•£æ­¥è‡³é‡‘é±—æ¹–æ¬£è³å¤œè‰²ï¼Œæˆ–åœ¨æ—…é¤¨ä¼‘æ¯ã€‚
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Kinrin+Lake" target="_blank" class="btn-map">é‡‘é±—æ¹–æ–¹å‘å°èˆª</a>
                    <div class="tags"><span class="tag tag-relax">æ”¾é¬†</span></div>
                </div>
            </div>
        </div>

        <!-- Day 4 -->
        <div class="day-wrapper">
            <div class="day-toggle" id="toggle-d4" onclick="toggleTimeline('d4', this)">
                <div class="day-info">
                    <h3>Day 4: ç”±å¸ƒé™¢è‡³ç¦å²¡</h3>
                    <span>1/28 (ä¸‰) â€¢ ä½å®¿: ç¦å²¡ ä¼‘é›·å…‹è“‹ç‰¹</span>
                </div>
                <div class="toggle-icon">â–¼</div>
            </div>
            <div id="d4" class="timeline">
                <div class="event event-meal">
                    <div class="time">08:00</div>
                    <div class="activity">æ—©é¤: æ—…é¤¨å…§äº«ç”¨</div>
                    <div class="desc">äº«ç”¨ç”±å¸ƒé™¢æ—…é¤¨çš„è±ç››æ—©é¤ã€‚</div>
                    <div class="tags"><span class="tag tag-stay">æ—…é¤¨</span><span class="tag tag-food">å·²åŒ…å«</span></div>
                </div>
                <div class="event">
                    <div class="time">09:30</div>
                    <div class="activity">é‡‘é±—æ¹– & æ¹¯ä¹‹åªè¡—é“</div>
                    <div class="desc">æ™¨éœ§ç¾æ™¯ï¼Œè¡—é“ä¸Šæœ‰å²åŠªæ¯”èŒ¶å±‹ã€MiffyéºµåŒ…åº—ã€‚</div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Kinrin+Lake" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-kids">å¥½é€›</span></div>
                </div>
                
                <!-- COMICO ART MUSEUM INSERTED HERE -->
                <div class="event">
                    <div class="time">11:00</div>
                    <div class="activity">COMICO ART MUSEUM YUFUIN</div>
                    <div class="desc">
                        ç”±éšˆç ”å¾è¨­è¨ˆçš„ç¾ä»£ç¾è¡“é¤¨ï¼Œå±•å‡ºè‰é–“å½Œç”Ÿç­‰å¤§å¸«ä½œå“ï¼Œå»ºç¯‰èˆ‡ç”±å¸ƒå²³æ™¯è§€èåˆï¼Œéå¸¸å€¼å¾—ä¸€è¨ªã€‚
                        <span style="display:block; font-size: 0.8rem; color: #666; margin-top: 5px;">*å»ºè­°äº‹å…ˆä¸Šç¶²é ç´„è³¼ç¥¨ã€‚</span>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=COMICO+ART+MUSEUM+YUFUIN" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-spot">è—è¡“</span><span class="tag tag-spot">å»ºç¯‰</span></div>
                </div>

                <div class="event event-meal">
                    <div class="time">12:30</div>
                    <div class="activity">åˆé¤æ™‚æ®µï¼šç”±å¸ƒé™¢å¿…åƒé‡œé£¯</div>
                    <div class="desc">
                        <ul style="list-style-type: disc;">
                            <li><b>ç”±å¸ƒã¾ã¶ã— å¿ƒ (ç”±å¸ƒé‡œé£¯)ï¼šï¼š</b> è¶…äººæ°£æ’éšŠååº—ï¼Œæ¨è–¦è±å¾Œç‰›é‡œé£¯æˆ–åœ°é›é‡œé£¯ï¼Œä¸€é‹ä¸‰åƒï¼ˆåŸå‘³ã€åŠ ä½æ–™ã€èŒ¶æ³¡é£¯ï¼‰ã€‚å»ºè­°æå‰æ’éšŠæˆ–é¿é–‹å°–å³°ã€‚</li>
                            <li><b>æ¹¯ä¹‹åªè¡—é“å°åƒï¼šï¼š</b> è‹¥ä¸æƒ³ä¹…å€™ï¼Œå¯é¸æ“‡æ²¿è¡—åƒè±å¾Œç‰›ä¸²ç‡’ã€å¯æ¨‚é¤…ç­‰ã€‚</li>
                        </ul>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Yufu+Mabushi+Shin" target="_blank" class="btn-map">å°èˆªè‡³ç”±å¸ƒé‡œé£¯</a>
                    <div class="tags"><span class="tag tag-food">é¸æ“‡åˆé¤</span><span class="tag tag-spot">æ’éšŠç¾é£Ÿ</span></div>
                </div>
                <div class="event">
                    <div class="time">13:30</div>
                    <div class="activity">å‰å¾€ç¦å²¡å¸‚å€ (é–‹å§‹ç§»å‹•)</div>
                    <div class="desc">è¸ä¸Šå›ç¦å²¡çš„æ­¸é€”ï¼Œç¸½è»Šç¨‹ç´„ 2.5å°æ™‚ã€‚</div>
                    <div class="tags"><span class="tag tag-move">ç§»å‹•</span></div>
                </div>
                
                <!-- NEW STOP: YAMADA SA -->
                <div class="event">
                    <div class="time">14:40</div>
                    <div class="activity">ä¸­é€”ä¼‘æ¯ï¼šå±±ç”°æœå‹™å€ (Yamada SA)</div>
                    <div class="desc">
                        ä½æ–¼é«˜é€Ÿå…¬è·¯ä¸Šçš„å¤§å‹ä¼‘æ¯ç«™ï¼Œç’°å¢ƒå„ªç¾ï¼Œæœ‰éºµåŒ…åº—ã€è¾²ç”¢å“å’Œä¹¾æ·¨çš„æ´—æ‰‹é–“ã€‚é©åˆåœè»Šè®“å­©å­æ´»å‹•ç­‹éª¨ã€‚
                        <span style="display:block; font-size: 0.8rem; color: #666; margin-top: 5px;">*åœç•™ç´„ 20 åˆ†é˜ã€‚</span>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Yamada+Service+Area+Up+Line" target="_blank" class="btn-map">å°èˆªè‡³å±±ç”°SA</a>
                    <div class="tags"><span class="tag tag-relax">ä¼‘æ¯ç«™</span><span class="tag tag-food">è£œçµ¦</span></div>
                </div>
                
                <!-- èª¿æ•´çš„é‚„è»Šè¡Œç¨‹ -->
                <div class="event">
                    <div class="time">16:10</div>
                    <div class="activity">å¸‚å€åŠ æ²¹ (é‚„è»Šå‰æ»¿æ²¹)</div>
                    <div class="desc">
                        ä¾è¦å®šéœ€åŠ æ»¿æ²¹é‚„è»Šã€‚å»ºè­°å‰å¾€é™„è¿‘çš„åŠ æ²¹ç«™ã€‚
                    </div>
                    <a href="https://www.google.com/maps/search/gas+station+near+Toyota+Rent+a+Car+Hakata+Station+Hakata+Exit" target="_blank" class="btn-map">æœå°‹é™„è¿‘åŠ æ²¹ç«™</a>
                    <div class="tags"><span class="tag tag-car">åŠ æ²¹</span></div>
                </div>
                <div class="event">
                    <div class="time">16:30</div>
                    <div class="activity">æ­¸é‚„ç§Ÿè³ƒè»Šè¼› (Toyota åšå¤šé§…åšå¤šå£åº—)</div>
                    <div class="desc">
                        <b>é‚„è»Šé»ï¼š</b> Toyota Rent a Car åšå¤šé§…åšå¤šå£åº—ã€‚<br>
                        è«‹å‹™å¿…æ”œå¸¶åŠ æ²¹æ”¶æ“šä»¥ä¾›æŸ¥é©—ã€‚
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Toyota+Rent+a+Car+Hakata+Station+Hakata+Exit" target="_blank" class="btn-map">å°èˆªè‡³é‚„è»Šé»</a>
                    <div class="tags"><span class="tag tag-move">é‚„è»Š</span></div>
                </div>
                <!-- èª¿æ•´çµæŸ -->
                <div class="event">
                    <div class="time">18:00</div>
                    <div class="activity">é£¯åº— Check-in</div>
                    <div class="desc">æ—¥èˆªè¥¿éµ æˆ– ä¼‘é›·å…‹è“‹ç‰¹ã€‚</div>
                    <div class="tags"><span class="tag tag-stay">å¸‚å€é£¯åº—</span></div>
                </div>
                <div class="event event-meal">
                    <div class="time">20:00</div>
                    <div class="activity">æ™šé¤æ™‚æ®µï¼šç¦å²¡åœ¨åœ°ç¾é£Ÿé¸æ“‡</div>
                    <div class="desc">
                        <ul style="list-style-type: disc;">
                            <li><b>åšå¤šç‰›è…¸é‹ (ã‚‚ã¤é‹)ï¼šï¼š</b> å†¬å¤©å¿…åƒï¼Œæš–èƒƒã€‚å¯é¸åšå¤šç«™é™„è¿‘çŸ¥ååº—å®¶ã€‚</li>
                            <li><b>åšå¤šæ‹‰éºµï¼šï¼šï¼š</b> ä¸€è˜­æˆ–ä¸€é¢¨å ‚æœ¬åº—éƒ½åœ¨ç¦å²¡ã€‚</li>
                        </ul>
                    </div>
                    <div class="tags"><span class="tag tag-food">é¸æ“‡æ™šé¤</span></div>
                </div>
                <div class="event">
                    <div class="time">21:30</div>
                    <div class="activity">åšå¤šç«™å‘¨é‚Š å¤œé–“æ•£æ­¥/è£œè²¨</div>
                    <div class="desc">
                        é‚„è»Šå¾Œè¼•é¬†æ­ä¹˜å¤§çœ¾äº¤é€šå·¥å…·ã€‚å¯å‰å¾€åšå¤šé‹æ²³åŸï¼ˆæ°´èˆç§€ï¼‰æˆ–åœ¨é£¯åº—å‘¨é‚Šè—¥å¦åº—è£œçµ¦ã€‚
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Canal+City+Hakata" target="_blank" class="btn-map">é‹æ²³åŸå°èˆª</a>
                    <div class="tags"><span class="tag tag-kids">è³¼ç‰©</span><span class="tag tag-spot">å¤œæ™¯</span></div>
                </div>
            </div>
        </div>

        <!-- Day 5 -->
        <div class="day-wrapper">
            <div class="day-toggle" id="toggle-d5" onclick="toggleTimeline('d5', this)">
                <div class="day-info">
                    <h3>Day 5: å¤ªå®°åºœèˆ‡ç¦å²¡è³¼ç‰©</h3>
                    <span>1/29 (å››) â€¢ ä½å®¿: ç¦å²¡ ä¼‘é›·å…‹è“‹ç‰¹</span>
                </div>
                <div class="toggle-icon">â–¼</div>
            </div>
            <div id="d5" class="timeline">
                <div class="event event-meal">
                    <div class="time">09:00</div>
                    <div class="activity">æ—©é¤: é£¯åº—æˆ–åšå¤šç«™å…§</div>
                    <div class="desc">å¯æ–¼é£¯åº—äº«ç”¨ï¼Œæˆ–åœ¨åšå¤šç«™å…§é¸è³¼æ—¥å¼æ—©é¤æˆ–éºµåŒ…ã€‚</div>
                     <div class="tags"><span class="tag tag-food">é¸æ“‡æ—©é¤</span></div>
                </div>
                <div class="event">
                    <div class="time">09:30</div>
                    <div class="activity">å¤ªå®°åºœå¤©æ»¿å®®</div>
                    <div class="desc">æ­è¥¿éµå‰å¾€ã€‚å¿…åƒæ¢…æé¤…ï¼Œåƒè§€è¡¨åƒé“æ˜Ÿå·´å…‹ã€‚</div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Dazaifu+Tenmangu" target="_blank" class="btn-map">å°èˆª</a>
                </div>
                <div class="event event-meal">
                    <div class="time">12:30</div>
                    <div class="activity">åˆé¤æ™‚æ®µï¼šå¤ªå®°åºœå‘¨é‚Šé¸æ“‡</div>
                    <div class="desc">
                        <ul style="list-style-type: disc;">
                            <li><b>æ¢…æé¤…ï¼šï¼š</b> å¯ç•¶é»å¿ƒã€‚</li>
                            <li><b>å¤ªå®°åºœé£Ÿå ‚ï¼šï¼š</b> è¡¨åƒé“ä¸Šæœ‰å¤šå®¶çƒé¾éºµã€å®šé£Ÿé¤å»³ã€‚</li>
                        </ul>
                    </div>
                    <div class="tags"><span class="tag tag-food">é¸æ“‡åˆé¤</span></div>
                </div>
                <div class="event">
                    <div class="time">14:30</div>
                    <div class="activity">ä¹å·åœ‹ç«‹åšç‰©é¤¨</div>
                    <div class="desc">ä½æ–¼å¤ªå®°åºœæ—ï¼Œå£¯è§€çš„å»ºç¯‰èˆ‡å±•è¦½ã€‚</div>
                </div>
                <!-- å‚™æ¡ˆ -->
                <div class="event">
                    <div class="time">å‚™æ¡ˆ</div>
                    <div class="activity">ç¦å²¡éºµåŒ…è¶…äººå…’ç«¥åšç‰©é¤¨ (é›¨å¤©é¦–é¸)</div>
                    <div class="desc">
                        ä½æ–¼åšå¤šæ²³ç•”åŸ (Hakata Riverain) 5-6æ¨“ï¼Œèˆ‡åœ°éµã€Œä¸­æ´²å·ç«¯ã€ç«™ç›´çµã€‚
                        å®Œå…¨å®¤å…§ï¼Œé©åˆå­¸é½¡å‰å…’ç«¥æ”¾é›»ã€‚
                        <span style="display:block; font-size: 0.8rem; color: #666; margin-top: 5px;">*è©³æƒ…è«‹è¦‹ã€Œæ—…éŠè³‡è¨Šã€é ç±¤ã€‚</span>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Fukuoka+Anpanman+Children's+Museum" target="_blank" class="btn-map">å°èˆª</a>
                    <div class="tags"><span class="tag tag-kids">è¦ªå­å¿…éŠ</span><span class="tag tag-spot">å®¤å…§</span></div>
                </div>
                <!-- å‚™æ¡ˆçµæŸ -->

                <div class="event">
                    <div class="time">17:00</div>
                    <div class="activity">åšå¤šé‹æ²³åŸ / æ«›ç”°ç¥ç¤¾</div>
                    <div class="desc">è³¼ç‰©ä¸­å¿ƒæœ‰æ°´èˆç§€ (æ•´é»)ã€‚</div>
                    <div class="tags"><span class="tag tag-spot">è³¼ç‰©</span></div>
                </div>
                <div class="event event-meal">
                    <div class="time">20:00</div>
                    <div class="activity">æ™šé¤æ™‚æ®µï¼šå±‹å°é«”é©—æˆ–è³¼ç‰©ä¸­å¿ƒ</div>
                    <div class="desc">
                        <ul style="list-style-type: disc;">
                            <li><b>ä¸­æ´²å±‹å°ï¼š</b> é«”é©—ç¦å²¡çš„è·¯é‚Šæ”¤æ–‡åŒ– (è¦ªå­éœ€æ³¨æ„ç’°å¢ƒ)ã€‚</li>
                            <li><b>é‹æ²³åŸå…§é¤å»³ï¼š</b> é¸æ“‡å¤šæ¨£ï¼Œç”¨é¤ç’°å¢ƒè¼ƒèˆ’é©ã€‚</li>
                        </ul>
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=Nakasu+Yatai" target="_blank" class="btn-map">å±‹å°å°èˆª</a>
                    <div class="tags"><span class="tag tag-food">é¸æ“‡æ™šé¤</span></div>
                </div>
                <div class="event">
                    <div class="time">21:30</div>
                    <div class="activity">æœ€çµ‚è£œçµ¦èˆ‡å›æˆ¿æ•´ç†</div>
                    <div class="desc">
                        åœ¨ç¦å²¡å¸‚å€æ¡è²·æœ€å¾Œçš„ä¼´æ‰‹ç¦®å’Œè—¥å¦ï¼Œä¸¦æå‰æ•´ç†è¡Œæã€‚
                    </div>
                    <div class="tags"><span class="tag tag-kids">è³¼ç‰©</span><span class="tag tag-relax">æº–å‚™è¿”ç¨‹</span></div>
                </div>
            </div>
        </div>

        <!-- Day 6 -->
        <div class="day-wrapper">
            <div class="day-toggle" id="toggle-d6" onclick="toggleTimeline('d6', this)">
                <div class="day-info">
                    <h3>Day 6: è³¼ç‰©èˆ‡è¿”ç¨‹</h3>
                    <span>1/30 (äº”) â€¢ æº«æš–çš„å®¶</span>
                </div>
                <div class="toggle-icon">â–¼</div>
            </div>
            <div id="d6" class="timeline">
                <div class="event event-meal">
                    <div class="time">09:00</div>
                    <div class="activity">æ—©é¤: é£¯åº—æˆ–åšå¤šç«™å…§</div>
                    <div class="desc">æœ€å¾Œä¸€å€‹æ—©æ™¨ï¼Œè¼•é¬†ç”¨é¤ã€‚</div>
                     <div class="tags"><span class="tag tag-food">é¸æ“‡æ—©é¤</span></div>
                </div>
                <div class="event">
                    <div class="time">10:00</div>
                    <div class="activity">å‰å¾€ LaLaport ç¦å²¡</div>
                    <div class="desc">
                        ç¦å²¡æœ€æ–°å¤§å‹è³¼ç‰©ä¸­å¿ƒï¼Œå¿…çœ‹ <b>1:1 å¯¦é«”å¤§é‹¼å½ˆç«‹åƒ</b>ï¼
                        å•†å ´å…§é‚„æœ‰ KidZania (éœ€é ç´„) å’Œè±å¯Œçš„å…’ç«¥éŠæ¨‚è¨­æ–½ã€‚
                        <span style="display:block; font-size: 0.8rem; color: #666; margin-top: 5px;">*äº¤é€šï¼šå¾åšå¤šç«™æ­ä¹˜å·´å£«æˆ– JR å‰å¾€ç«¹ä¸‹ç«™ã€‚</span>
                    </div>
                    <button class="btn-ai-guide" onclick="askGeminiGuide('RX-93ff Î½é‹¼å½ˆ', 'ç°¡å–®ä»‹ç´¹é€™å€‹å·¨å¤§çš„æ©Ÿå™¨äººæœ‰å¤šé«˜ï¼ˆç”¨å¹¾å±¤æ¨“æ¯”å–»ï¼‰ï¼Œä»¥åŠä»–ç‚ºä»€éº¼è¦ç«™åœ¨é€™è£¡ä¿è­·å¤§å®¶ã€‚')">
                        âœ¨ ä»‹ç´¹å·¨å‹æ©Ÿå™¨äºº
                    </button>
                     <a href="https://www.google.com/maps/search/?api=1&query=LaLaport+Fukuoka" target="_blank" class="btn-map">å°èˆªè‡³ LaLaport</a>
                    <div class="tags"><span class="tag tag-spot">é‹¼å½ˆ</span><span class="tag tag-kids">è¦ªå­å¿…éŠ</span><span class="tag tag-shop">è³¼ç‰©</span></div>
                </div>
                <div class="event event-meal">
                    <div class="time">12:30</div>
                    <div class="activity">åˆé¤æ™‚æ®µï¼šLaLaport ç¾é£Ÿè¡—</div>
                    <div class="desc">
                        ç¾é£Ÿè¡—é¸æ“‡éå¸¸å¤šæ¨£ï¼Œæœ‰ä¹å·åœ¨åœ°ç¾é£Ÿä¹Ÿæœ‰çŸ¥åé€£é–åº—ï¼Œç’°å¢ƒå¯¬æ•é©åˆè¦ªå­ã€‚
                    </div>
                    <div class="tags"><span class="tag tag-food">é¸æ“‡åˆé¤</span></div>
                </div>
                <div class="event">
                    <div class="time">14:30</div>
                    <div class="activity">è¿”å›åšå¤šç«™ & AMU PLAZA ä¼´æ‰‹ç¦®æ¡è²·</div>
                    <div class="desc">
                         å›åˆ°åšå¤šç«™é ˜å–è¡Œæå‰ï¼Œå‹™å¿…åœ¨ **AMU PLAZA** æˆ– **Ming** å•†åº—è¡—æ¡è³¼æœ€å¾Œçš„ä¼´æ‰‹ç¦®ï¼(è©³è¦‹æ—…éŠè³‡è¨Š)
                    </div>
                    <a href="https://www.google.com/maps/search/?api=1&query=AMU+PLAZA+Hakata" target="_blank" class="btn-map">å°èˆªè‡³ AMU PLAZA</a>
                    <div class="tags"><span class="tag tag-shop">ä¼´æ‰‹ç¦®</span><span class="tag tag-move">ç§»å‹•</span></div>
                </div>
                <div class="event">
                    <div class="time">16:00</div>
                    <div class="activity">å‰å¾€ç¦å²¡æ©Ÿå ´ (FUK)</div>
                    <div class="desc">æ­ä¹˜åœ°éµç©ºæ¸¯ç·šï¼Œç´„ 5-10 åˆ†é˜å³å¯æŠµé”æ©Ÿå ´ã€‚</div>
                </div>
                <div class="event">
                    <div class="time">19:10</div>
                    <div class="activity">ç­æ©Ÿèµ·é£›</div>
                    <div class="desc">æ˜Ÿå®‡èˆªç©º å¾€å°åŒ— (TPE)ã€‚</div>
                    <div class="tags"><span class="tag tag-move">è¿”ç¨‹</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 2: ä½å®¿è³‡è¨Š (Updated Day 3) -->
    <div id="view-stay" class="container">
        
        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 1: ç†Šæœ¬ - THE BLOSSOM</div>
                <div class="tag tag-stay">è»Šç«™ç›´çµ</div>
            </div>
            
            <div class="stay-card-grid">
                <div class="stay-row">
                    <div class="stay-label">
                        <svg class="icon-mini" style="color:#6B7280"><use href="#icon-loc"></use></svg> åœ°å€
                    </div>
                    <div class="stay-val">
                        <span>ç†Šæœ¬çœŒç†Šæœ¬å¸‚è¥¿åŒºæ˜¥æ—¥3-15-26</span>
                        <button class="btn-copy-small" onclick="copyText(this, 'ç†Šæœ¬çœŒç†Šæœ¬å¸‚è¥¿åŒºæ˜¥æ—¥3-15-26')">
                            <svg class="icon-mini" style="width:12px;height:12px;"><path d="M8 2h8a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
                            è¤‡è£½
                        </button>
                    </div>
                </div>
                <div class="stay-row">
                    <div class="stay-label">
                        <svg class="icon-mini" style="color:#6B7280"><use href="#icon-consult"></use></svg> é›»è©±
                    </div>
                    <div class="stay-val">
                        <a href="tel:0963278777" style="color:#2563EB; text-decoration:none;">096-327-8777</a>
                    </div>
                </div>
                <div class="stay-row">
                    <div class="stay-label">
                        <svg class="icon-mini" style="color:#D97706"><use href="#icon-car"></use></svg> MapCode
                    </div>
                    <div class="stay-val">
                        <span class="map-code-box">29 459 270*76</span>
                    </div>
                </div>
            </div>

            <div class="info-detail-box" style="margin-top: 15px; border-color: #BFDBFE; background-color: #EFF6FF;">
                <h4 style="color: #1D4ED8;">âœ¨ ç‰¹è‰²èˆ‡æ³¨æ„</h4>
                <ul style="padding-left: 20px; font-size: 0.9rem; margin-top:5px; color:#444;">
                    <li><b>ä½ç½®ï¼š</b>JRç†Šæœ¬ç«™æ— AMU PLAZA æ¨“ä¸Š (9Få¤§å»³)ã€‚</li>
                    <li><b>åœè»Šï¼š</b>è«‹åœ AMU PLAZA åœ°ä¸‹åœè»Šå ´ (ä½å®¢å„ªæƒ ç´„ Â¥1,000)ï¼Œå°‡åœè»Šåˆ¸å¸¶è‡³æ«ƒå°ã€‚</li>
                    <li><b>è¨­æ–½ï¼š</b>å¤§æµ´å ´ä½æ–¼ 9Fï¼Œæˆ¿å¡æ„Ÿæ‡‰é€²å…¥ã€‚</li>
                </ul>
            </div>

            <a href="https://www.google.com/maps/search/?api=1&query=THE+BLOSSOM+KUMAMOTO" target="_blank" class="btn-nav-large">
                <svg class="icon-mini" style="width:20px;height:20px;color:white;"><use href="#icon-nav-arrow"></use></svg>
                å•Ÿå‹• Google å°èˆª
            </a>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 2: é»‘å·æº«æ³‰ - éº“æ—…é¤¨</div>
                <div class="tag tag-stay">å‚³çµ±æ—¥å¼</div>
            </div>
            
            <div class="stay-card-grid">
                <div class="stay-row">
                    <div class="stay-label">
                        <svg class="icon-mini" style="color:#6B7280"><use href="#icon-loc"></use></svg> åœ°å€
                    </div>
                    <div class="stay-val">
                        <span>ç†Šæœ¬çœŒé˜¿è˜‡éƒ¡å—å°å›½ç”ºæº€é¡˜å¯º6618</span>
    <button class="btn-copy-small" onclick="copyText(this, 'ç†Šæœ¬çœŒé˜¿è˜‡éƒ¡å—å°å›½ç”ºæº€é¡˜å¯º6618')">
        <svg class="icon-mini" style="width:12px;height:12px;"><path d="M8 2h8a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
        è¤‡è£½
    </button>
</div>
                </div>
                <div class="stay-row">
                    <div class="stay-label">é›»è©±</div>
                    <div class="stay-val">
                        <a href="tel:0967440103" style="color:#2563EB; text-decoration:none;">0967-44-0103</a>
                    </div>
                </div>
                <div class="stay-row">
                    <div class="stay-label">MapCode</div>
                    <div class="stay-val">
                        <span class="map-code-box">440 542 454*47</span>
                    </div>
                </div>
            </div>

            <div class="info-detail-box" style="margin-top: 15px; border-color: #FCD34D; background-color: #FFFBEB;">
                <h4 style="color: #B45309;">âš ï¸ æ³¨æ„äº‹é …</h4>
                <ul style="padding-left: 20px; font-size: 0.9rem; margin-top:5px; color:#444;">
                    <li><b>æŠµé”ï¼š</b>æº«æ³‰è¡—é“è·¯æ¥µç‹¹çª„ï¼Œå¼·çƒˆå»ºè­°å¤©é»‘å‰æŠµé”ã€‚</li>
                    <li><b>è¡Œæï¼š</b>é¤¨å…§ç‚ºå¤è€å»ºç¯‰ï¼Œæ¨“æ¢¯å¤šä¸”é™¡ï¼Œå»ºè­°æ”œå¸¶è¼•ä¾¿éå¤œåŒ…ï¼Œå¤§è¡Œæç•™è»Šä¸Šã€‚</li>
                    <li><b>æº«æ³‰ï¼š</b>æ“æœ‰ 15 å€‹æ¹¯æ±  (å«è²¸åˆ‡é¢¨å‘‚)ï¼Œç„¡éœ€é ç´„ï¼Œçœ‹ç‡ˆè™Ÿä½¿ç”¨ã€‚</li>
                </ul>
            </div>

            <a href="https://www.google.com/maps/search/?api=1&query=Fumoto+Ryokan+Kurokawa" target="_blank" class="btn-nav-large" style="background: linear-gradient(135deg, #D97706, #B45309);">
                <svg class="icon-mini" style="width:20px;height:20px;color:white;"><use href="#icon-nav-arrow"></use></svg>
                å•Ÿå‹• Google å°èˆª
            </a>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 3: ç”±å¸ƒé™¢ - æ¹¯å¸ƒé™¢å±±ç‡ˆèˆ˜</div>
                <div class="tag tag-stay">é‡‘é±—æ¹–æ—</div>
            </div>
            
            <div class="stay-card-grid">
                <div class="stay-row">
                    <div class="stay-label">
                        <svg class="icon-mini" style="color:#6B7280"><use href="#icon-loc"></use></svg> åœ°å€
                    </div>
                    <div class="stay-val">
                        <span>å¤§åˆ†çœŒç”±å¸ƒå¸‚æ¹¯å¸ƒé™¢ç”ºå·ä¸Š1553</span>
    <button class="btn-copy-small" onclick="copyText(this, 'å¤§åˆ†çœŒç”±å¸ƒå¸‚æ¹¯å¸ƒé™¢ç”ºå·ä¸Š1553')">
        <svg class="icon-mini" style="width:12px;height:12px;"><path d="M8 2h8a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
        è¤‡è£½
    </button>
</div>
                </div>
                <div class="stay-row">
                    <div class="stay-label">é›»è©±</div>
                    <div class="stay-val">
                        <a href="tel:0977845310" style="color:#2563EB; text-decoration:none;">0977-84-5310</a>
                    </div>
                </div>
                <div class="stay-row">
                    <div class="stay-label">MapCode</div>
                    <div class="stay-val">
                        <span class="map-code-box">269 359 525*30</span>
                    </div>
                </div>
            </div>

            <div class="info-detail-box" style="margin-top: 15px; border-color: #A7F3D0; background-color: #ECFDF5;">
                <h4 style="color: #047857;">âœ¨ ä½å®¿é‡é»</h4>
                <ul style="padding-left: 20px; font-size: 0.9rem; margin-top:5px; color:#444;">
                    <li><b>æ™šé¤ï¼š</b>åŒ…å«ç²¾ç·»æ‡·çŸ³æ–™ç†ï¼Œè«‹å‹™å¿…æ–¼ 17:30 å‰æŠµé”è¾¦ç†å…¥ä½ã€‚</li>
                    <li><b>æ™¨é–“ï¼š</b>èµ°è·¯ 2 åˆ†é˜å³é”é‡‘é±—æ¹–ï¼Œå¿…çœ‹æ¸…æ™¨éœ§æ°£ç¾æ™¯ã€‚</li>
                    <li><b>è¨­æ–½ï¼š</b>å…¨é¤¨æªœæœ¨é€ ï¼Œéš”éŸ³è¼ƒå¼±ï¼Œå¤œé–“è«‹æ”¾è¼•è…³æ­¥ã€‚</li>
                </ul>
            </div>

            <a href="https://www.google.com/maps/search/?api=1&query=Yufuin+Santoukan" target="_blank" class="btn-nav-large" style="background: linear-gradient(135deg, #059669, #047857);">
                <svg class="icon-mini" style="width:20px;height:20px;color:white;"><use href="#icon-nav-arrow"></use></svg>
                å•Ÿå‹• Google å°èˆª
            </a>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 4-5: ç¦å²¡ - THE GATE HOTEL</div>
                <div class="tag tag-stay">å¤©ç¥ç«™ç›´çµ</div>
            </div>
            
            <div class="stay-card-grid">
                <div class="stay-row">
                    <div class="stay-label">
                        <svg class="icon-mini" style="color:#6B7280"><use href="#icon-loc"></use></svg> åœ°å€
                    </div>
                    <div class="stay-val">
                        <span>ç¦å²¡çœŒç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥2-8-49</span>
    <button class="btn-copy-small" onclick="copyText(this, 'ç¦å²¡çœŒç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥2-8-49')">
        <svg class="icon-mini" style="width:12px;height:12px;"><path d="M8 2h8a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
        è¤‡è£½
    </button>
</div>
                </div>
                <div class="stay-row">
                    <div class="stay-label">é›»è©±</div>
                    <div class="stay-val">
                        <a href="tel:0924062605" style="color:#2563EB; text-decoration:none;">092-406-2605</a>
                    </div>
                </div>
                <div class="stay-row">
                    <div class="stay-label">MapCode</div>
                    <div class="stay-val">
                        <span class="map-code-box">13 317 683*55</span>
                    </div>
                </div>
            </div>

            <div class="info-detail-box" style="margin-top: 15px; border-color: #F472B6; background-color: #FFF1F2;">
                <h4 style="color: #BE185D;">âœ¨ ç‰¹è‰² (THE GATE HOTEL by HULIC)</h4>
                <ul style="padding-left: 20px; font-size: 0.9rem; margin-top:5px; color:#444;">
                    <li><b>ä½ç½®ï¼š</b>å¤©ç¥æ ¸å¿ƒåœ°å¸¶ï¼Œåœ°éµå¤©ç¥ç«™ Exit 5 ç›´çµã€‚</li>
                    <li><b>æ™¯è§€ï¼š</b>å¤§å»³ä½æ–¼ 19 æ¨“ï¼Œè¦–é‡æ¥µä½³ã€‚</li>
                    <li><b>ç¦®é‡ï¼š</b>13 æ¨“è¨­æœ‰æˆ¿å®¢å°ˆå±¬ Lounge (6:00-24:00)ï¼Œæä¾›å…è²»é£²æ–™èˆ‡éœ²å°åº§ä½ã€‚</li>
                </ul>
            </div>

            <div class="info-detail-box" style="margin-top: 10px; border-color: #FCA5A5; background-color: #FEF2F2;">
                <h4 style="color: #991B1B;">âš ï¸ è‡ªé§•é‡è¦æ³¨æ„äº‹é … (ç„¡åœè»Šå ´)</h4>
                <ul style="padding-left: 20px; font-size: 0.9rem; margin-top:5px; color:#444;">
                    <li><b>ç„¡åœè»Šå ´ï¼š</b>é£¯åº—æœ¬èº«**æ²’æœ‰**åœè»Šå ´ã€‚</li>
                    <li><b>æ¨è–¦åœè»Šï¼š</b>è«‹åœæ”¾æ–¼é™„è¿‘çš„ <b>Solaria Terminal Parking (ã‚½ãƒ©ãƒªã‚¢ã‚¿ãƒ¼ãƒŸãƒŠãƒ«é§è»Šå ´)</b>ã€‚
                        <br><span style="font-size:0.85rem; color:#666;">(å°èˆªé›»è©±: 092-721-6821)</span>
                    </li>
                    <li><b>è²»ç”¨ï¼š</b>éå¤œè²»ç”¨ç´„ Â¥2,000-Â¥3,000ï¼Œç„¡é£¯åº—è£œåŠ©ã€‚</li>
                </ul>
            </div>

            <a href="https://www.google.com/maps/search/?api=1&query=THE+GATE+HOTEL+Fukuoka+by+HULIC" target="_blank" class="btn-nav-large" style="background: linear-gradient(135deg, #DB2777, #BE185D);">
                <svg class="icon-mini" style="width:20px;height:20px;color:white;"><use href="#icon-nav-arrow"></use></svg>
                å•Ÿå‹• Google å°èˆª
            </a>
        </div>
        
    </div>

    <!-- TAB 3: äº¤é€šè³‡è¨Š -->
    <div id="view-car" class="container">
        <!-- èˆªç­è³‡è¨Š -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">èˆªç­è³‡è¨Š (ç†Šæœ¬é€²/ç¦å²¡å‡º)</div>
                <div class="tag tag-flight">æ˜Ÿå®‡èˆªç©º</div>
            </div>
            <div class="info-detail-box">
                <h4>å»ç¨‹ï¼š1/25 å°åŒ—(TPE) â†’ ç†Šæœ¬(KMJ)</h4>
                <div class="info-grid">
                    <div class="info-label">ç­æ¬¡åƒè€ƒ</div>
                    <div class="info-val">JX846</div>
                </div>
                <div class="info-grid">
                    <div class="info-label">èµ·é£›æ™‚é–“</div>
                    <div class="info-val">07:30 (TPE)</div>
                </div>
                <div class="info-grid">
                    <div class="info-label">èµ·é£›èˆªå»ˆ</div>
                    <div class="info-val">TPE T2 (æ¡ƒåœ’æ©Ÿå ´ç¬¬äºŒèˆªå»ˆ)</div>
                </div>
                <div class="info-grid">
                    <div class="info-label">æŠµé”æ™‚é–“</div>
                    <div class="info-val">11:00 (KMJ ç•¶åœ°æ™‚é–“)</div>
                </div>
                <div class="info-grid">
                    <div class="info-label">æŠµé”èˆªå»ˆ</div>
                    <div class="info-val">KMJ åœ‹éš›ç·šèˆªå»ˆ</div>
                </div>
            </div>
            <div class="info-detail-box" style="margin-top: 15px;">
                <h4>å›ç¨‹ï¼š1/30 ç¦å²¡(FUK) â†’ å°åŒ—(TPE)</h4>
                <div class="info-grid">
                    <div class="info-label">ç­æ¬¡åƒè€ƒ</div>
                    <div class="info-val">JX847</div>
                </div>
                <div class="info-grid">
                    <div class="info-label">èµ·é£›æ™‚é–“</div>
                    <div class="info-val">19:10 (FUK ç•¶åœ°æ™‚é–“)</div>
                </div>
                <div class="info-grid">
                    <div class="info-label">èµ·é£›èˆªå»ˆ</div>
                    <div class="info-val">FUK åœ‹éš›ç·šèˆªå»ˆ</div>
                </div>
                <div class="info-grid">
                    <div class="info-label">æŠµé”æ™‚é–“</div>
                    <div class="info-val">20:40 (TPE ç•¶åœ°æ™‚é–“)</div>
                </div>
                <div class="info-grid">
                    <div class="info-label">æŠµé”èˆªå»ˆ</div>
                    <div class="info-val">TPE T2 (æ¡ƒåœ’æ©Ÿå ´ç¬¬äºŒèˆªå»ˆ)</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="card-title">ç§Ÿè»Šè³‡è¨Š (Day 2-4)</div>
                <div class="tag tag-car">Toyota</div>
            </div>
            <div class="info-grid">
                <div class="info-label">ç§Ÿè»Šå…¬å¸</div>
                <div class="info-val">Toyota Rent a Car</div>
            </div>
            <div class="info-grid">
                <div class="info-label">å–è»Šåœ°é»</div>
                <div class="info-val">é˜¿è˜‡ç«™å‰åº—</div>
            </div>
            <div class="info-grid">
                <div class="info-label">é‚„è»Šåœ°é»</div>
                <div class="info-val">åšå¤šé§…åšå¤šå£åº—</div>
            </div>
            <div class="info-grid">
                <div class="info-label">å°èˆªé›»è©±</div>
                <div class="info-val">092-441-0100</div>
            </div>
            <a href="https://www.google.com/maps/search/?api=1&query=Toyota+Rent+a+Car+é˜¿è˜‡é§…å‰åº—" target="_blank" class="btn-link">å°èˆªè‡³å–è»Šé»</a>
            <a href="https://www.google.com/maps/search/?api=1&query=Toyota+Rent+a+Car+Hakata+Station+Hakata+Exit" target="_blank" class="btn-link" style="margin-top: 5px;">å°èˆªè‡³é‚„è»Šé»</a>
        </div>
        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 2 (1/26) å¿…æ­ï¼šé˜¿è˜‡ç”·å­©!</div>
                <div class="tag tag-move">è§€å…‰åˆ—è»Š</div>
            </div>
             <div class="info-grid">
                <div class="info-label">è»Šæ¬¡</div>
                <div class="info-val">ASO BOY! 1è™Ÿ</div>
            </div>
            <div class="info-grid">
                <div class="info-label">å€é–“</div>
                <div class="info-val">ç†Šæœ¬ (09:57) â†’ é˜¿è˜‡ (11:27)</div>
            </div>
            
            <div class="info-detail-box">
                <h4>ğŸ¶ åˆ—è»Šå‰ç¥¥ç‰©ï¼šå°é»‘ KURO</h4>
                <p style="font-size: 0.9rem;">KURO æ˜¯é˜¿è˜‡ç”·å­©çš„çœ‹æ¿çŠ¬ï¼Œè»Šå…§å¤–å…±æœ‰**101éš»ä¸åŒé€ å‹çš„ KURO åœ–æ¡ˆ**ï¼Œå¯ä»¥è®“å­©å­å€‘å°‹æ‰¾ï¼Œå¢æ·»æ—…é€”æ¨‚è¶£ï¼</p>
                <p style="font-size: 0.8rem; color: #9CA3AF; margin-top: 5px;"></p>
            </div>
            
            <div class="info-detail-box" style="margin-top: 15px;">
                <h4>ğŸ‰ è¦ªå­å¨›æ¨‚è¨­æ–½ (ç¬¬3ç¯€è»Šå»‚)</h4>
                <p style="font-size: 0.9rem; margin-bottom: 5px;">
                    ç¬¬3ç¯€è»Šå»‚å¾Œæ–¹æ˜¯å…’ç«¥å°ˆå±¬ç©ºé–“ï¼Œè¨­æœ‰**æœ¨çƒæ± **ï¼ˆè«‹æ³¨æ„é–‹æ”¾æ™‚é–“ï¼‰å’Œ**å…’ç«¥åœ–æ›¸å®¤**ã€‚
                </p>
                <p style="font-size: 0.9rem; margin-bottom: 5px;">
                    æ­¤å¤–ï¼Œé‚„æœ‰**å“ºä¹³å®¤**å’Œå¤šåŠŸèƒ½å»æ‰€ï¼Œç¢ºä¿å¸¶è‘—å°å°å­©çš„å®¶é•·ä¹Ÿèƒ½èˆ’é©æ­ä¹˜ã€‚
                </p>
            </div>
            
            <div class="info-detail-box" style="margin-top: 15px;">
                <h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ç¨ç‰¹å…¨æ™¯å¸­ä½</h4>
                <p style="font-size: 0.9rem; margin-bottom: 5px;">
                    **æ™¯è§€è»Šå»‚ (ç¬¬1å’Œç¬¬4ç¯€)**ï¼šè¨­æœ‰å…¨æ™¯å¤§çª—æˆ¶ï¼Œè¦–é‡çµ•ä½³ï¼Œèƒ½æ¬£è³é˜¿è˜‡æ²¿ç·šé¢¨æ™¯ã€‚
                </p>
                <p style="font-size: 0.9rem;">
                    **è¦ªå­åº§ä½ (White Seats)**ï¼šæœ‰é¢å°é¢ã€é™„æ¡Œå­çš„åº§ä½ï¼Œéå¸¸é©åˆå®¶åº­ç”¨é¤æˆ–äº’å‹•ï¼Œæ˜¯é è¨‚æ™‚çš„é¦–é¸ï¼
                </p>
            </div>
        </div>

        <!-- [æ–°å¢] Map Code ä¸€è¦½è¡¨ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title" style="display: flex; align-items: center; gap: 6px;">
                    <svg class="icon-mini" style="color: var(--primary);"><use href="#icon-loc"></use></svg>
                    è¡Œç¨‹æ™¯é» Map Code ä¸€è¦½
                </div>
                <div class="tag tag-car">è»Šæ©Ÿå°èˆª</div>
            </div>
            
            <div class="info-section" style="background-color: #F3F4F6; border-color: #9CA3AF;">
                <p style="font-size: 0.85rem; color: #4B5563; margin-bottom: 10px;">
                    ğŸ’¡ <b>ä½¿ç”¨å°æ’‡æ­¥ï¼š</b>æ—¥æœ¬è»Šè¼‰å°èˆªè¼¸å…¥ Map Code æœ€ç‚ºç²¾æº–ã€‚è‹¥ Map Code æŸ¥ç„¡åœ°é»ï¼Œä½¿ç”¨ä¸‹æ–¹æä¾›çš„<b>é›»è©±è™Ÿç¢¼ (Tel)</b> å°èˆªæ˜¯æœ€ä½³å‚™æ¡ˆã€‚
                </p>

                <!-- ç†Šæœ¬å€åŸŸ -->
                <h4 style="color: #3B82F6; margin: 15px 0 5px 0; border-left: 4px solid #3B82F6; padding-left: 8px;">ğŸ» ç†Šæœ¬å€åŸŸ (Day 1-2)</h4>
                <div class="price-table" style="grid-template-columns: 1.5fr 1fr;">
                    <div class="price-item" style="font-weight:600;">æ™¯é»åç¨±</div>
                    <div class="price-item" style="font-weight:600; font-family:monospace;">Map Code / Tel</div>

                    <div class="price-item">ç†Šæœ¬æ©Ÿå ´ (KMJ)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#2563EB; font-weight:600;">29 434 250*85</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 096-232-2810</div>
                    </div>

                    <div class="price-item">ç†Šæœ¬ç«™ (The Blossom)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#2563EB; font-weight:600;">29 459 270*76</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 096-327-8777</div>
                    </div>

                    <div class="price-item">æ«»ä¹‹é¦¬å ´ åŸå½©è‹‘</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#2563EB; font-weight:600;">29 489 328*36</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 096-288-5600</div>
                    </div>
                </div>

                <!-- é˜¿è˜‡/é»‘å·å€åŸŸ -->
                <h4 style="color: #10B981; margin: 20px 0 5px 0; border-left: 4px solid #10B981; padding-left: 8px;">â›°ï¸ é˜¿è˜‡èˆ‡é»‘å· (Day 2-3)</h4>
                <div class="price-table" style="grid-template-columns: 1.5fr 1fr;">
                    <div class="price-item">Toyota ç§Ÿè»Š (é˜¿è˜‡ç«™å‰)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#059669; font-weight:600;">256 386 414*43</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0967-35-5100</div>
                    </div>

                    <div class="price-item">è‰åƒé‡Œ (é˜¿è˜‡ç«å±±åšç‰©é¤¨)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#059669; font-weight:600;">256 456 833*60</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0967-34-2111</div>
                    </div>

                    <div class="price-item">å¤§è§€å³°å±•æœ›æ‰€</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#059669; font-weight:600;">256 688 642*31</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0967-32-3856</div>
                    </div>

                    <div class="price-item">é»‘å·æº«æ³‰ (éŠå®¢ä¸­å¿ƒ)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#059669; font-weight:600;">440 542 567*14</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0967-44-0076</div>
                    </div>
                </div>

                <!-- åˆ¥åºœ/ç”±å¸ƒé™¢å€åŸŸ -->
                <h4 style="color: #F59E0B; margin: 20px 0 5px 0; border-left: 4px solid #F59E0B; padding-left: 8px;">â™¨ï¸ åˆ¥åºœèˆ‡ç”±å¸ƒé™¢ (Day 3-4)</h4>
                <div class="price-table" style="grid-template-columns: 1.5fr 1fr;">
                    <div class="price-item">åˆ¥åºœ æµ·åœ°ç„</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#D97706; font-weight:600;">46 521 440*43</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0977-66-0121</div>
                    </div>

                    <div class="price-item">ä¹å·è‡ªç„¶å‹•ç‰©å…¬åœ’</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#D97706; font-weight:600;">46 434 225*85</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0978-48-2331</div>
                    </div>

                    <div class="price-item">ç”±å¸ƒé™¢è»Šç«™</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#D97706; font-weight:600;">269 357 442*11</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0977-84-2446</div>
                    </div>

                    <div class="price-item">é‡‘é±—æ¹– (é™„è¿‘åœ°æ¨™)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#D97706; font-weight:600;">269 359 586*66</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0977-28-8500</div>
                    </div>
                </div>

                <!-- ç¦å²¡å€åŸŸ -->
                <h4 style="color: #EF4444; margin: 20px 0 5px 0; border-left: 4px solid #EF4444; padding-left: 8px;">ğŸœ ç¦å²¡èˆ‡å¤ªå®°åºœ (Day 4-6)</h4>
                <div class="price-table" style="grid-template-columns: 1.5fr 1fr;">
                    <!-- æ–°å¢å±±ç”°ä¼‘æ¯ç«™ -->
                    <div class="price-item">å±±ç”°æœå‹™å€ (å¾€ç¦å²¡)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#DC2626; font-weight:600;">55 136 580*55</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 0946-52-3103</div>
                    </div>

                    <div class="price-item">Toyota ç§Ÿè»Š (åšå¤šç«™)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#DC2626; font-weight:600;">13 320 644*85</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 092-441-0100</div>
                    </div>

                    <div class="price-item">å¤ªå®°åºœå¤©æ»¿å®® (åœè»Šå ´)</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#DC2626; font-weight:600;">55 364 046*12</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 092-922-8225</div>
                    </div>

                    <div class="price-item">ä¹å·åœ‹ç«‹åšç‰©é¤¨</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#DC2626; font-weight:600;">55 334 895*88</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 092-918-2807</div>
                    </div>
                    
                    <div class="price-item">LaLaport ç¦å²¡</div>
                    <div class="price-item">
                        <div style="font-family:monospace; color:#DC2626; font-weight:600;">13 133 766*55</div>
                        <div style="font-size:0.85rem; color:#666; margin-top:2px;">Tel: 092-707-9820</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- [æ–°å¢çµæŸ] -->

        <div class="card">
            <div class="card-header">
                <div class="card-title">ğŸ‡¯ğŸ‡µ è‡ªé§•èˆ‡åŠ æ²¹é ˆçŸ¥</div>
                <div class="tag tag-car">å¿…è®€</div>
            </div>
            
            <div class="info-section" style="margin-bottom: 15px;">
                <h3 style="color: var(--primary); border-bottom-color: var(--primary);">ğŸš— è‡ªé§•é‡é»æç¤º</h3>
                <ul style="padding-left: 20px; font-size: 0.9rem; line-height: 1.6; color: #444;">
                    <li><b>é å·¦è¡Œé§›ï¼š</b>æ—¥æœ¬ç‚ºå³é§•å·¦è¡Œï¼Œé›¨åˆ·å’Œæ–¹å‘ç‡ˆä½ç½®é€šå¸¸èˆ‡å°ç£ç›¸åï¼ˆé›¨åˆ·åœ¨å·¦ï¼Œæ–¹å‘ç‡ˆåœ¨å³ï¼‰ã€‚è½‰å½æ™‚è«‹å£è¨£é»˜å”¸ã€Œå·¦å°åœˆã€å³å¤§åœˆã€ã€‚</li>
                    <li><b>ç¦®è®“è¡Œäººï¼š</b>è½‰å½é‡æ–‘é¦¬ç·šæœ‰è¡Œäººæ™‚ï¼Œ**å¿…é ˆå®Œå…¨åœè»Š**ç¦®è®“ã€‚</li>
                    <li><b>åœæ­¢æ¨™èªŒ (æ­¢ã¾ã‚Œ)ï¼š</b>çœ‹åˆ°å€’ä¸‰è§’å½¢ç´…è‰²æ¨™èªŒï¼Œè»Šè¼ªå¿…é ˆ**å®Œå…¨éœæ­¢**ï¼ˆæ•¸3ç§’ï¼‰ç¢ºèªç„¡è»Šå¾Œå†é–‹ï¼Œé€™æ˜¯æ—¥æœ¬è­¦å¯Ÿå–ç· é‡é»ã€‚</li>
                    <li><b>å¹³äº¤é“ï¼š</b>é€šéå‰å¿…é ˆ**å®Œå…¨åœè»Š**ï¼Œé–‹çª—è½è²éŸ³ç¢ºèªç„¡ç«è»Šå¾Œå†é€šéã€‚</li>
                </ul>
            </div>

            <div class="info-section" style="background-color: #FFFBEB; border-color: #F59E0B;">
                <h3 style="color: #D97706; border-bottom-color: #F59E0B;">â›½ åŠ æ²¹ç«™ä½¿ç”¨æŒ‡å—</h3>
                <div class="method-detail">
                    <p style="margin-bottom: 8px;">ç§Ÿè»Šé€šå¸¸éœ€<b>ã€ŒåŠ æ»¿æ²¹é‚„è»Š (æº€ã‚¿ãƒ³è¿”ã—)ã€</b>ï¼Œè«‹ä¿ç•™æœ€å¾Œä¸€æ¬¡åŠ æ²¹æ”¶æ“šã€‚</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; text-align: center; margin-bottom: 10px;">
                        <div style="background:#FFCCCC; padding:5px; border-radius:5px; color:#CC0000; font-weight:bold;">ç´…è‰²<br><span style="font-size:0.8rem">92ç„¡é‰›<br>(Regular)</span></div>
                        <div style="background:#FFFFCC; padding:5px; border-radius:5px; color:#999900; font-weight:bold;">é»ƒè‰²<br><span style="font-size:0.8rem">98ç„¡é‰›<br>(High Octane)</span></div>
                        <div style="background:#CCFFCC; padding:5px; border-radius:5px; color:#006600; font-weight:bold;">ç¶ è‰²<br><span style="font-size:0.8rem">æŸ´æ²¹<br>(Diesel)</span></div>
                    </div>
                    <p>ä¸€èˆ¬ç§Ÿè³ƒè½è»Šï¼ˆå¦‚ Toyota Corolla/Yarisï¼‰é€šå¸¸åŠ  <b style="color:#CC0000;">ç´…è‰² Regular (ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼)</b>ã€‚è«‹å‹™å¿…ç¢ºèªç§Ÿè»Šåˆç´„ã€‚</p>
                </div>

                <!-- æ–°å¢ï¼šè‡ªåŠ©åŠ æ²¹æ•™å­¸å€å¡Š -->
                <div style="margin-top: 15px; border-top: 1px dashed #F59E0B; padding-top: 15px;">
                    <h4 style="color: #D97706; margin: 0 0 10px 0;">ğŸ¤– è‡ªåŠ©åŠ æ²¹ (Self) æ“ä½œæ­¥é©Ÿ</h4>
                    <ul class="step-list" style="padding-left: 20px;">
                        <li><b>åœè»Šç†„ç«ï¼š</b> èªæ˜æ‹›ç‰Œå¯«æœ‰ã€Œã‚»ãƒ«ãƒ• (Self)ã€çš„åŠ æ²¹ç«™ã€‚åœå¦¥å¾Œè«‹å‹™å¿…ç†„ç«ã€‚</li>
                        <li><b>æ¶ˆé™¤éœé›»ï¼š</b> è§¸æ‘¸åŠ æ²¹æ©Ÿä¸Šçš„ã€Œéœé›»é™¤å» (éœé›»é™¤å»ã‚·ãƒ¼ãƒˆ)ã€é»‘è‰²è§¸æ‘¸æ¿ã€‚</li>
                        <li><b>é¸æ“‡æ”¯ä»˜ï¼š</b> è¢å¹•é»é¸ã€Œã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ (ä¿¡ç”¨å¡)ã€æˆ–ã€Œç¾é‡‘ã€ã€‚</li>
                        <li><b>é¸æ“‡æ²¹ç¨®ï¼š</b> é»é¸ç´…è‰² <b style="color:#CC0000;">Regular (ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼)</b>ã€‚</li>
                        <li><b>è¨­å®šæ²¹é‡ï¼š</b> é‚„è»Šè«‹é¸æ“‡ <b style="color:#2563EB;">ã€Œæº€ã‚¿ãƒ³ (æ»¿æ²¹)ã€</b>ã€‚</li>
                        <li><b>åŠ æ²¹ï¼š</b> æ’å…¥æ²¹æ§ï¼Œæ‰£ä¸‹æ‰³æ©Ÿã€‚è·³åœå¾Œè«‹ä¸è¦ç¡¬åŠ ï¼Œæ›å›æ²¹æ§ã€‚</li>
                        <li><b>é ˜å–æ”¶æ“šï¼š</b> å‹™å¿…é ˜å–æ”¶æ“š (é ˜åæ›¸) ä»¥ä¾›é‚„è»ŠæŸ¥é©—ã€‚</li>
                    </ul>
                </div>

                <!-- æ–°å¢ï¼šä»˜æ¬¾èˆ‡æ‰¾é›¶æ³¨æ„äº‹é … -->
                <div style="margin-top: 15px; background: #fff; padding: 10px; border-radius: 8px; border: 1px solid #FCD34D;">
                    <h4 style="color: #B45309; margin: 0 0 5px 0; font-size: 0.95rem;">ğŸ’° ä»˜æ¬¾èˆ‡æ‰¾é›¶é‡è¦æç¤º</h4>
                    <ul style="padding-left: 20px; font-size: 0.9rem; color: #444; margin-bottom: 0;">
                        <li style="margin-bottom: 5px;"><b>ç¾é‡‘æ‰¾é›¶é™·é˜±ï¼š</b> éƒ¨åˆ†èˆŠå¼æ©Ÿå°åŠ æ²¹å¾Œåªæœƒåå‡ºæ”¶æ“šï¼ˆæˆ–æ‰¾é›¶å–®ï¼‰ï¼Œ**ä¸æœƒç›´æ¥åéˆ”ç¥¨**ï¼éœ€æ‹¿è‘—å–®å­å»æ—é‚Šçš„<b>ã€Œç²¾ç®—æ©Ÿã€</b>æƒææ¢ç¢¼æ‰æœƒé€€éŒ¢ã€‚</li>
                        <li><b>ä¿¡ç”¨å¡é æˆæ¬Šï¼š</b> é¸æ“‡ã€Œæ»¿æ²¹ã€æ™‚ï¼Œç³»çµ±å¯èƒ½æœƒå…ˆé æ‰£ä¸€ç­†é‡‘é¡ï¼ˆå¦‚1è¬æ—¥åœ“ï¼‰ï¼Œå¯¦éš›æ‰£æ¬¾æœƒä¾åŠ æ²¹é‡è¨ˆç®—ï¼Œç„¡éœ€æ“”å¿ƒã€‚</li>
                    </ul>
                </div>
            </div>
            
            <div class="info-section" style="margin-top: 15px; border-color: #EF4444;">
                <h3 style="color: #EF4444; border-bottom-color: #EF4444;">â›“ï¸ é›ªéŠå®‰è£æ•™å­¸</h3>
                <div class="method-detail">
                    <p style="font-weight:bold; margin-bottom:5px;">âš ï¸ å‡ºç™¼å‰ç¢ºèªé©…å‹•è¼ª (å‰é©…/å¾Œé©…/å››é©…)</p>
                    <ul class="step-list" style="padding-left: 20px;">
                        <li><b>æ­¥é©Ÿ 1ï¼š</b>å°‡é›ªéŠæ”¤å¹³åœ¨è¼ªèƒå¾Œæ–¹ï¼Œç¢ºèªç„¡æ‰“çµã€‚</li>
                        <li><b>æ­¥é©Ÿ 2ï¼š</b>å°‡é›ªéŠå…©ç«¯æ‹‰èµ·ï¼ŒåŒ…è¦†è¼ªèƒã€‚</li>
                        <li><b>æ­¥é©Ÿ 3ï¼š</b>å…ˆæ‰£ä¸Šå…§å´æ›å‹¾ (é€šå¸¸åœ¨è¼ªèƒå¾Œæ–¹ä¸Šæ–¹)ã€‚</li>
                        <li><b>æ­¥é©Ÿ 4ï¼š</b>èª¿æ•´å¤–å´éŠæ¢ä½ç½®ï¼Œæ‰£ä¸Šå¤–å´æ›å‹¾ã€‚</li>
                        <li><b>æ­¥é©Ÿ 5ï¼š</b>ä½¿ç”¨æ©¡çš®åœˆæˆ–ç·Šç¹ƒå™¨æ‹‰ç·ŠéŠæ¢ï¼Œç¢ºä¿è²¼åˆè¼ªèƒã€‚</li>
                        <li><b>æ­¥é©Ÿ 6ï¼š</b>è¡Œé§›ç´„ 50 å…¬å°ºå¾Œåœè»Šæª¢æŸ¥ï¼Œå†æ¬¡æ‹‰ç·Šã€‚</li>
                    </ul>
                    <p style="font-size:0.85rem; color:#666; margin-top:5px;">*è¡Œé§›é›ªéŠè·¯æ®µè«‹ä¿æŒæ™‚é€Ÿ 30-50km/h ä»¥ä¸‹ã€‚</p>
                </div>
            </div>
            
             <div class="info-section winter-drive" style="margin-top: 15px;">
                <h3>â„ï¸ å†¬å­£è‡ªé§•èˆ‡å®‰å…¨æç¤º</h3>
                <p style="font-size: 0.95rem; margin-bottom: 10px; font-weight: 500;">æ‚¨çš„è¡Œç¨‹ç¶“éé˜¿è˜‡å±±ã€é»‘å·æº«æ³‰ã€ç”±å¸ƒé™¢ç­‰å±±å€ï¼Œ1æœˆä¸‹æ—¬ç‚ºå†¬å­£æ—ºå­£ï¼Œè«‹å‹™å¿…ç•™æ„ï¼š</p>
                
                <div class="info-detail-box" style="border-color: #FCA5A5; background-color: #FFF6F6;">
                    <h4 style="color: #B91C1C;">èƒç´‹èˆ‡é›ªéˆ (é‡è¦)</h4>
                     <p class="method-detail">
                        <span style="font-weight: 600; color: #B91C1C;">é›ªèƒï¼š</span> è«‹å‹™å¿…èˆ‡ç§Ÿè»Šå…¬å¸ç¢ºèªæ‚¨çš„è»Šè¼›æ˜¯å¦é…å‚™**é›ªèƒ (Snow Tires)**ã€‚è‹¥ç„¡é›ªèƒï¼Œå¯èƒ½ç„¡æ³•é€²å…¥éƒ¨åˆ†ç©é›ªçš„å±±å€ã€‚
                    </p>
                    <p class="method-detail" style="margin-top: 5px;">
                        <span style="font-weight: 600; color: #B91C1C;">é›ªéˆï¼š</span> åœ¨ç§Ÿè»Šæ™‚ï¼Œç¢ºèªæ˜¯å¦å‚™æœ‰é›ªéˆä¸¦çŸ¥é“å¦‚ä½•ä½¿ç”¨ã€‚éƒ¨åˆ†è·¯æ®µå¦‚é‡å¤§é›ªï¼Œæœƒå¼·åˆ¶è¦æ±‚åŠ è£é›ªéˆã€‚
                    </p>
                </div>
                
                <div class="info-detail-box" style="margin-top: 15px; border-color: #FCA5A5; background-color: #FFF6F6;">
                    <h4 style="color: #B91C1C;">å±±å€é§•è»Šæ™‚é–“</h4>
                     <p class="method-detail">
                        **é»‘å·è‡³åˆ¥åºœ/ç”±å¸ƒé™¢ï¼š** å±±è·¯è¼ƒå¤šï¼Œä¸‹åˆ 5 é»å¾Œå¤©è‰²æœƒå®Œå…¨è®Šæš—ã€‚Day 3 çš„è¡Œç¨‹éœ€è¦è·¨è¶Šå±±å€ï¼Œè«‹ç›¡é‡åœ¨ç™½å¤©å®Œæˆå¤§éƒ¨åˆ†ç§»å‹•ã€‚
                    </p>
                     <p class="method-detail" style="margin-top: 5px;">
                        **çµå†°é¢¨éšªï¼š** æ—©æ™¨æˆ–æ·±å¤œï¼Œæ©‹æ¨‘å’Œå±±å€èƒŒå…‰è·¯æ®µå®¹æ˜“çµå†°ï¼Œè«‹æ¸›é€Ÿæ…¢è¡Œï¼Œèˆ‡å‰è»Šä¿æŒå®‰å…¨è·é›¢ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 4: æ—…éŠè³‡è¨Š -->
    <div id="view-info" class="container">
        
        <!-- ç†Šæœ¬ ä¸Š/ä¸‹é€š æ”»ç•¥ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 1: ç†Šæœ¬ ä¸Šé€š/ä¸‹é€š é€›è¡—æ”»ç•¥</div>
                <div class="tag tag-shop">è³¼ç‰©ç¾é£Ÿ</div>
            </div>

            <div class="info-section kumamoto">
                <h3>ğŸ›ï¸ ä¸Šé€š (Kamitori) èˆ‡ ä¸‹é€š (Shimodori)</h3>
                <p style="font-size: 0.95rem;">
                    é€™æ˜¯ç†Šæœ¬æœ€ä¸»è¦çš„å…©æ¢æ‹±å»Šå•†åº—è¡—ï¼Œçš†ç‚ºå®¤å…§ç©ºé–“ï¼Œå³ä½¿ä¸‹é›¨ä¹Ÿä¸æ€•ã€‚æ­ä¹˜ç†Šæœ¬å¸‚é›»è‡³ã€Œé€šç”ºç­‹ã€æˆ–ã€Œè¾›å³¶ç”ºã€ç«™å³å¯åˆ°é”æ ¸å¿ƒå€åŸŸã€‚
                </p>

                <div class="safari-method" style="border-color: #90CDF4; margin-top: 15px;">
                    <span class="method-title" style="color: var(--kumamoto-info-text);">ä¸Šé€š (åŒ—æ®µ) - æ‚ é–’èˆ‡è³ªæ„Ÿ</span>
                    <div class="method-detail">
                        <p>ä¸Šé€šåå‘**æ–‡é’ã€ç²¾å“ã€å’–å•¡å»³**å’Œ**æœ¬åœ°è€åº—**ï¼Œæ°£æ°›ç›¸å°å®‰éœå„ªé›…ã€‚é©åˆæƒ³æ‰¾ç‰¹è‰²å°åº—ã€æ›¸åº—æˆ–å–ä¸‹åˆèŒ¶çš„å®¶åº­ã€‚</p>
                        <ul style="list-style-type: disc; margin-top: 5px; padding-left: 20px;">
                            <li>**é‡é»åº—å®¶ï¼š** é¶´å±‹ç™¾è²¨ã€å€‹æ€§é›œè²¨åº—ã€æ›¸åº—ã€‚</li>
                            <li>**å‚™è¨»ï¼š** é€™è£¡é€£æ¥è‘—ç†Šæœ¬åŸï¼Œé€šå¸¸å¾ç†Šæœ¬åŸæ–¹å‘èµ°éä¾†æ˜¯ç¬¬ä¸€ç«™ã€‚</li>
                        </ul>
                    </div>
                </div>

                <div class="safari-method" style="margin-top: 15px; border-color: #90CDF4;">
                    <span class="method-title" style="color: var(--kumamoto-info-text);">ä¸‹é€š (å—æ®µ) - åº¶æ°‘èˆ‡ç¾é£Ÿ</span>
                    <div class="method-detail">
                        <p>ä¸‹é€šæ˜¯æœ€ç†±é¬§çš„ä¸€æ®µï¼Œä»¥**è—¥å¦åº—ã€æœé£¾é€£é–åº—ã€é›»ç©åº—**å’Œ**é¤é£²åº—**ç‚ºä¸»ï¼Œå……æ»¿åº¶æ°‘æ´»åŠ›ã€‚å¤§éƒ¨åˆ†çŸ¥åçš„ç†Šæœ¬æ‹‰éºµåº—ï¼ˆå¦‚å¤©å¤–å¤©ï¼‰å’Œè±¬æ’åº—ï¼ˆå¦‚å‹çƒˆäº­ï¼‰éƒ½åœ¨é™„è¿‘å··å¼„ä¸­ã€‚</p>
                        <ul style="list-style-type: disc; margin-top: 5px; padding-left: 20px;">
                            <li>**é‡é»åº—å®¶ï¼š** å”å‰è¨¶å¾·ï¼ˆãƒ‰ãƒ³ã‚­ï¼‰ã€å¤§å‹è—¥å¦åº—ã€é›»å½±é™¢ã€‚</li>
                            <li>**å‚™è¨»ï¼š** é€™è£¡é è¿‘è¾›å³¶ç”ºï¼Œå¯æ­ä¹˜å¸‚é›»è¿”å›ç†Šæœ¬ç«™ï¼Œäº¤é€šä¾¿åˆ©ã€‚</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–°å¢ï¼šDay 2 é»‘å·æº«æ³‰æ•£æ­¥æ”»ç•¥ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 2: é»‘å·æº«æ³‰ æ•£ç­–èˆ‡å…¥æ¹¯æ‰‹å½¢</div>
                <div class="tag tag-relax">æº«æ³‰æ°£æ°›</div>
            </div>

            <div class="info-section" style="background-color: #FDF4F1; border-color: #78350F;">
                <h3 style="color: #78350F; border-bottom-color: #78350F;">â™¨ï¸ å…¥æ¹¯æ‰‹å½¢ (Onsen Hopping Pass)</h3>
                <p style="font-size: 0.95rem; color: #444;">
                    é€™æ˜¯é»‘å·æº«æ³‰æœ€å¤§çš„ç‰¹è‰²ï¼åªè¦è³¼è²·ä¸€æšæœ¨è£½çš„ã€Œå…¥æ¹¯æ‰‹å½¢ã€(ç´„ 1,500å††)ï¼Œå³å¯ä»»é¸ 3 é–“æ—…é¤¨çš„éœ²å¤©æº«æ³‰æ³¡æ¹¯ã€‚
                </p>
                <div class="safari-method" style="margin-top: 10px; border-color: #78350F;">
                    <span class="method-title" style="color: #78350F;">ä½¿ç”¨å°æ’‡æ­¥</span>
                    <div class="method-detail">
                        <ul style="padding-left: 20px; line-height: 1.6;">
                            <li><b>ä½œç‚ºç´€å¿µå“ï¼š</b>ä½¿ç”¨å®Œç•¢å¾Œï¼Œæ‰‹å½¢å¯ä»¥è“‹ä¸Šå°ç« å¸¶å›å®¶ç•¶æ¯å¢Šæˆ–æ›é£¾ï¼Œéå¸¸æœ‰è³ªæ„Ÿã€‚</li>
                            <li><b>å„ªæƒ æŠ˜æ‰£ï¼š</b>æ›è‘—æ‰‹å½¢åœ¨æº«æ³‰è¡—ä¸Šçš„éƒ¨åˆ†å•†åº—æ¶ˆè²»æˆ–ç”¨é¤ï¼Œå‡ºç¤ºå¯äº«æŠ˜æ‰£ã€‚</li>
                            <li><b>æ¨è–¦æ¹¯æ± ï¼š</b>é™¤äº†æ‚¨ä½å®¿çš„æ—…é¤¨å¤–ï¼Œæ¨è–¦é«”é©—ã€Œå±±æ¢…èŠ± (Yamamizuki)ã€çš„æºªæµéœ²å¤©é¢¨å‘‚ï¼Œæˆ–ã€Œæ–°æ˜é¤¨ã€çš„æ´çªŸé¢¨å‘‚ã€‚</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="info-section" style="margin-top: 15px;">
                <h3>ğŸŒ² æº«æ³‰è¡—å¿…åƒèˆ‡æ°›åœ</h3>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">
                    é»‘å·å…¨æ‘ç‚ºäº†ç¶­è­·æ™¯è§€ï¼Œå»ºç¯‰çµ±ä¸€ä½¿ç”¨é»‘è‰²èˆ‡æœ¨è³ªèª¿ï¼Œæ²’æœ‰éœ“è™¹ç‡ˆï¼Œåªæœ‰æŸ”å’Œçš„ç‡ˆç± ï¼Œéå¸¸é©åˆç©¿è‘—æµ´è¡£æ‹ç…§ã€‚
                </p>
                <div class="price-table">
                    <div class="price-header" style="color: #78350F; border-color: #78350F;">å¿…åƒç”œé»</div>
                    <div class="price-header" style="color: #78350F; border-color: #78350F;">ç‰¹è‰²</div>
                    <div class="price-header" style="color: #78350F; border-color: #78350F;">ä½ç½®</div>
                    
                    <div class="price-item"><b>Patisserie Roku</b></div>
                    <div class="price-item">è¶…äººæ°£ã€Œé¹½éº´æ³¡èŠ™ã€ï¼Œå¤–çš®é…¥è„†å…§é¤¡æ¿ƒéƒã€‚</div>
                    <div class="price-item">åœ°è—å ‚é™„è¿‘</div>
                    
                    <div class="price-item"><b>ç™½ç‰å­ (ç™½ç‰ãƒƒå­)</b></div>
                    <div class="price-item">ç¾ç…®ç™½ç‰æ¹¯åœ“ï¼Œå£æ„ŸQå½ˆï¼Œæ­é…é»‘èœœé»ƒè±†ç²‰ã€‚</div>
                    <div class="price-item">å·ç«¯é€š</div>
                    
                    <div class="price-item"><b>éŠ…é‘¼ç‡’ (Dora Dora)</b></div>
                    <div class="price-item">å¤¾è‘—å¸ƒä¸æˆ–å†°æ·‡æ·‹çš„å‰µæ„éŠ…é‘¼ç‡’ã€‚</div>
                    <div class="price-item">æº«æ³‰è¡—ä¸­å¿ƒ</div>
                </div>
                <a href="https://www.google.com/maps/search/?api=1&query=Patisserie+Roku+Kurokawa" target="_blank" class="btn-link" style="background-color: #78350F;">å°èˆªè‡³ Patisserie Roku ğŸ°</a>
            </div>
        </div>

        <!-- æ–°å¢ï¼šDay 3/4 ç”±å¸ƒé™¢æ•£æ­¥æ”»ç•¥ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 3-4: ç”±å¸ƒé™¢ æ¹¯ä¹‹åªè¡—é“æ”»ç•¥</div>
                <div class="tag tag-spot">è¶…å¥½é€›</div>
            </div>

            <div class="info-section" style="background-color: #F0FDF4; border-color: #15803D;">
                <h3 style="color: #15803D; border-bottom-color: #15803D;">ğŸš¶ ç¶“å…¸æ•£æ­¥è·¯ç·š</h3>
                <p style="font-size: 0.95rem; color: #444;">
                    å¾ç”±å¸ƒé™¢è»Šç«™å‡ºä¾†ï¼Œæ²¿è‘—æ­£å‰æ–¹çš„é“è·¯ç›´èµ°ï¼Œé›–ç„¶æœƒçœ‹åˆ°å£¯è§€çš„ç”±å¸ƒå²³ï¼Œä½†ç²¾è¯å€å…¶å¯¦åœ¨å³å‰æ–¹çš„<b>ã€Œæ¹¯ä¹‹åªè¡—é“ã€</b>ã€‚
                </p>
                <div class="method-detail" style="margin-top: 10px;">
                    <p><b>å»ºè­°å‹•ç·šï¼š</b> è»Šç«™ â†’ B-speak (è›‹ç³•æ²) â†’ æ¹¯ä¹‹åªè¡—é“ (ä¸»æˆ°å ´) â†’ Floral Village (ç«¥è©±æ‘) â†’ é‡‘é±—æ¹–ã€‚</p>
                    <p style="margin-top:5px; font-size:0.85rem; color:#666;">*å…¨ç¨‹æ­¥è¡Œå–®è¶Ÿç´„ 20-30 åˆ†é˜ (ä¸å«é€›è¡—)ï¼Œæ²¿è·¯éå¸¸å¹³å¦å¥½èµ°ï¼Œé©åˆæ¨è»Šã€‚</p>
                </div>
            </div>

            <div class="info-section" style="margin-top: 15px;">
                <h3>ğŸ° æ’éšŠç¾é£Ÿ & ç‰¹è‰²åº—é‹ª</h3>
                
                <div class="safari-method" style="margin-top: 10px;">
                    <span class="method-title" style="color: var(--primary);">B-speak è›‹ç³•æ² (P-roll)</span>
                    <div class="method-detail">
                        ç”±å¸ƒé™¢æœ€çŸ¥åçš„ç”œé»ï¼å£æ„Ÿè“¬é¬†è›‹é¦™æ¿ƒéƒã€‚
                        <br><span style="color: var(--danger); font-weight:bold;">âš ï¸ æ³¨æ„ï¼š</span> å°æ¢è£é€šå¸¸æ—©ä¸Š 10:30 å‰å°±æœƒè³£å…‰ã€‚è‹¥æƒ³è²·ï¼Œå»ºè­°ç¬¬ä¸€å¤©æŠµé”æ™‚å…ˆå»é è¨‚éš”å¤©å–è²¨ï¼Œæˆ–ä¸€æ—©å»æ’éšŠã€‚
                    </div>
                </div>

                <div class="safari-method" style="margin-top: 10px;">
                    <span class="method-title" style="color: var(--primary);">Milch (ãƒŸãƒ«ãƒ’) èµ·å¸æ¯</span>
                    <div class="method-detail">
                        å¿…åƒï¼æ¨è–¦é»<b>ã€Œç†±çš„ (Hot)ã€</b>èµ·å¸è›‹ç³•æ¯ï¼ŒåŠç†Ÿæµå¿ƒçš„å£æ„Ÿéå¸¸éŠ·é­‚ã€‚ä¹Ÿæœ‰å†·çš„å¯ä»¥é¸æ“‡ã€‚
                    </div>
                </div>

                <div class="safari-method" style="margin-top: 10px;">
                    <span class="method-title" style="color: var(--primary);">é‡‘è³å¯æ¨‚é¤… (é‡‘è³ã‚³ãƒ­ãƒƒã‚±)</span>
                    <div class="method-detail">
                        æ›¾ç²å…¨æ—¥æœ¬å¯æ¨‚é¤…å¤§è³½é‡‘è³ã€‚å¤–çš®é…¥è„†ï¼Œå…§é¤¡èª¿å‘³è¼ƒé‡ï¼Œé©åˆé‚Šèµ°é‚Šåƒã€‚
                    </div>
                </div>

                <div class="info-detail-box" style="margin-top: 15px; border-color: #F472B6; background-color: #FFF1F2;">
                    <h4 style="color: #DB2777;">ğŸ„ Yufuin Floral Village (ç«¥è©±æ‘)</h4>
                    <p style="font-size: 0.9rem;">
                        ä»¿ç…§è‹±åœ‹ç§‘èŒ¨æ²ƒçˆ¾å¾· (Cotswolds) æ‰“é€ çš„é»ƒè‰²çŸ®æˆ¿èšè½ã€‚é€™è£¡æœ‰ï¼š
                    </p>
                    <ul style="padding-left: 20px; font-size: 0.9rem; margin-top: 5px;">
                        <li><b>Miffy éºµåŒ…åº—ï¼š</b>é€ å‹éºµåŒ…è¶…å¯æ„›ï¼ŒäºŒæ¨“æœ‰å’–å•¡å»³ã€‚</li>
                        <li><b>é¾è²“å•†åº— (ã©ã‚“ãã‚Šã®æ£®)ï¼š</b>å‰åœåŠ›ç²‰çµ²å¿…é€›ã€‚</li>
                        <li><b>å‹•ç‰©é¤µé£Ÿï¼š</b>åœ’å€å…§æœ‰é¤Šå±±ç¾Šã€å…”å­ç”šè‡³æ¾é¼ ï¼Œå°æœ‹å‹æœƒå¾ˆæ„›ã€‚</li>
                    </ul>
                </div>
                <a href="https://www.google.com/maps/search/?api=1&query=Yufuin+Floral+Village" target="_blank" class="btn-link" style="display: flex; align-items: center; justify-content: center; gap: 6px;">å°èˆªè‡³ç«¥è©±æ‘ <svg class="icon-mini" style="color: white;"><use href="#icon-loc"></use></svg></a>
            </div>
        </div>


        <!-- ä¹å·è‡ªç„¶å‹•ç‰©å…¬åœ’ æ”»ç•¥ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 3: ä¹å·è‡ªç„¶å‹•ç‰©å…¬åœ’ (æ”»ç•¥)</div>
                <div class="tag tag-tip">é‡é»è³‡è¨Š</div>
            </div>

            <!-- é–€ç¥¨è³‡è¨Š -->
            <div class="info-section" style="border-color: #F59E0B;">
                <h3 style="color: var(--secondary);">ğŸ’° é–€ç¥¨èˆ‡è²»ç”¨ (åƒè€ƒ)</h3>
                <div class="price-table">
                    <div class="price-header">é …ç›®</div>
                    <div class="price-header">æˆäºº</div>
                    <div class="price-header">4æ­²~ä¸­å­¸ç”Ÿ</div>
                    
                    <div class="price-item">å…¥åœ’è²»</div>
                    <div class="price-item">Â¥2,600</div>
                    <div class="price-item">Â¥1,500</div>
                    
                    <div class="price-item">å¢æ—å·´å£« (Jungle Bus)</div>
                    <div class="price-item">Â¥1,400</div>
                    <div class="price-item">Â¥1,200</div>
                    
                    <div class="price-item" style="font-weight: 700;">è‡ªé§•è»Šå°è¦½æ”¶éŸ³æ©Ÿ</div>
                    <div class="price-item" colspan="2">Â¥600 (æ¯å°è»Š)</div>
                </div>
                <p class="detail" style="margin-top: 10px; font-size: 0.85rem; color: var(--danger);">
                    **è²»ç”¨ç¸½è¨ˆï¼š** è‹¥é¸æ“‡ã€Œå…¥åœ’ + å¢æ—å·´å£«ã€ï¼Œæ¯ä½æˆäººç´„ Â¥4,000ã€‚
                </p>
            </div>
            
            <!-- å¢æ—å·´å£«é ç´„æ•™å­¸ -->
            <div class="info-section">
                <h3>ğŸšŒ å¢æ—å·´å£« (Jungle Bus) é ç´„æ•™å­¸</h3>
                 
                <p style="font-size: 0.95rem; font-weight: 600;">
                    å¢æ—å·´å£«æ˜¯å¿…ç©é …ç›®ï¼å»ºè­°æ‚¨æå‰é ç´„ï¼Œä»¥ç¢ºä¿æœ‰ä½å­ï¼Œç‰¹åˆ¥æ˜¯é€±æœ«æˆ–å‡æœŸã€‚
                </p>
                <ol style="font-size: 0.9rem; margin-top: 10px; padding-left: 20px;">
                    <li>**ç·šä¸Šé ç´„ (æ¨è–¦)ï¼šï¼š** å®˜æ–¹ç¶²ç«™é€šå¸¸æœƒåœ¨å‡ºç™¼æ—¥æœŸçš„å‰ 1 å€‹æœˆå·¦å³é–‹æ”¾é ç´„ã€‚é¸æ“‡æ—¥æœŸèˆ‡æ™‚æ®µï¼Œç·šä¸Šä»˜è²»ã€‚</li>
                    <li>**ç•¶æ—¥ç¾å ´è³¼ç¥¨ï¼šï¼š** å¦‚æœç„¡æ³•ç·šä¸Šé è¨‚ï¼Œè«‹å‹™å¿…åœ¨**ä¸€é–‹åœ’æ™‚**ï¼ˆæˆ–é è¨ˆæŠµé”æ™‚ï¼‰ç«‹åˆ»å‰å¾€å”®ç¥¨è™•è³¼è²·ç•¶æ—¥çš„å ´æ¬¡ã€‚ç†±é–€æ™‚æ®µå®¹æ˜“å®¢æ»¿ã€‚</li>
                    <li>**é¸æ“‡æ™‚æ®µï¼šï¼š** å»ºè­°é¸æ“‡å‰›å…¥åœ’å¾Œçš„æ™‚æ®µï¼ˆç´„ 14:30-15:30ï¼‰ï¼Œä»¥å…è€½èª¤å¾ŒçºŒå‰å¾€ç”±å¸ƒé™¢çš„è¡Œç¨‹ã€‚</li>
                </ol>
            </div>


            <!-- æ··åˆé«”é©—å»ºè­° -->
            <div class="info-section" style="background-color: #FFFBEB; border-color: var(--secondary);">
                <h3 style="color: var(--secondary);">ğŸš— å¦‚ä½•å…¼é¡§è‡ªé§•èˆ‡å¢æ—å·´å£« (å®Œç¾é«”é©—è·¯ç·š)</h3>
                <p style="font-size: 0.95rem;">
                    æƒ³è¦å®Œæ•´é«”é©—å‹•ç‰©åœ’ï¼Œå»ºè­°å°‡è‡ªé§•è§€è³èˆ‡å·´å£«é¤µé£Ÿçµåˆï¼š
                </p>
                
                <div class="safari-method" style="border-color: var(--secondary);">
                    <span class="method-title" style="color: var(--secondary);">æ­¥é©Ÿä¸€ï¼šè‡ªé§•é«”é©— (å…è²»ï¼Œéœ€ç§Ÿå€Ÿå°è¦½æ©Ÿ)</span>
                    <div class="method-detail">
                        <p>
                            **å…ˆé–‹æ‚¨è‡ªå·±çš„ç§Ÿè³ƒè»Š**é€²å…¥ Safari Zone é€›ä¸€åœˆã€‚é€™æ¨£å¯ä»¥å¾å®¹åœ°ç”¨è‡ªå·±çš„é€Ÿåº¦è§€è³å‹•ç‰©ï¼Œä¸”è»Šå…§ç©ºé–“å¤§è¼ƒç‚ºèˆ’é©ã€‚
                        </p>
                        <p style="margin-top: 5px;">
                            **å„ªé»ï¼š** æ„Ÿå—å‹•ç‰©é è¿‘è»Šè¼›çš„éœ‡æ’¼æ„Ÿï¼Œä¸å—æ™‚é–“é™åˆ¶ã€‚
                        </p>
                    </div>
                </div>
                
                <div class="safari-method" style="margin-top: 15px; border-color: var(--danger);">
                    <span class="method-title recommended" style="color: var(--danger);">æ­¥é©ŸäºŒï¼šå¢æ—å·´å£« (é¤µé£Ÿé«”é©—ï¼Œéœ€é ç´„)</span>
                    <div class="method-detail">
                        <p>
                            **éš¨å¾Œå†æ­ä¹˜å¢æ—å·´å£«**ã€‚å·´å£«æœƒåœ¨è»Šä¸Šå®šé»åœè»Šï¼Œè®“å­©å­å€‘è¦ªæ‰‹å°‡é£¼æ–™å¾é˜²è­·ç¶²é¤µçµ¦å‹•ç‰©ã€‚é€™æ˜¯è‡ªé§•ç„¡æ³•å–ä»£çš„äº’å‹•æ¨‚è¶£ï¼
                        </p>
                        <p style="margin-top: 5px;">
                            **æ™‚ç¨‹å®‰æ’ï¼š** å»ºè­° 14:30 æŠµé”å¾Œï¼Œå…ˆå¿«é€Ÿè‡ªé§•ä¸€åœˆ (ç´„ 30-40 åˆ†é˜)ï¼Œå†æ¥è‘—æ­ä¹˜é ç´„å¥½çš„å·´å£«å ´æ¬¡ (ç´„ 50 åˆ†é˜)ã€‚
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- è¦ªè¿‘å€å»ºè­° -->
            <div class="info-section" style="margin-top: 16px;">
                 <h3>ğŸ• è¦ªè¿‘å€ (Fureai Zone) å»ºè­°</h3>
                 <div class="method-detail">
                    <p>åƒè§€å®Œ Safari Zone å¾Œï¼Œè«‹å‹™å¿…åˆ°è¦ªè¿‘å€èµ°èµ°ã€‚é€™è£¡æœ‰**è¢‹é¼ ã€å¤©ç«ºé¼ **ç­‰å¯æ„›çš„å°å‹•ç‰©å¯ä»¥æ‘¸æ‘¸æŠ±æŠ±ï¼Œé‚„æœ‰**é¨é¦¬é«”é©—**ï¼ˆéœ€å¦å¤–ä»˜è²»ï¼‰ï¼Œéå¸¸é©åˆå°æœ‹å‹ç©æ¨‚ï¼Œé€šå¸¸æœƒèŠ±è²» 1-1.5 å°æ™‚ã€‚</p>
                    <a href="https://www.google.com/maps/search/?api=1&query=African+Safari+Oita" target="_blank" class="btn-link">æŸ¥çœ‹å‹•ç‰©å…¬åœ’å®˜ç¶² (æœå°‹)</a>
                </div>
            </div>
        </div>
        
        <!-- ç¦å²¡éºµåŒ…è¶…äººå…’ç«¥åšç‰©é¤¨ æ”»ç•¥ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">ç¦å²¡éºµåŒ…è¶…äººå…’ç«¥åšç‰©é¤¨ (æ”»ç•¥)</div>
                <div class="tag tag-kids">è¦ªå­å‚™æ¡ˆ</div>
            </div>
            <div class="info-section" style="border-color: #F472B6;">
                <h3 style="color: #DB2777; border-bottom-color: #F472B6;">ğŸ éºµåŒ…è¶…äººåšç‰©é¤¨é‡é»</h3>
                <div class="method-detail">
                    <p>é€™æ˜¯ä¸€å€‹å°ˆç‚ºå­¸é½¡å‰å…’ç«¥è¨­è¨ˆçš„å¤¢å¹»æ¨‚åœ’ï¼Œä½æ–¼å¸‚ä¸­å¿ƒï¼Œäº¤é€šæ¥µåº¦ä¾¿åˆ©ï¼ˆåœ°éµç›´çµï¼‰ã€‚</p>
                    <ul style="list-style-type: disc; margin-top: 10px; padding-left: 20px;">
                        <li><b>ä½ç½®ï¼š</b>åšå¤šæ²³ç•”åŸ (Hakata Riverain Mall) 5F/6Fã€‚</li>
                        <li><b>äº¤é€šï¼š</b>åœ°éµç©ºæ¸¯ç·š/ç®±å´ç·šã€Œä¸­æ´²å·ç«¯ç«™ã€6è™Ÿå‡ºå£ç›´é”ã€‚</li>
                        <li><b>é–€ç¥¨ï¼š</b>1æ­²ä»¥ä¸Šçµ±ä¸€ç¥¨åƒ¹ (ç´„ 2,000-2,200å††)ï¼Œ1æ­²ä»¥ä¸‹å…è²»ã€‚</li>
                    </ul>
                </div>
                
                <div class="safari-method" style="margin-top: 15px; border-color: #F472B6;">
                    <span class="method-title" style="color: #DB2777;">å¿…ç©äº®é»</span>
                    <div class="method-detail">
                        <ul style="padding-left: 20px;">
                            <li><b>éºµåŒ…è¶…äººè¡¨æ¼”ç§€ï¼š</b>æ¯å¤©æœ‰å›ºå®šå ´æ¬¡ï¼Œè§’è‰²æœƒå‡ºä¾†è·³èˆäº’å‹•ã€‚</li>
                            <li><b>æœé†¬çˆºçˆºçš„éºµåŒ…å·¥å» ï¼š</b>å¿…è²·ï¼é‚„åŸåº¦è¶…é«˜çš„é€ å‹éºµåŒ…ï¼Œé›–ç„¶åƒ¹æ ¼ç¨é«˜ä½†éå¸¸å¯æ„›ã€‚</li>
                            <li><b>ç”Ÿæ—¥æœå‹™ï¼š</b>è‹¥å­©å­ç•¶æœˆç”Ÿæ—¥ï¼Œå¯ç²å¾—ç”Ÿæ—¥è²¼ç´™å’Œçš‡å†  (éœ€å‘å·¥ä½œäººå“¡è©¢å•)ã€‚</li>
                        </ul>
                    </div>
                </div>
                 <p class="detail" style="margin-top: 10px; font-size: 0.85rem; color: var(--danger);">
                    **æ³¨æ„ï¼š** é¤¨å…§é€šå¸¸ç¦æ­¢é£²é£Ÿï¼ˆå¬°å…’å‰¯é£Ÿå“é™¤å¤–ï¼‰ï¼Œä¸”å¬°å…’è»Šéœ€å¯„æ”¾åœ¨å…¥å£è™•ã€‚
                </p>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <div class="card-title">Day 4-6: ç¦å²¡ç¾é£Ÿ & ä¸‹åˆèŒ¶å£è¢‹åå–®</div>
                <div class="tag tag-food">å½ˆæ€§æ¨è–¦</div>
            </div>

            <div class="info-section" style="border-color: #F472B6; background-color: #FFF1F2;">
                <h3 style="color: #DB2777; border-bottom-color: #F472B6;">ğŸ° ä¸‹åˆèŒ¶ & ç™‚ç™’ç”œé» (é€›ç´¯å°ˆç”¨)</h3>
                
                <div class="safari-method" style="border-color: #F472B6; margin-top: 10px;">
                    <span class="method-title" style="color: #BE185D;">Cafe del SOL (å¤©ç¥/è¥¿é€š)</span>
                    <div class="method-detail">
                        <p>ç¦å²¡çŸ¥åçš„<b>ã€Œè“¬é¬†ç³»é¬†é¤… (Pancake)ã€</b>ï¼Œå£æ„Ÿåƒé›²æœµä¸€æ¨£è»Ÿç¶¿ï¼Œæ­é…æ–°é®®æ°´æœèˆ‡å†°æ·‡æ·‹ã€‚åº—å…§æ°›åœæº«é¦¨ï¼Œéå¸¸å—å¥³æ€§èˆ‡å°å­©æ­¡è¿ã€‚</p>
                        <ul style="margin-top:5px; font-size:0.85rem; color:#666; padding-left:20px;">
                            <li><b>æ¨è–¦ï¼š</b>å­£ç¯€é™å®šæ°´æœé¬†é¤…ã€æ‹¿éµæ‹‰èŠ±ã€‚</li>
                        </ul>
                        <a href="https://www.google.com/maps/search/Cafe+del+SOL+ç¦å²¡" target="_blank" class="btn-map">å°èˆªè‡³ Cafe del SOL</a>
                    </div>
                </div>

                <div class="safari-method" style="border-color: #F472B6; margin-top: 10px;">
                    <span class="method-title" style="color: #BE185D;">Mutsukado ã‚€ã¤ã‹å ‚ (åšå¤šç«™)</span>
                    <div class="method-detail">
                        <p>çŸ¥ååå¸å°ˆè³£åº—çš„å’–å•¡å»³ï¼Œä½æ–¼åšå¤šç«™ AMU PLAZA 5æ¨“ (å¤§é˜æ—æ‰‹æ‰¶æ¢¯ä¸Šå»)ã€‚å¿…åƒ<b>ã€Œæ°´æœé®®å¥¶æ²¹ä¸‰æ˜æ²»ã€</b>ï¼Œåå¸æ¥µåº¦æŸ”è»Ÿï¼Œé®®å¥¶æ²¹æ¸…çˆ½ä¸è†©ã€‚</p>
                        <p style="margin-top:5px; font-size:0.85rem; color:#666;">*ä½ç½®æ¥µä½³ï¼Œé©åˆç­‰å¾…å›ç¨‹åˆ—è»Šæˆ–å‰›æŠµé”æ™‚äº«ç”¨ã€‚</p>
                        <a href="https://www.google.com/maps/search/ã‚€ã¤ã‹å ‚+ã‚¢ãƒŸãƒ¥ãƒ—ãƒ©ã‚¶åšå¤šåº—" target="_blank" class="btn-map">å°èˆªè‡³ AMU PLAZA åº—</a>
                    </div>
                </div>

                <div class="safari-method" style="border-color: #F472B6; margin-top: 10px;">
                    <span class="method-title" style="color: #BE185D;">il FORNO del Mignon (åšå¤šç«™)</span>
                    <div class="method-detail">
                        <p>ä½æ–¼åšå¤šç«™ä¸­å¤®æ”¹æœ­å£æ—çš„<b>ã€Œè¿·ä½ å¯é Œã€</b>æ’éšŠååº—ã€‚é›–ç„¶ä¸æ˜¯å…§ç”¨åº—ï¼Œä½†ç¶“éä¸€å®šæœƒèåˆ°é¦™å‘³ï¼</p>
                        <p style="margin-top:5px; font-size:0.85rem; color:#666;">*æŒ‰é‡é‡è¨ˆåƒ¹ï¼Œæœ‰åŸå‘³ã€å·§å…‹åŠ›ã€åœ°ç“œå£å‘³ã€‚éå¸¸é©åˆè²·å›é£¯åº—ç•¶å®µå¤œæˆ–è»Šä¸Šé»å¿ƒã€‚</p>
                        <a href="https://www.google.com/maps/search/il+FORNO+del+Mignon+åšå¤š" target="_blank" class="btn-map">å°èˆªè‡³åšå¤šç«™å¯é Œ</a>
                    </div>
                </div>
            </div>

            <div class="info-section" style="border-color: #FBBF24; background-color: #FFFBEB;">
                <h3 style="color: #B45309; border-bottom-color: #FBBF24;">ğŸœ æ™šé¤èˆ‡åœ¨åœ°åç‰© (è¦ªå­å‹å–„)</h3>

                <div class="safari-method" style="border-color: #FBBF24; margin-top: 10px;">
                    <span class="method-title" style="color: #B45309;">åšå¤šè¯å‘³é³¥ (æ°´ç‚Šé›è‚‰é‹)</span>
                    <div class="method-detail">
                        <p>å¦‚æœä¸ç¿’æ…£é‡å£å‘³çš„æ‹‰éºµæˆ–å…§è‡Ÿé‹ï¼Œ<b>ã€Œåšå¤šæ°´ç‚Šé‹ (Mizutaki)ã€</b>æ˜¯è¦ªå­é¦–é¸ã€‚é›æ¹¯æ¿ƒéƒå……æ»¿è† åŸè›‹ç™½ï¼Œé›è‚‰è»Ÿå«©ï¼Œå£å‘³æ¸…çˆ½å¥åº·ï¼Œæœ€å¾Œçš„é›œç‚Šç²¥æ›´æ˜¯ç²¾è¯ã€‚</p>
                        <p style="margin-top:5px; font-size:0.85rem; color:#666;">*åšå¤šç«™èˆ‡å¤©ç¥éƒ½æœ‰å¤šå®¶åˆ†åº—ï¼Œæ™šé¤å»ºè­°é ç´„ã€‚</p>
                        <a href="https://www.google.com/maps/search/åšå¤šè¯å‘³é³¥+åšå¤šé§…å‰" target="_blank" class="btn-map">æœå°‹é™„è¿‘åˆ†åº—</a>
                    </div>
                </div>

                <div class="safari-method" style="border-color: #FBBF24; margin-top: 10px;">
                    <span class="method-title" style="color: #B45309;">Shin-Shin æ‹‰éºµ (åšå¤š/å¤©ç¥)</span>
                    <div class="method-detail">
                        <p>ç¦å²¡åœ¨åœ°äººæ°£è¶…é«˜çš„æ‹‰éºµåº—ã€‚ç›¸æ¯”ä¸€è˜­ï¼Œå®ƒçš„éºµæ¢æ¥µç´°ï¼Œè±šéª¨æ¹¯é ­é›–æ¿ƒéƒä½†è¼ƒç„¡è…¥å‘³ï¼Œä¸”å¸¶æœ‰ç”œå‘³ï¼Œ<b>å°æœ‹å‹é€šå¸¸æ¥å—åº¦å¾ˆé«˜</b>ã€‚</p>
                        <a href="https://www.google.com/maps/search/åšå¤šã‚‰ãƒ¼ã‚ã‚“+Shin-Shin" target="_blank" class="btn-map">æœå°‹ Shin-Shin æ‹‰éºµ</a>
                    </div>
                </div>

                <div class="safari-method" style="border-color: #FBBF24; margin-top: 10px;">
                    <span class="method-title" style="color: #B45309;">æ¥µå‘³å±‹ (KIWAMIYA) æ¼¢å ¡æ’</span>
                    <div class="method-detail">
                        <p>è¶…äººæ°£æ’éšŠåº—ï¼ç‰¹è‰²æ˜¯<b>ã€ŒDIY éµæ¿æ¼¢å ¡æ’ã€</b>ï¼Œåº—å“¡æœƒé€ä¸Šè¡¨é¢å¾®ç†Ÿçš„æ¼¢å ¡æ’ï¼Œè‡ªå·±ç”¨ç­·å­åˆ‡ä¸‹æ”¾åœ¨å°éµçŸ³ä¸Šç…ç†Ÿã€‚é›–ç„¶æ’éšŠéšŠä¼é€šå¸¸å¾ˆé•·ï¼Œä½†ç”¨é¤é«”é©—éå¸¸æœ‰è¶£ã€‚</p>
                        <p style="margin-top:5px; font-size:0.85rem; color:#DC2626;">*æ³¨æ„ï¼šéµæ¿æ¥µç‡™ä¸”æœ‰æ²¹ç…™ï¼Œè‹¥å­©å­å¤ªå°éœ€æ³¨æ„å®‰å…¨ã€‚</p>
                        <a href="https://www.google.com/maps/search/æ¥µå‘³å±‹+åšå¤š" target="_blank" class="btn-map">å°èˆªè‡³æ¥µå‘³å±‹</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- ä¼´æ‰‹ç¦®æ”»ç•¥ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">ğŸ ç¦å²¡ & ç†Šæœ¬ å¿…è²·ä¼´æ‰‹ç¦®æ¸…å–®</div>
                <div class="tag tag-shop">è³¼ç‰©</div>
            </div>
            
            <div class="info-section" style="border-color: #F87171;">
                <h3 style="color: #DC2626; border-bottom-color: #F87171;">ğŸ“ ç¦å²¡ (åšå¤šç«™/æ©Ÿå ´)</h3>
                <div class="method-detail">
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li><b>åšå¤šé€šã‚Šã‚‚ã‚“ (åšå¤šé€šé¥…é ­)ï¼š</b>ç¦å²¡No.1ä¼´æ‰‹ç¦®ï¼Œå……æ»¿å¥¶é¦™çš„ç™½è±†æ²™é¥…é ­ï¼Œå¿…è²·ï¼</li>
                        <li><b>Menbei (æ˜å¤ªä»™è²)ï¼š</b>ç¦å¤ªéƒæ¨å‡ºçš„æ˜å¤ªå­ä»™è²ï¼Œé¹¹é¦™é…¥è„†ï¼Œé©åˆç•¶ä¸‹é…’èœã€‚</li>
                        <li><b>åŠªåŠªé› (å†·ç‚¸é›)ï¼š</b>å£æ„Ÿç¨ç‰¹çš„å†°æ¶¼ç‚¸é›ï¼Œé©åˆåœ¨é£¯åº—äº«ç”¨æˆ–æœ€å¾Œä¸€å¤©å¸¶å› (éœ€ä¿å†·)ã€‚</li>
                        <li><b>ç­‘ç´«éº»ç³¬ (ç­‘ç´«ã‚‚ã¡)ï¼š</b>æ·‹ä¸Šé»‘ç³–èœœçš„é»ƒè±†ç²‰éº»ç³¬ï¼Œå£æ„Ÿç²¾ç·»ã€‚</li>
                        <li><b>Tubu Tube æ˜å¤ªå­é†¬ï¼š</b>ç®¡ç‹€åŒ…è£çš„æ˜å¤ªå­ï¼Œæ–¹ä¾¿æ–™ç†æˆ–å¡—æŠ¹éºµåŒ…ã€‚</li>
                    </ul>
                </div>
            </div>

            <div class="info-section kumamoto">
                <h3 style="color: var(--kumamoto-info-text); border-bottom-color: #90CDF4;">ğŸ» ç†Šæœ¬ (ç†Šæœ¬ç«™/åŸå½©è‹‘)</h3>
                <div class="method-detail">
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li><b>è­½ä¹‹é™£å¤ªé¼“ (èª‰ã®é™£å¤ªé¼“)ï¼š</b>ç´…è±†ç¾Šç¾¹åŒ…è¦†æ±‚è‚¥(éº»ç³¬)çš„ç¶“å…¸ç”œé»ï¼ŒåŒ…è£ç²¾ç¾ã€‚</li>
                        <li><b>é»‘ç³–å¤šç´èŒ²æ£’ï¼š</b>å¤–é…¥å…§è»Ÿçš„é»‘ç³–æ¢ç‹€ç”œç”œåœˆï¼Œé…ç‰›å¥¶è¶…æ­ã€‚</li>
                        <li><b>æ­¦è€…è¿” (æ­¦è€…ãŒãˆã—)ï¼š</b>ä»¥ç†Šæœ¬åŸçŸ³ç‰†å‘½åçš„ç´…è±†é…¥çš®é»å¿ƒã€‚</li>
                        <li><b>ç†Šæœ¬ç†Š (Kumamon) å‘¨é‚Šï¼š</b>ç†Šæœ¬é™å®šçš„éƒ¨é•·å•†å“ï¼Œåœ¨ç†Šæœ¬ç«™æˆ–æ©Ÿå ´éƒ½è²·å¾—åˆ°ã€‚</li>
                    </ul>
                </div>
            </div>
            
        </div>
        <div class="card">
            <div class="card-header">
                <div class="card-title">âš ï¸ é‡è¦æ³•è¦ï¼šé€€ç¨…èˆ‡é£›å®‰ (2026)</div>
                <div class="tag tag-tip">å¿…è®€</div>
            </div>

            <div class="info-section" style="border-color: #FBBF24; background-color: #FFFBEB;">
                <h3 style="color: #B45309; border-bottom-color: #FBBF24; display: flex; align-items: center; gap: 8px;">
                    <svg style="width:24px;height:24px;flex-shrink:0;" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="11" fill="white" stroke="#E5E7EB" stroke-width="1"/>
                        <circle cx="12" cy="12" r="6" fill="#BC002D"/>
                    </svg>
                    æ—¥æœ¬é€€ç¨…è¦å®š (Tax Free)
                </h3>
                <div class="method-detail">
                    <p>2026å¹´æ—¥æœ¬æŒçºŒæ¨å‹•é›»å­åŒ–é€€ç¨…ï¼Œå»ºè­°äº‹å…ˆæ–¼ <b>Visit Japan Web</b> ç™»éŒ„è­·ç…§è³‡è¨Šä»¥ç”¢ç”Ÿå…ç¨… QR Codeã€‚</p>
                    <ul style="list-style-type: disc; margin-top: 10px; padding-left: 20px;">
                        <li><b>å…ç¨…é–€æª»ï¼š</b>åŒä¸€å¤©ã€åŒä¸€åº—å®¶æ¶ˆè²»æ»¿ <b>5,000æ—¥åœ“ (æœªç¨…)</b> ä»¥ä¸Šã€‚</li>
                        <li><b>æ†‘è­‰è¦æ±‚ï¼š</b>çµå¸³æ™‚éœ€å‡ºç¤º<b>è­·ç…§æ­£æœ¬</b> (æˆ–æ˜¯ Visit Japan Web çš„å…ç¨… QR Code)ã€‚</li>
                        <li><b>ç‰¹æ®ŠåŒ…è£ï¼š</b>æ¶ˆè€—å“ (è—¥å¦ã€é›¶é£Ÿã€æ¶²é«”) æœƒè¢«è£å…¥<b>ã€Œç´…è‰²å¯†å°è¢‹ã€</b>ã€‚åœ¨æ—¥æœ¬å¢ƒå…§<b>åš´ç¦æ‹†å°</b>ï¼Œè‹¥è¢«æµ·é—œæŸ¥ç²æ‹†å°ï¼Œéœ€è£œç¹³ 10% æ¶ˆè²»ç¨…ã€‚</li>
                        <li style="margin-top:5px; color:#DC2626; font-size:0.85rem;">*è¨»ï¼šæ—¥æœ¬æ”¿åºœç ”æ“¬æœªä¾†æ”¹ç‚ºã€Œæ©Ÿå ´é€€ç¨…åˆ¶ã€(å…ˆå«ç¨…è³¼è²·ï¼Œæ©Ÿå ´å†é€€ç¨…)ï¼Œè‹¥ç¾å ´è¦å®šæœ‰è®Šï¼Œè«‹ä¾åº—å“¡æŒ‡ç¤ºç‚ºæº–ã€‚</li>
                    </ul>
                </div>
            </div>

            <div class="info-section" style="margin-top: 15px; border-color: #EF4444; background-color: #FEF2F2;">
                <h3 style="color: #B91C1C; border-bottom-color: #EF4444;">ğŸ”‹ è¡Œå‹•é›»æº & é›»æ± æ”œå¸¶è¦å®š</h3>
                <div class="method-detail">
                    <p style="font-weight: 700; color: #DC2626; margin-bottom: 8px;">åš´æ ¼ç¦æ­¢è¨—é‹ï¼è«‹å‹™å¿…æ”¾åœ¨ã€Œæ‰‹æè¡Œæã€éš¨èº«ç™»æ©Ÿã€‚</p>
                    <div style="background:white; padding:10px; border-radius:8px; border:1px solid #FECACA;">
                        <div style="font-weight:600; color:#991B1B; margin-bottom:4px;">å®¹é‡é™åˆ¶ (Wh)ï¼š</div>
                        <ul style="list-style-type: circle; padding-left: 20px; font-size: 0.9rem;">
                            <li><b>&lt; 100Whï¼š</b>å¯è‡ªç”±æ”œå¸¶ (æ•¸é‡åˆç†ï¼Œé€šå¸¸é™20é¡†å…§)ã€‚</li>
                            <li><b>100Wh ~ 160Whï¼š</b>éœ€ç¶“èˆªç©ºå…¬å¸æ‰¹å‡† (é€šå¸¸æ¯äººé™å¸¶ 2 é¡†)ã€‚</li>
                            <li><b>&gt; 160Whï¼š</b>ç¦æ­¢æ”œå¸¶ã€‚</li>
                        </ul>
                        <div style="margin-top:8px; font-size:0.85rem; color:#666;">
                            *å¸¸è¦‹ 10000mAh è¡Œå‹•é›»æºç´„ç‚º 37Wh (å¯æ”œå¸¶)ã€‚<br>
                            *è‹¥æ©Ÿèº«<b>ã€Œç“¦æ•¸æ¨™ç¤ºä¸æ¸…ã€</b>æˆ–ç£¨æç„¡æ³•è¾¨è­˜ï¼Œå®‰æª¢æœ‰æ¬Šæ²’æ”¶ï¼Œè«‹å‹™å¿…æª¢æŸ¥æ©Ÿèº«æ¨™ç±¤ã€‚
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 5: AI åŠ©æ‰‹ -->
    <div id="view-ai" class="container">
        <!-- ... existing AI Tab content ... -->
        <div class="card" style="height: calc(100vh - 140px); min-height: 500px; display: flex; flex-direction: column;">
            <div class="ai-header" id="ai-modal-title">
                <!-- ä¿®æ­£ 1: æ¨™é¡Œ Sparkles æ›æˆ SVG -->
                <svg class="icon-mini" style="width: 24px; height: 24px; color: #F59E0B;" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                <span>éš¨èº« AI ç¿»è­¯èˆ‡åŠ©æ‰‹</span>
            </div>
          <div style="text-align: right; margin-bottom: 5px; padding-right: 5px;">
    <button onclick="resetAppPassword()" style="border: none; background: none; color: #EF4444; font-size: 0.85rem; cursor: pointer; text-decoration: underline; display: inline-flex; align-items: center;">
        <svg style="width: 14px; height: 14px; margin-right: 4px; fill:none; stroke:currentColor; stroke-width:2;"><use href="#icon-reset"></use></svg>
        é‡è¨­é‡‘é‘°å¯†ç¢¼
            </button>
        </div>
            <div class="chat-history" id="chat-history">
                <!-- Welcome Message Bubble (Injected by JS) -->
            </div>

            <div class="ai-input-group" id="ai-input-area" style="display: block; margin-top: auto;">
                <div class="ai-input-wrapper">
                    <input type="text" class="ai-input" id="ai-user-input" placeholder="è«‹è¼¸å…¥å…§å®¹..." onkeypress="handleEnter(event)">
                    
                    <!-- æ–°å¢ï¼šèªéŸ³è¾¨è­˜èªè¨€åˆ‡æ›é–‹é—œ -->
                    <div class="voice-lang-switch">
                        <span style="font-weight:600; color:#9CA3AF; font-size:0.75rem; display: flex; align-items: center; gap: 4px;">
                            <svg class="icon-mini" style="width: 14px; height: 14px;" viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                            èª°åœ¨èªªè©±:
                        </span>
                        
                        <!-- é¸é … 1: å°ç£ (ä¸­æ–‡) - åœ“å½¢ç°¡ç´„ç‰ˆ -->
                        <label class="lang-option" title="æˆ‘ (èªªä¸­æ–‡)">
                            <input type="radio" name="voice_lang" value="zh-TW" checked onchange="updatePlaceholder()">
                            <!-- Simplified Taiwan Circle Flag -->
                            <svg class="flag-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <mask id="maskTW"><circle cx="12" cy="12" r="12" fill="white"/></mask>
                                <g mask="url(#maskTW)">
                                    <rect width="24" height="24" fill="#FE0000"/>
                                    <rect width="12" height="12" fill="#000095"/>
                                    <!-- ç°¡åŒ–çš„é’å¤©ç™½æ—¥ (åŒå¿ƒåœ“é¢¨æ ¼) -->
                                    <circle cx="6" cy="6" r="3.5" fill="white"/>
                                    <circle cx="6" cy="6" r="2.5" fill="#000095"/>
                                    <circle cx="6" cy="6" r="1.5" fill="white"/>
                                </g>
                            </svg>
                        </label>
                        
                        <!-- é¸é … 2: æ—¥æœ¬ (æ—¥æ–‡) - åœ“å½¢ç°¡ç´„ç‰ˆ -->
                        <label class="lang-option" title="åº—å“¡ (èªªæ—¥æ–‡)">
                            <input type="radio" name="voice_lang" value="ja-JP" onchange="updatePlaceholder()">
                            <!-- Simplified Japan Circle Flag -->
                            <svg class="flag-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="11.5" fill="white" stroke="#E5E7EB"/>
                                <circle cx="12" cy="12" r="5" fill="#BC002D"/>
                            </svg>
                        </label>
                    </div>

                        <div class="ai-actions-row">
                        <button class="btn-mode consult" onclick="sendToGemini('consult')">
                            <svg class="icon-sprite"><use href="#icon-consult"></use></svg>
                            è¡Œç¨‹è«®è©¢
                        </button>
                        <button class="btn-mode trans" onclick="sendToGemini('translate')">
                            <svg class="icon-sprite"><use href="#icon-trans"></use></svg>
                            ä¸­/æ—¥ç¿»è­¯
                        </button>
                        <button class="btn-mode voice" id="btn-voice-ja">
                            <svg class="icon-sprite"><use href="#icon-voice"></use></svg>
                            èªéŸ³è¼¸å…¥
                        </button>
                        <button class="btn-mode camera" onclick="document.getElementById('img-upload-input').click()">
                            <svg class="icon-sprite"><use href="#icon-camera"></use></svg>
                            æ‹ç…§è¾¨è­˜
                        </button>
                        <input type="file" id="img-upload-input" accept="image/*" onchange="handleImageSelect(event)" style="display: none;">
                    
                    </div>
                </div>
            </div>
            
            <button id="btn-back-trans" class="btn-ai-reset" onclick="showAiTranslatorMode()">
                 â†©ï¸ è¿”å›ä¸€èˆ¬æ¨¡å¼
            </button>
        </div>
    </div>

    <!-- TAB 6: å³æ™‚å¤©æ°£ (New) -->
    <div id="view-weather" class="container">
        <div class="card">
            <div class="card-header">
                <!-- ä¿®æ­£ 1: å°‡ Emoji ğŸŒ æ›æˆç°¡ç´„ SVG åœ°çƒåœ–ç¤º -->
                <div class="card-title" style="display: flex; align-items: center; gap: 6px;">
                    <svg class="icon-mini" style="color: var(--primary);"><use href="#icon-earth"></use></svg>
                    å³æ™‚å¤©æ°£æŸ¥è©¢ & ç©¿è¡£å»ºè­°
                </div>
            </div>
            
            <div class="weather-search-box">
                <input type="text" id="weather-city-input" class="weather-input" placeholder="è¼¸å…¥åŸå¸‚ (ä¾‹å¦‚: ç†Šæœ¬, ç”±å¸ƒé™¢)">
                <button class="btn-weather-search" onclick="fetchRealtimeWeather()">æŸ¥è©¢</button>
            </div>

            <!-- Main Result -->
            <div id="weather-result" style="display:none;">
                <div class="weather-card-main">
                    <div class="wc-loc" id="wc-loc">--</div>
                    <div class="wc-temp-big" id="wc-temp">--Â°</div>
                    <div class="wc-desc" id="wc-desc">è¼‰å…¥ä¸­...</div>
                </div>

                <!-- Comparison Row -->
                <div class="weather-compare-row">
                    <div class="wc-mini-card" onclick="getLocalWeather()" style="cursor:pointer; background:#F9FAFB;">
                        <!-- ä¿®æ­£ 1: æˆ‘çš„ä½ç½®åœ–ç¤º (Pin) -->
                        <div id="wc-loc-box" class="wc-mini-title" style="display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="getLocalWeather()">
    <svg class="icon-mini" style="color: #EF4444;"><use href="#icon-loc"></use></svg>
    <span>æˆ‘çš„ä½ç½® (é»æ“Šæ›´æ–°)</span>
</div>
                        <div class="wc-mini-temp" id="wc-my-temp">--Â°</div>
                    </div>
                    <div class="wc-mini-card">
                        <!-- ä¿®æ­£ 2: æº«å·®å°æ¯”åœ–ç¤º (Thermometer) -->
                        <div class="wc-mini-title" style="display: flex; align-items: center; justify-content: center;">
                            <svg class="icon-mini" style="color: #3B82F6;"><use href="#icon-temp"></use></svg>
                            æº«å·®å°æ¯”
                        </div>
                        <div id="wc-diff-tag" class="wc-diff-tag" style="display:none;">--</div>
                        <div id="wc-diff-text" style="font-size:0.8rem; color:#666; margin-top:2px;">--</div>
                    </div>
                </div>

                <!-- AI Advice -->
                <div class="advice-box">
                    <!-- ä¿®æ­£ 3: ç©¿è¡£å»ºè­°åœ–ç¤º (Shirt) -->
                    <strong style="display: flex; align-items: center; gap: 4px;">
                        <svg class="icon-mini" style="color: #059669;"><use href="#icon-shirt"></use></svg>
                        AI ç©¿è¡£å»ºè­°ï¼š
                    </strong>
                    <div style="margin-top: 5px;" id="wc-advice">åˆ†ææ°£å€™æ•¸æ“šä¸­...</div>
                </div>
                
                <div style="font-size: 0.75rem; color: #9CA3AF; text-align: center; margin-top: 15px;">
                    * å¤©æ°£æ•¸æ“šä¾†æºï¼šOpen-Meteo Real-time API<br>
                    * ç©¿è¡£å»ºè­°ç”± Google Gemini AI åˆ†æç”Ÿæˆ
                </div>
            </div>
            
            <!-- Default / Loading State -->
            <div id="weather-placeholder" style="text-align: center; padding: 40px; color: #9CA3AF;">
                <svg viewBox="0 0 24 24" style="width: 60px; height: 60px; stroke: #D1D5DB; fill: none; stroke-width: 1.5; margin-bottom: 10px;"><path d="M12 2v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="M20 12h2"></path><path d="m19.07 4.93-1.41 1.41"></path><path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"></path><path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"></path></svg>
                <div>è«‹è¼¸å…¥åŸå¸‚åç¨±æŸ¥è©¢å³æ™‚å¤©æ°£</div>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šç¾©å½ˆå‡ºè¦–çª— HTML -->
    <div id="location-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">æ‰‹å‹•è¨­å®šä½ç½®</div>
            <div class="modal-desc" id="modal-msg">ç„¡æ³•å–å¾— GPS å®šä½ï¼Œè«‹æ‰‹å‹•è¼¸å…¥æ‚¨æ‰€åœ¨çš„åŸå¸‚ä»¥é€²è¡Œæº«å·®æ¯”å°ã€‚</div>
            <input type="text" id="modal-city-input" class="modal-input" placeholder="ä¾‹å¦‚: å°åŒ—, Taichung" value="å°åŒ—">
            <div class="modal-btns">
                <button class="modal-btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-confirm" onclick="submitManualLocation()">ç¢ºå®š</button>
            </div>
        </div>
    </div>
<div id="note-modal" class="modal-overlay">
        <div class="modal-box" style="max-width: 350px; text-align: left;">
            <div class="modal-title" style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
                <span style="display:flex; align-items:center; gap:6px;">
                    <svg class="icon-mini" style="color:#2563EB;" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    éš¨èº«ç­†è¨˜
                </span>
                <span id="note-status" style="font-size:0.75rem; color:#10B981; font-weight:normal;"></span>
            </div>
            <textarea id="note-area" style="width:100%; height:200px; padding:12px; border:1px solid #E5E7EB; border-radius:8px; font-size:1rem; resize:none; outline:none; font-family:inherit; background:#F9FAFB;" placeholder="åœ¨é€™è£¡è¨˜ä¸‹æƒ³è¨˜éŒ„çš„äº‹... (è‡ªå‹•å„²å­˜)"></textarea>
            <div class="modal-btns" style="margin-top:15px;">
                <button class="modal-btn btn-confirm" onclick="closeNoteModal()">é—œé–‰</button>
            </div>
        </div>
    </div>
    <div id="calc-modal" class="modal-overlay">
        <div class="modal-box" style="max-width: 300px;">
            <div class="modal-title" style="color: #D97706; border-bottom: 1px solid #FDE68A; padding-bottom: 10px;">
                ğŸ’± åŒ¯ç‡è©¦ç®— (JPY â†” TWD)
            </div>
            
            <div style="margin: 10px 0; font-size: 0.85rem; color: #666; display: flex; justify-content: flex-end; align-items: center; gap: 8px;">
                <span id="rate-status" style="font-size: 0.75rem; color: #9CA3AF;">â— æº–å‚™ä¸­...</span>
                <label>åŒ¯ç‡:</label>
                <input type="number" id="calc-rate" step="0.0001" style="width: 70px; padding: 4px; border: 1px solid #ccc; border-radius: 4px; text-align: center;" oninput="calculateExchange()">
            </div>

            <div class="calc-row">
                <span class="calc-label">æ—¥å¹£</span>
                <input type="number" id="inp-jpy" class="calc-input" placeholder="Â¥" inputmode="decimal" oninput="calculateExchange('jpy')">
            </div>

            <div class="calc-row">
                <span class="calc-label">å°å¹£</span>
                <input type="number" id="inp-twd" class="calc-input" placeholder="NT$" inputmode="decimal" oninput="calculateExchange('twd')">
            </div>

            <div class="modal-btns" style="margin-top: 20px;">
                <button class="modal-btn btn-confirm" style="background: #F59E0B;" onclick="closeCalcModal()">é—œé–‰</button>
            </div>
        </div>
    </div>
    <div id="img-preview-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">ç¢ºèªåœ–ç‰‡</div>
            <div style="background:#F3F4F6; padding:10px; border-radius:8px; margin-bottom:15px; display:flex; justify-content:center;">
                <img id="img-preview-content" style="max-width:100%; max-height:300px; border-radius:4px; object-fit:contain;">
            </div>
            <div class="modal-desc" style="font-size:0.85rem; color:#666; margin-bottom:15px;">
                ç¢ºèªè¦å‚³é€é€™å¼µåœ–ç‰‡çµ¦ AI é€²è¡Œåˆ†æå—ï¼Ÿ
            </div>
            <div class="modal-btns">
                <button class="modal-btn btn-cancel" onclick="cancelImagePreview()">å–æ¶ˆ</button>
                <button class="modal-btn btn-confirm" onclick="confirmImageAnalysis()">é–‹å§‹è¾¨è­˜</button>
            </div>
        </div>
    </div>
    <!-- Bottom Navigation Bar (6 items now) -->
    
    <nav class="nav-bar">
        <div class="nav-item active" data-target="view-schedule" onclick="switchTab(this)">
            <span class="nav-icon">
                <svg class="icon-sprite"><use href="#icon-schedule"></use></svg>
            </span>
            è¡Œç¨‹è¡¨
        </div>
        <div class="nav-item" data-target="view-stay" onclick="switchTab(this)">
            <span class="nav-icon">
                <svg class="icon-sprite"><use href="#icon-stay"></use></svg>
            </span>
            ä½å®¿è³‡è¨Š
        </div>
        <div class="nav-item" data-target="view-car" onclick="switchTab(this)">
            <span class="nav-icon">
                <svg class="icon-sprite"><use href="#icon-car"></use></svg>
            </span>
            äº¤é€šè³‡è¨Š
        </div>
        <div class="nav-item" data-target="view-info" onclick="switchTab(this)">
            <span class="nav-icon">
                <svg class="icon-sprite"><use href="#icon-info"></use></svg>
            </span>
            æ—…éŠè³‡è¨Š
        </div>
        
        <div class="nav-item" data-target="view-weather" onclick="switchTab(this)">
            <span class="nav-icon">
                <svg class="icon-sprite"><use href="#icon-weather"></use></svg>
            </span>
            å³æ™‚å¤©æ°£
        </div>

        <div class="nav-item" data-target="view-ai" onclick="switchTab(this)">
            <span class="nav-icon">
                <svg class="icon-sprite"><use href="#icon-ai"></use></svg>
            </span>
            AI åŠ©æ‰‹
        </div>
    </nav> 
    <button id="btn-quick-note" class="float-note-btn" onclick="openNoteModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
    </button>
    <button id="btn-calc" class="float-calc-btn" onclick="openCalcModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
    </button>
    <button id="btn-share-loc" class="float-share-btn" onclick="shareCurrentLocation()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
        
    </button>


    <div id="lightbox-modal" class="lightbox-overlay" onclick="closeLightbox()">
        <span class="lightbox-close">&times;</span>
        <img class="lightbox-content" id="lightbox-img">
    </div>

    <script>
    // [æ–°å¢] æ§åˆ¶éå ´ç•«é¢æ¶ˆå¤±çš„é‚è¼¯
    window.addEventListener('load', () => {
        const splash = document.getElementById('splash-screen');
        
        // è¨­å®šæœ€çŸ­é¡¯ç¤ºæ™‚é–“ (ä¾‹å¦‚ 1.5 ç§’)ï¼Œè®“ä½¿ç”¨è€…çœ‹å¾—åˆ°é£›æ©Ÿï¼Œä¸æœƒä¸€é–ƒè€Œé
        setTimeout(() => {
            if (splash) {
                splash.classList.add('hidden');
                
                // å‹•ç•«çµæŸå¾Œï¼Œå°‡å…ƒç´ å¾ DOM ç§»é™¤ï¼Œé‡‹æ”¾è¨˜æ†¶é«”
                setTimeout(() => {
                    splash.remove();
                }, 600); // é…åˆ CSS transition çš„ 0.6s
            }
        }, 1500); // 1500æ¯«ç§’ = 1.5ç§’ï¼Œæ‚¨å¯è‡ªè¡Œèª¿æ•´
    });

    // åŸæœ‰çš„ç¨‹å¼ç¢¼...
    // const encryptedApiKey = ...

       // [ä¿®æ”¹] åŸæœ¬çš„ const apiKey = ""; æ›¿æ›æˆä»¥ä¸‹å…§å®¹ï¼š


// [ä¿®æ”¹] 1. å®šç¾©å…©çµ„åŠ å¯†äº‚ç¢¼ (è«‹å°‡æ‚¨çš„ AES åŠ å¯†å­—ä¸²åˆ†åˆ¥å¡«å…¥)
// ç”¨æ–¼ Gemini AI å°è©±ã€ç¿»è­¯
const encryptedGeminiKey = "U2FsdGVkX1/64ozwLOVc7Q7oTx058ndDWtXLLJ6Ri7cafbqjyyabFrsg2GixFXZV8bGjn7m7O7ZkH4CKCQjIjA=="; 
// ç”¨æ–¼ Google Places (åˆ†äº«ä½ç½®æ™‚æŠ“åœ°æ¨™åç¨±)
const encryptedPlacesKey = "U2FsdGVkX18lboyLOHvSireLOqo+Tfbx70XCgJaQinOaeYW+husBH5S/JaqTRG1zw3ggoldpqX89EHoR9R87iQ=="; 

// [ä¿®æ”¹] 2. ç”¨ä¾†æš«å­˜è§£å¯†å¾Œçš„ Key
let geminiKey = ""; 
let googleKey = "";


// [æ–°å¢] å°è©±æ­·å²ç´€éŒ„ (è®“ AI è¨˜ä½å‰å¹¾å¥è©±)
    let conversationHistory = [];
// [æ–°å¢] AI å°éŠçš„ç³»çµ±æç¤ºè© (é€™è£¡å®šç¾©äº†å®ƒçš„è¨˜æ†¶èˆ‡äººè¨­)
    const systemPrompt = `
    ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„ä¹å·æ—…éŠå°éŠï¼Œè² è²¬å¸¶é ˜ã€Œè¦ªå­è‡ªç”±è¡Œã€åœ˜éšŠã€‚
    ç›®å‰çš„æ—¥æœŸæ˜¯ 2026å¹´1æœˆ (è«‹æ ¹æ“šä½¿ç”¨è€…æå•åˆ¤æ–·ç›¸å°æ—¥æœŸ)ã€‚
    
    ã€è¡Œç¨‹ç¸½è¦½ã€‘
    Day 1 (1/25 æ—¥): æ­ä¹˜æ˜Ÿå®‡èˆªç©ºJX846(07:30å‡ºç™¼) æŠµé”ç¦å²¡æ©Ÿå ´(é è¨ˆ12:00) -> ç§Ÿè»Š(Toyota) -> ç†Šæœ¬åŸ/æ«»ä¹‹é¦¬å ´ -> æ™šé¤:å‹çƒˆäº­è±¬æ’ -> ä½: The Blossom Kumamotoã€‚
    Day 2 (1/26 ä¸€): ç†Šæœ¬ç«™æ­ Aso Boy! (09:00) -> é˜¿è˜‡ç«™/è‰åƒé‡Œ/ç«å±±åšç‰©é¤¨ -> é–‹è»Šå¾€é»‘å·æº«æ³‰ -> ä½: é»‘å·æº«æ³‰ (å…¥æ¹¯æ‰‹å½¢)ã€‚
    Day 3 (1/27 äºŒ): ä¹å·è‡ªç„¶é‡ç”Ÿå‹•ç‰©åœ’ (å¢æ—å·´å£«) -> åˆ¥åºœåœ°ç„å·¡ç¦® (æµ·åœ°ç„/ç¶åœ°ç„) -> ä½: ç”±å¸ƒé™¢ (é‡‘é±—æ¹–æ—)ã€‚
    Day 4 (1/28 ä¸‰): ç”±å¸ƒé™¢æ•£ç­– (æ¹¯ä¹‹åª/SnoopyèŒ¶å±‹) -> å¤ªå®°åºœå¤©æ»¿å®® -> TeamLab Forest ç¦å²¡ -> ä½: ç¦å²¡å¸‚å€ã€‚
    Day 5 (1/29 å››): å¤§æ¿ å…¬åœ’/ç¾è¡“é¤¨ -> å¤©ç¥åœ°ä¸‹è¡—/PARCO (åˆé¤:æ¥µå‘³å±‹) -> åšå¤šé‹æ²³åŸ -> ä¸­æ´²å±‹å° -> ä½: ç¦å²¡å¸‚å€ã€‚
    Day 6 (1/30 äº”): æ•´ç†è¡Œæ -> ç¦å²¡æ©Ÿå ´é‚„è»Š (10:30) -> æ­æ©Ÿè¿”å° (JX847 19:10)ã€‚

    ã€å›ç­”åŸå‰‡ã€‘
    1. ç°¡æ½”ï¼šä½ æ˜¯åœ¨æ‰‹æ©Ÿä¸Šè¢«é–±è®€ï¼Œå›ç­”è«‹ç²¾ç°¡ï¼Œä¸è¦é•·ç¯‡å¤§è«–ã€‚
    2. è¦ªåˆ‡ï¼šèªæ°£è¦åƒæœ‹å‹ä¸€æ¨£ç†±å¿ƒã€‚
    3. æº–ç¢ºï¼šåªèƒ½æ ¹æ“šä¸Šè¿°è¡Œç¨‹å›ç­”ï¼Œä¸è¦ç·¨é€ ä¸åœ¨è¡Œç¨‹å…§çš„æ™¯é»ã€‚
    4. èªè¨€ï¼šè«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡ (å°ç£)ã€‚
    5. å°èˆªæ”¯æ´ï¼šè‹¥ä½¿ç”¨è€…è©¢å•åœ°é»ä½ç½®æˆ–å¦‚ä½•å‰å¾€ï¼Œè«‹å‹™å¿…åœ¨å›ç­”ä¸­é™„ä¸Š Google Maps é€£çµï¼Œæ ¼å¼è«‹åš´æ ¼éµå®ˆï¼š
       <br><a href='https://www.google.com/maps/search/?api=1&query=åœ°é»åç¨±' target='_blank' style='display:inline-flex; align-items:center; gap:4px; margin-top:5px; color:#2563EB; font-weight:bold; text-decoration:none; border:1px solid #2563EB; padding:2px 8px; border-radius:12px;'><svg style='width:14px;height:14px;fill:none;stroke:currentColor;stroke-width:2;' viewBox='0 0 24 24'><use href='#icon-loc'></use></svg>å°èˆªè‡³ [åœ°é»]</a>
    `;
// 3. è§£å¯†å‡½å¼ (æœƒåœ¨éœ€è¦ API æ™‚è‡ªå‹•å‘¼å«)
// [ä¿®æ”¹] 3. é›™é‘°åŒ™è§£å¯†å‡½å¼ (å‚³å…¥ 'gemini' æˆ– 'places' å–å¾—å°æ‡‰ Key)
function getKey(type) {
    // A. å¦‚æœè¨˜æ†¶é«”ä¸­å·²ç¶“æœ‰è§£å¥½çš„ Keyï¼Œç›´æ¥å›å‚³
    if (type === 'gemini' && geminiKey) return geminiKey;
    if (type === 'places' && googleKey) return googleKey;

    // B. è®€å–å¯†ç¢¼ (å…©æŠŠé‘°åŒ™å…±ç”¨åŒä¸€å€‹å¯†ç¢¼ 'app_password')
    let password = localStorage.getItem("app_password");
    
    if (!password) {
        password = prompt("è«‹è¼¸å…¥ API é‡‘é‘°å¯†ç¢¼ (å°‡åŒæ™‚è§£é– AI èˆ‡åœ°åœ–åŠŸèƒ½)ï¼š");
    }

    if (!password) return null; // ä½¿ç”¨è€…æŒ‰å–æ¶ˆ

    try {
        // C. å…§éƒ¨è¼”åŠ©ï¼šå–®ç´”è§£å¯†å­—ä¸²
        const decrypt = (cipher) => {
            if (!cipher) return "";
            const bytes = CryptoJS.AES.decrypt(cipher, password);
            return bytes.toString(CryptoJS.enc.Utf8);
        };

        // D. å˜—è©¦ç”¨åŒä¸€çµ„å¯†ç¢¼è§£é–‹å…©æŠŠé‘°åŒ™
        const g_key = decrypt(encryptedGeminiKey);
        const p_key = decrypt(encryptedPlacesKey);

        // E. é©—è­‰ (åªè¦å…¶ä¸­ä¸€æŠŠæˆåŠŸè§£å‡º AIza é–‹é ­ï¼Œå°±è¦–ç‚ºå¯†ç¢¼æ­£ç¢º)
        // æ³¨æ„ï¼šè‹¥æ‚¨åªæœ‰è¨­å…¶ä¸­ä¸€å€‹ï¼Œå¦ä¸€å€‹ç•™ç©ºå­—ä¸²ä¹Ÿæ²’é—œä¿‚
        if (g_key.startsWith("AIza") || p_key.startsWith("AIza")) {
            geminiKey = g_key;
            googleKey = p_key;
            localStorage.setItem("app_password", password); // å¯†ç¢¼æ­£ç¢ºï¼Œå­˜èµ·ä¾†
            
            return type === 'gemini' ? geminiKey : googleKey;
        } else {
            alert("å¯†ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•è§£å¯† API Keyã€‚");
            localStorage.removeItem("app_password"); // æ¸…é™¤éŒ¯èª¤å¯†ç¢¼
            return null;
        }
    } catch (e) {
        console.error("è§£å¯†å¤±æ•—", e);
        alert("è§£å¯†å¤±æ•—ï¼Œè«‹ç¢ºèªå¯†ç¢¼ã€‚");
        localStorage.removeItem("app_password");
        return null;
    }
}
        // Weather Data Configuration
        // Icons: Using simple SVG strings for white icons


        const tripConfig = {
    'd1': {
        dateStr: '2026-01-25', // å‹™å¿…ç¢ºèªå¹´ä»½æ—¥æœŸæ­£ç¢º
        loc: 'ç†Šæœ¬å¸‚',
        lat: 32.803, lon: 130.707,
        backup: { temp: '10Â°C', range: '2Â°C ~ 11Â°C', desc: 'æ™´æ™‚å¤šé›²', advice: 'æ°£æº«é©ä¸­ä½†æ—©æ™šåæ¶¼ï¼Œé•·è¢–é…å¤–å¥—ã€‚', icon: 'cloud-sun' }
    },
    'd2': {
        dateStr: '2026-01-26',
        loc: 'é˜¿è˜‡/é»‘å·',
        lat: 33.096, lon: 131.096, // é»‘å·æº«æ³‰é™„è¿‘åº§æ¨™
        backup: { temp: '5Â°C', range: '-3Â°C ~ 6Â°C', desc: 'å¤šé›²/é£„é›ª', advice: 'å±±å€æ¥µå†·ï¼Œå‹™å¿…ç©¿è‘—ç¾½çµ¨å¤–å¥—ä¿æš–ã€‚', icon: 'snow' }
    },
    'd3': {
        dateStr: '2026-01-27',
        loc: 'åˆ¥åºœ/ç”±å¸ƒé™¢',
        lat: 33.265, lon: 131.360, // ç”±å¸ƒé™¢åº§æ¨™
        backup: { temp: '7Â°C', range: '0Â°C ~ 8Â°C', desc: 'å¤šé›²', advice: 'æ¿•åº¦è¼ƒé«˜é«”æ„Ÿå¯’å†·ï¼Œè«‹ç©¿é˜²æ»‘é‹ã€‚', icon: 'cloud' }
    },
    'd4': {
        dateStr: '2026-01-28',
        loc: 'ç¦å²¡å¸‚',
        lat: 33.590, lon: 130.401,
        backup: { temp: '9Â°C', range: '4Â°C ~ 10Â°C', desc: 'é™°å¤©', advice: 'å¸‚å€é¢¨å¤§ï¼Œå»ºè­°ç©¿è‘—é˜²é¢¨å¤–å¥—ã€‚', icon: 'cloud' }
    },
    'd5': {
        dateStr: '2026-01-29',
        loc: 'ç¦å²¡å¸‚',
        lat: 33.590, lon: 130.401,
        backup: { temp: '10Â°C', range: '3Â°C ~ 11Â°C', desc: 'æ™´æœ—', advice: 'æ—©æ™šæº«å·®å¤§ï¼Œæ´‹è”¥å¼ç©¿æ³•æœ€ä½³ã€‚', icon: 'sun' }
    },
    'd6': {
        dateStr: '2026-01-30',
        loc: 'ç¦å²¡å¸‚',
        lat: 33.590, lon: 130.401,
        backup: { temp: '9Â°C', range: '4Â°C ~ 10Â°C', desc: 'å¤šé›²æ™‚æ™´', advice: 'å®¤å…§æš–æ°£å¼·ï¼Œå…§æ­ä¸å®œéåšã€‚', icon: 'cloud-sun' }
    }
};

        // [ä¿®æ”¹ 2] è®“ Widget æ”¯æ´éåŒæ­¥è®€å–èˆ‡ Loading ç‹€æ…‹
        // [æ–°å¢] é€šç”¨å¿«å–æŠ“å–å‡½å¼ (10åˆ†é˜å¿«å–æ©Ÿåˆ¶)
// [æ–°å¢] å…¨åŸŸå¿«å–è®Šæ•¸ (é‡æ–°æ•´ç†ç¶²é å¾Œæœƒè‡ªå‹•æ¸…ç©ºï¼Œç¬¦åˆæ‚¨çš„éœ€æ±‚)
        // [API çœæµå„ªåŒ–] çµ±ä¸€å¿«å–ç®¡ç†ç³»çµ± (LocalStorage ç‰ˆ)
        const CACHE_SYSTEM = {
            // å­˜å…¥è³‡æ–™ (é è¨­ TTL ç‚º 30 åˆ†é˜)
            save: (key, data, ttlMinutes = 30) => { 
                try {
                    const record = {
                        timestamp: Date.now(),
                        expiry: ttlMinutes * 60 * 1000,
                        data: data
                    };
                    localStorage.setItem(key, JSON.stringify(record));
                } catch (e) {
                    console.warn("LocalStorage å„²å­˜å¤±æ•— (å¯èƒ½æ˜¯å®¹é‡å·²æ»¿)", e);
                }
            },
            // è®€å–è³‡æ–™
            get: (key) => {
                const json = localStorage.getItem(key);
                if (!json) return null;
                
                try {
                    const record = JSON.parse(json);
                    const now = Date.now();
                    
                    // æª¢æŸ¥æ˜¯å¦éæœŸ
                    if (now - record.timestamp > record.expiry) {
                        console.log(`[å¿«å–éæœŸ] ${key} å·²æ¸…é™¤`);
                        localStorage.removeItem(key);
                        return null;
                    }
                    
                    console.log(`[çœæµæ¨¡å¼] è®€å– LocalStorage: ${key}`);
                    return record.data;
                } catch (e) {
                    return null;
                }
            }
        };

        // [ä¿®æ”¹] æ”¯æ´ LocalStorage çš„ Fetch å‡½å¼
        async function fetchWithCache(url, cacheKey) {
            // 1. å…ˆæŸ¥å¿«å–
            const cachedData = CACHE_SYSTEM.get(cacheKey);
            if (cachedData) return cachedData;

            // 2. ç„¡å¿«å–å‰‡å‘¼å« API
            console.log(`[APIæ¶ˆè€—] å‘¼å«ç¶²è·¯: ${url}`);
            try {
                const res = await fetch(url);
                const data = await res.json();
                
                // 3. å­˜å…¥å¿«å– (å¤©æ°£è³‡æ–™å­˜ 20 åˆ†é˜)
                CACHE_SYSTEM.save(cacheKey, data, 20); 
                return data;
            } catch (e) {
                console.error("Fetch Error:", e);
                return null;
            }
        }
async function updateWeatherWidget(dayId) {
    const config = tripConfig[dayId];
    if (!config) return;

    // 1. å…ˆé¡¯ç¤º Loading ç‹€æ…‹ (æå‡ä½¿ç”¨è€…é«”é©—)
    document.getElementById('hw-loc').innerText = config.loc;
    //document.getElementById('hw-date').innerText = config.dateStr.slice(5); // åªé¡¯ç¤º MM-DD
    document.getElementById('hw-date').innerText = config.dateStr; // åªé¡¯ç¤º MM-DD
    document.getElementById('hw-temp').innerText = '--';
    document.getElementById('hw-desc').innerText = 'è®€å–ä¸­...';
    document.getElementById('hw-range').innerText = '';
    document.getElementById('hw-advice').innerText = 'è³‡æ–™æ›´æ–°ä¸­...';
    // é¡¯ç¤ºä¸€å€‹ç°¡å–®çš„è¼‰å…¥åœ–ç¤º
    document.getElementById('hw-icon').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: rotate 1s linear infinite;"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>`;

    // 2. å‘¼å«æ™ºæ…§åˆ¤æ–·å‡½æ•¸å–å¾—è³‡æ–™
    const data = await getSmartWeatherData(config);

    // 3. æ›´æ–°ç•«é¢
    document.getElementById('hw-temp').innerText = data.temp;
    document.getElementById('hw-desc').innerText = data.desc;
    document.getElementById('hw-range').innerText = data.range;
    document.getElementById('hw-advice').innerText = data.advice;
    
    // è™•ç† Icon
    const iconType = data.icon || 'cloud';
    // å¦‚æœæ˜¯ API å›å‚³çš„ï¼Œæˆ‘å€‘åªçµ¦ä»£ç¢¼ (å¦‚ sun, cloud, rain)ï¼Œå¦‚æœæ²’å°æ‡‰åˆ°å°±çµ¦ cloud
    const validIcons = ['sun', 'cloud', 'cloud-sun', 'snow', 'rain', 'fog', 'lightning'];
    const finalIcon = validIcons.includes(iconType) ? iconType : 'cloud';
    
    document.getElementById('hw-icon').innerHTML = `<div class="weather-icon ${finalIcon}"></div>`;
}
// [ä¿®æ”¹] æ™ºæ…§åˆ¤æ–·å‡½å¼ï¼šæ”¹ç”¨ã€ŒçœŸå¯¦æº«åº¦ã€ç”Ÿæˆå‹•æ…‹å»ºè­°
// [ä¿®æ”¹] æ™ºæ…§åˆ¤æ–·å‡½å¼ï¼šåŠ å…¥ 10 åˆ†é˜å¿«å–æ©Ÿåˆ¶
async function getSmartWeatherData(config) {
    const now = new Date();
    const todayStr = now.toISOString().split('T')[0]; // æ ¼å¼: YYYY-MM-DD
    
    const tripDate = new Date(config.dateStr);
    tripDate.setHours(0, 0, 0, 0);
    const todayDate = new Date();
    todayDate.setHours(0, 0, 0, 0);

    // --- æƒ…å¢ƒ A: éå»å¼ ---
    if (tripDate < todayDate) {
        console.log(`[${config.loc}] æ˜¯éå»è¡Œç¨‹ï¼Œä½¿ç”¨éœæ…‹ç´€éŒ„ã€‚`);
        return config.backup;
    }

    // --- æƒ…å¢ƒ B & C: ä»Šå¤©æˆ–æœªä¾† (å‘¼å« API + å¿«å–) ---
    try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${config.lat}&longitude=${config.lon}&daily=weathercode,temperature_2m_max,temperature_2m_min&current_weather=true&timezone=Asia%2FTokyo`;
        
        // â˜… ç”¢ç”Ÿå”¯ä¸€å¿«å–é‡‘é‘° (æ—¥æœŸ+åœ°é»)
        const cacheKey = `trip_weather_${config.dateStr}_${config.lat}`;
        
        // â˜… æ”¹ç”¨å¿«å–å‡½å¼æŠ“å–
        const json = await fetchWithCache(url, cacheKey);
        
        const index = json.daily.time.indexOf(config.dateStr);
        let displayData = {};

        // è³‡æ–™è§£æé‚è¼¯ (ç¶­æŒåŸæœ¬ä¸è®Š)
        if (config.dateStr === todayStr) {
            const current = json.current_weather;
            const todayMax = json.daily.temperature_2m_max[0];
            const todayMin = json.daily.temperature_2m_min[0];

            displayData = {
                temp: `${Math.round(current.temperature)}Â°C`, 
                range: `${Math.round(todayMin)}Â°C ~ ${Math.round(todayMax)}Â°C`,
                desc: getWeatherDescText(current.weathercode),
                icon: getWeatherIconClass(current.weathercode),
                advice: `(å³æ™‚) ${getSmartAdviceText(current.temperature, current.weathercode)}`
            };
        } 
        else if (index !== -1) {
            const code = json.daily.weathercode[index];
            const max = json.daily.temperature_2m_max[index];
            const min = json.daily.temperature_2m_min[index];
            const avgTemp = (max + min) / 2;
            
            displayData = {
                temp: `${Math.round(avgTemp)}Â°C`,
                range: `${Math.round(min)}Â°C ~ ${Math.round(max)}Â°C`,
                desc: getWeatherDescText(code),
                icon: getWeatherIconClass(code),
                advice: `(é å ±) ${getSmartAdviceText(avgTemp, code)}`
            };
        } 
        else {
            // è‹¥è¶…å‡ºé å ±ç¯„åœ (ä¾‹å¦‚7å¤©å¾Œ)ï¼Œé¡¯ç¤ºç•¶ä¸‹å¤©æ°£ä½œç‚ºåƒè€ƒ
            const current = json.current_weather;
            const todayMax = json.daily.temperature_2m_max[0];
            const todayMin = json.daily.temperature_2m_min[0];
            displayData = {
                temp: `${Math.round(current.temperature)}Â°C`,
                range: `${Math.round(todayMin)}Â°C ~ ${Math.round(todayMax)}Â°C`,
                desc: getWeatherDescText(current.weathercode),
                icon: getWeatherIconClass(current.weathercode),
                advice: `(è¡Œå‰åƒè€ƒ) ${getSmartAdviceText(current.temperature, current.weathercode)}`
            };
        }
        
        return displayData;

    } catch (e) {
        console.error("API ç²å–å¤±æ•—", e);
        return { ...config.backup, desc: config.backup.desc + ' (é›¢ç·š)', advice: 'ç¶²è·¯é€£ç·šç•°å¸¸ï¼Œé¡¯ç¤ºé›¢ç·šè³‡æ–™ã€‚' };
    }
}

// è¼”åŠ©å‡½å¼ï¼šå°‡ WMO Code è½‰æˆä¸­æ–‡æè¿°
function getWeatherDescText(code) {
    if (code === 0) return 'æ™´æœ—';
    if (code <= 3) return 'å¤šé›²';
    if (code <= 48) return 'æœ‰éœ§';
    if (code <= 67) return 'æœ‰é›¨';
    if (code <= 77) return 'æœ‰é›ª';
    if (code <= 82) return 'é™£é›¨';
    if (code <= 99) return 'é›·é›¨';
    return 'å¤šé›²';
}

// è¼”åŠ©å‡½å¼ï¼šå°‡ WMO Code è½‰æˆä½ çš„ CSS Icon Class
function getWeatherIconClass(code) {
    if (code === 0) return 'sun';
    if (code <= 3) return 'cloud-sun'; // æˆ– cloud
    if (code <= 48) return 'fog'; // ä½ å¯èƒ½éœ€è¦æ–°å¢ fog æ¨£å¼ï¼Œæˆ–ç”¨ cloud ä»£æ›¿
    if (code <= 67) return 'rain';
    if (code <= 77) return 'snow';
    if (code <= 82) return 'rain';
    if (code <= 99) return 'lightning'; // ä½ å¯èƒ½éœ€è¦æ–°å¢ lightning æ¨£å¼
    return 'cloud';
}              
// [æ–°å¢] ç©¿è¡£å»ºè­°å¤§è…¦ï¼šæ ¹æ“šã€Œæº«åº¦ã€èˆ‡ã€Œå¤©æ°£ã€è‡ªå‹•ç”Ÿæˆå»ºè­°
function getSmartAdviceText(temp, weatherCode) {
    let advice = "";
    
    // 1. æº«åº¦åˆ¤æ–· (åŸºç¤ç©¿è‘—)
    if (temp >= 30) {
        advice = "å¤©æ°£ç‚ç†±ï¼Œè«‹è‘—çŸ­è¢–ä¸¦æ³¨æ„é˜²æ›¬è£œæ°´ã€‚";
    } else if (temp >= 25) {
        advice = "æ°£æº«èˆ’é©åç†±ï¼ŒçŸ­è¢–æˆ–è–„è¡«å³å¯ã€‚";
    } else if (temp >= 20) {
        advice = "æ°£æº«å®œäººï¼Œå»ºè­°ç©¿è‘—è–„é•·è¢–æˆ–è¥¯è¡«ã€‚";
    } else if (temp >= 15) {
        advice = "ç¨æœ‰æ¶¼æ„ï¼Œå»ºè­°é•·è¢–æ­é…è–„å¤–å¥—æˆ–é¢¨è¡£ã€‚";
    } else if (temp >= 10) {
        advice = "å¤©æ°£åå†·ï¼Œè«‹ç©¿è‘—æ¯›è¡£ã€å¤¾å…‹æˆ–åšå¤–å¥—ã€‚";
    } else if (temp >= 5) {
        advice = "æ°£æº«å¯’å†·ï¼Œå‹™å¿…ç©¿è‘—ç¾½çµ¨å¤–å¥—ã€ç™¼ç†±è¡£ä¿æš–ã€‚";
    } else {
        advice = "åš´å¯’ä½æº«ï¼è«‹å…¨å‰¯æ­¦è£ï¼Œåœå·¾æ‰‹å¥—ä¸å¯å°‘ã€‚";
    }

    // 2. ç‰¹æ®Šå¤©æ°£è¿½åŠ æé†’ (ä¸‹é›¨/ä¸‹é›ª)
    if (weatherCode >= 51 && weatherCode <= 67 || weatherCode >= 80 && weatherCode <= 82) {
        advice += " å¤–å‡ºè«‹è¨˜å¾—æ”œå¸¶é›¨å…·ã€‚";
    } else if (weatherCode >= 71 && weatherCode <= 77) {
        advice += " è·¯é¢å¯èƒ½æ¿•æ»‘ï¼Œè«‹ç©¿é˜²æ»‘é‹ã€‚";
    }

    return advice;
}
        // --- REAL-TIME WEATHER FUNCTIONS (Using Open-Meteo Free API) ---
        let currentMyTemp = null;

        // æ™ºæ…§åœ°åç¿»è­¯å°ç…§è¡¨ (ä¿ç•™ä½œç‚ºå¿«é€Ÿå¿«å–ï¼Œç¯€çœ AI è³‡æº)
        const cityMapping = {
            'ç”±å¸ƒé™¢': 'Yufuin',
            'æ¹¯å¸ƒé™¢': 'Yufuin',
            'é»‘å·': 'Minamioguni', 
            'é»‘å·æº«æ³‰': 'Minamioguni',
            'ç†Šæœ¬': 'Kumamoto',
            'ç†Šæœ¬å¸‚': 'Kumamoto',
            'é˜¿è˜‡': 'Aso', 
            'åˆ¥åºœ': 'Beppu',
            'ç¦å²¡': 'Fukuoka',
            'åšå¤š': 'Fukuoka',
            'å¤ªå®°åºœ': 'Dazaifu',
            'é«˜åƒç©—': 'Takachiho'
        };

        // æ–°å¢ï¼šç¨ç«‹çš„ Gemini å‘¼å«å‡½æ•¸ï¼Œåªå›å‚³æ–‡å­—ï¼Œä¸æ“ä½œ UI
 // [ä¿®æ”¹] Gemini API å‘¼å«å‡½å¼ï¼šå‡ç´šæ”¯æ´åœ–ç‰‡å‚³é€ (Multimodal)
// [ä¿®æ”¹] Gemini API å‘¼å«å‡½å¼ï¼šå‡ç´šç‚ºæœ€æ–°çš„ Gemini 3 Flash Preview
       async function getGeminiResponse(promptText, imageBase64 = null) {
    // [ä¿®æ”¹] æŒ‡å®šç²å– Gemini çš„ Key
    const currentKey = getKey('gemini');
    if (!currentKey) {
                appendMessage('ai', 'âš ï¸ å°šæœªè¼¸å…¥æ­£ç¢ºå¯†ç¢¼ï¼Œç„¡æ³•ä½¿ç”¨ AI åŠŸèƒ½ã€‚');
                throw new Error("API Key Missing");
            }

            try {
                // 1. å»ºç«‹åŸºæœ¬çš„ parts é™£åˆ—ï¼Œå…ˆæ”¾å…¥æ–‡å­—
                let parts = [
                    { text: promptText }
                ];

                // 2. å¦‚æœæœ‰åœ–ç‰‡ï¼Œä½¿ç”¨ unshift å°‡åœ–ç‰‡ã€Œæ’éšŠã€åˆ°æœ€å‰é¢
                if (imageBase64) {
                    parts.unshift({
                        inline_data: {
                            mime_type: "image/jpeg",
                            data: imageBase64
                        }
                    });
                }

                // 3. çµ„åˆè«‹æ±‚å…§å®¹
                const requestBody = {
                    contents: [{
                        parts: parts
                    }]
                };

                // â˜… é—œéµä¿®æ”¹ï¼šä½¿ç”¨æ­£ç¢ºçš„ Gemini 3 Flash Preview æ¨¡å‹åç¨±
                // Release Date: 2025-12-17
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${currentKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                
                if (data.error) {
                    console.error("API Error Detail:", data.error);
                    throw new Error(data.error.message);
                }
                
                if (!data.candidates || !data.candidates[0].content) {
                    throw new Error("API å›å‚³ç„¡å…§å®¹ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
                }
                
                let text = data.candidates[0].content.parts[0].text.trim();
                text = text.replace(/```(html|json)?/g, '').replace(/```/g, '').trim();
                return text;

            } catch (error) {
                console.error("AI Fetch Error:", error);
                throw error;
            }
        }

        async function fetchRealtimeWeather() {
            const rawInput = document.getElementById('weather-city-input').value.trim();
            if (!rawInput) {
                alert('è«‹è¼¸å…¥åŸå¸‚åç¨±');
                return;
            }

            // UI Loading State
            document.getElementById('weather-placeholder').style.display = 'none';
            document.getElementById('weather-result').style.display = 'block';
            document.getElementById('wc-loc').innerText = rawInput; 
            document.getElementById('wc-desc').innerText = 'æº–å‚™ä¸­...';
            document.getElementById('wc-temp').innerText = '--Â°';
            document.getElementById('wc-advice').innerText = '...';

            let searchTerm = rawInput;
            let isTranslated = false;

            try {
                // æ­¥é©Ÿ 1: å…ˆæª¢æŸ¥å¿«é€Ÿå°ç…§è¡¨ (æœ€å¿«)
                for (const key in cityMapping) {
                    if (rawInput.includes(key)) {
                        searchTerm = cityMapping[key];
                        isTranslated = true;
                        console.log("ä½¿ç”¨å…§å»ºå°ç…§è¡¨:", searchTerm);
                        break;
                    }
                }

                // æ­¥é©Ÿ 2: å¦‚æœå°ç…§è¡¨æ²’æœ‰ï¼Œè«‹æ±‚ AI åœ¨èƒŒæ™¯ç¿»è­¯ (æ‚¨çš„æ–°æƒ³æ³•!)
                // æ­¥é©Ÿ 2: AI èƒŒæ™¯ç¿»è­¯ (å·²åŠ å…¥æ°¸ä¹…å¿«å–)
                if (!isTranslated) {
                    // [æ–°å¢] å…ˆæŸ¥å¿«å– (é‡‘é‘°: city_trans_ä¸­æ–‡å)
                    const cacheKey = `city_trans_${rawInput}`;
                    const cachedName = CACHE_SYSTEM.get(cacheKey);

                    if (cachedName) {
                        searchTerm = cachedName;
                        isTranslated = true;
                        console.log("ä½¿ç”¨å¿«å–åœ°å:", searchTerm);
                        document.getElementById('wc-desc').innerText = `æœå°‹: ${searchTerm} (å¿«å–)`;
                    } else {
                        // ç„¡å¿«å–ï¼Œæ‰å‘¼å« AI
                        document.getElementById('wc-desc').innerText = 'ğŸ” AI æ­£åœ¨ç¿»è­¯åœ°å...';
                        
                        const translatePrompt = `
                            Task: Translate the place name "${rawInput}" into its official English Romanization name for using in a Weather API.
                            Target: Global locations (Focus on Taiwan/Japan).
                            Rule: Output ONLY the English name. No explanations.
                            Example: "å°åŒ—" -> "Taipei", "ç”±å¸ƒé™¢" -> "Yufuin", "æ–°ç«¹" -> "Hsinchu".
                        `;
                        
                        try {
                            const aiTranslation = await getGeminiResponse(translatePrompt);
                            if (/^[a-zA-Z\s\-,]+$/.test(aiTranslation)) {
                                searchTerm = aiTranslation;
                                isTranslated = true;
                                console.log("AI ç¿»è­¯çµæœ:", searchTerm);
                                document.getElementById('wc-desc').innerText = `æœå°‹: ${searchTerm}...`;
                                
                                // [æ–°å¢] ç¿»è­¯æˆåŠŸå¾Œï¼Œå­˜å…¥å¿«å– (ä¿å­˜ 24 å°æ™‚ = 1440 åˆ†é˜)
                                CACHE_SYSTEM.save(cacheKey, searchTerm, 1440);
                            }
                        } catch (e) {
                            console.warn("AI ç¿»è­¯å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨åŸå§‹ä¸­æ–‡æœå°‹");
                        }
                    }
                }

                document.getElementById('wc-desc').innerText = 'é€£ç·šæ°£è±¡è¡›æ˜Ÿ...';

                // æ­¥é©Ÿ 3: Geocoding API æŸ¥è©¢
                // å„ªå…ˆä½¿ç”¨ç¿»è­¯å¾Œçš„è‹±æ–‡ï¼Œè‹¥ç„¡å‰‡ç”¨ä¸­æ–‡
                // [ä¿®æ”¹] count=10 ä»¥ç²å–æ›´å¤šå€™é¸åœ°é»ä¾†ç¯©é¸æ—¥æœ¬
                let geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(searchTerm)}&count=10&language=en&format=json`;
                let geoRes = await fetch(geoUrl);
                let geoData = await geoRes.json();

                // è‹±æ–‡æ‰¾ä¸åˆ°ï¼Œæœ€å¾Œå˜—è©¦ä¸­æ–‡
                if ((!geoData.results || geoData.results.length === 0) && isTranslated) {
                     geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(rawInput)}&count=10&language=zh&format=json`;
                     geoRes = await fetch(geoUrl);
                     geoData = await geoRes.json();
                }

                if (!geoData.results || geoData.results.length === 0) {
                     throw new Error(`æ‰¾ä¸åˆ°ã€Œ${rawInput}ã€<br>AI ç¿»è­¯: ${searchTerm}`);
                }

                // [æ–°å¢] ç¯©é¸é‚è¼¯ï¼šå„ªå…ˆæ‰¾æ—¥æœ¬çš„çµæœ
                let targetLocation = geoData.results[0];
                const jpLocation = geoData.results.find(r => r.country_code === 'JP' || r.country === 'Japan');
                if (jpLocation) {
                    targetLocation = jpLocation;
                    console.log("å·²è‡ªå‹•é–å®šæ—¥æœ¬åœ°é»:", targetLocation.name);
                }

                const { latitude, longitude, name, country } = targetLocation;
                
                // æ­¥é©Ÿ 4: å–å¾—å¤©æ°£
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`;
                const weatherRes = await fetch(weatherUrl);
                const weatherData = await weatherRes.json();

                const temp = weatherData.current_weather.temperature;
                const weatherCode = weatherData.current_weather.weathercode;

                // Update UI with Vertical English Name (ä¸Šä¸‹åˆ†å±¤)
                let displayLocHtml = rawInput;
                if (searchTerm && searchTerm.toLowerCase() !== rawInput.toLowerCase()) {
                    displayLocHtml = `
                        <div style="display: flex; flex-direction: column; align-items: center; line-height: 1.2;">
                            <span>${rawInput}</span>
                            <span style="font-size: 0.6em; opacity: 0.8; font-weight: 400; margin-top: 4px; font-family: sans-serif; letter-spacing: 0.5px;">${searchTerm}</span>
                        </div>
                    `;
                }
                document.getElementById('wc-loc').innerHTML = displayLocHtml;

                document.getElementById('wc-temp').innerText = `${temp}Â°C`;
                // ä¿®æ­£ 3: æ”¹ç”¨ innerHTML ä»¥æ”¯æ´ SVG åœ–ç¤º
                document.getElementById('wc-desc').innerHTML = getWeatherDesc(weatherCode);

                // æ­¥é©Ÿ 5: æº«å·®å°æ¯”
                updateComparison(temp);

                // æ­¥é©Ÿ 6: AI ç©¿è¡£å»ºè­°
                document.getElementById('wc-advice').innerText = 'AI æ­£åœ¨åˆ†æç•¶åœ°æ°£å€™...';
                askAiWeatherAdvice(rawInput, temp, getWeatherDesc(weatherCode));

            } catch (error) {
                console.error(error);
                document.getElementById('wc-desc').innerText = 'æŸ¥è©¢å¤±æ•—';
                
                let errorMsg = error.message;
                if (errorMsg.includes('Failed to fetch')) {
                    errorMsg = 'ç¶²è·¯é€£ç·šè¢«é˜»æ“‹ã€‚<br>è«‹æª¢æŸ¥ç¶²è·¯è¨­å®šã€‚';
                }
                
                document.getElementById('wc-advice').innerHTML = `<span style="color:var(--danger); font-weight:bold;">${errorMsg}</span>`;
            }
        }

        // ä¿®æ­£ 2: å®šç¾©ç°¡ç´„å¤©æ°£ SVG åœ–ç¤º (ç™½è‰²ç·šæ¢)
        const simpleIcons = {
            sun: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>',
            cloud: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>',
            rain: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 13v8"></path><path d="M8 13v8"></path><path d="M12 15v8"></path><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"></path></svg>',
            snow: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 10H4a7 7 0 1 1 7-7v.5"></path><path d="M10 14a6 6 0 0 0-6-6"></path><line x1="12" y1="16" x2="12" y2="22"></line><line x1="12" y1="22" x2="9" y2="19"></line><line x1="12" y1="22" x2="15" y2="19"></line><line x1="18.5" y1="12" x2="22" y2="12"></line><line x1="22" y1="12" x2="19.5" y2="9.5"></line><line x1="22" y1="12" x2="19.5" y2="14.5"></line><line x1="5" y1="18.5" x2="2" y2="18.5"></line><line x1="2" y1="18.5" x2="4.5" y2="21"></line><line x1="2" y1="18.5" x2="4.5" y2="16"></line><line x1="17.5" y1="18.5" x2="20.5" y2="21"></line><line x1="17.5" y1="18.5" x2="20.5" y2="16"></line></svg>',
            fog: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 6h14M4 10h16M6 14h12M4 18h16"></path></svg>',
            lightning: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9"></path><polyline points="13 11 9 17 15 17 11 23"></polyline></svg>'
        };

        function getWeatherDesc(code) {
            // Updated to return HTML with Simple SVG
            if (code === 0) return `æ™´æœ— ${simpleIcons.sun}`;
            if (code >= 1 && code <= 3) return `å¤šé›² ${simpleIcons.cloud}`;
            if (code >= 45 && code <= 48) return `æœ‰éœ§ ${simpleIcons.fog}`;
            if (code >= 51 && code <= 67) return `æœ‰é›¨ ${simpleIcons.rain}`;
            if (code >= 71 && code <= 77) return `æœ‰é›ª ${simpleIcons.snow}`;
            if (code >= 80 && code <= 82) return `é™£é›¨ ${simpleIcons.rain}`;
            if (code >= 95) return `é›·é›¨ ${simpleIcons.lightning}`;
            return `å¤šé›² ${simpleIcons.cloud}`;
        }

// [ä¿®æ”¹] å–å¾—å®šä½å¤©æ°£ (åŒæ­¥æ›´æ–° Header èˆ‡ åˆ†é )
// [ä¿®æ”¹] å–å¾—å®šä½å¤©æ°£ (å„²å­˜å¤©æ°£ä»£ç¢¼ä¾› AI è®€å–)
        // [ä¿®æ”¹] å–å¾—å®šä½å¤©æ°£ (é˜²å¡æ­»ç©©å®šç‰ˆ)
        // [ä¿®æ”¹] æ™ºæ…§å®šä½å‡½å¼ï¼šæ‰‹æ©Ÿç”¨é«˜ç²¾ç¢ºåº¦ï¼Œé›»è…¦è‡ªå‹•é™ç´šç‚ºä¸€èˆ¬æ¨¡å¼
        // [ä¿®æ”¹] çµ‚æ¥µå®šä½å‡½å¼ï¼šæ”¯æ´ GPS (æ‰‹æ©Ÿ)ã€Wi-Fi (ç­†é›») èˆ‡ æœ‰ç·šç¶²è·¯ (æ¡Œæ©Ÿ)
        // [ä¿®æ­£ç‰ˆ] æ··åˆé›™è»Œå®šä½ï¼šæ‰‹æ©ŸæŠ“ç²¾ç¢ºã€é›»è…¦æŠ“ IPï¼Œç¢ºä¿ 100% æˆåŠŸç‡
        // [æ™ºæ…§å®šä½å‡½å¼] å®Œç¾è§£æ±ºæ–¹æ¡ˆï¼šæ‰‹æ©Ÿå„ªå…ˆæŠ“ GPSï¼Œé›»è…¦è‡ªå‹•é€€å›æŠ“ IP
        // [æœ€çµ‚ç‰ˆ] è£ç½®åˆ†æµå®šä½ï¼šé›»è…¦æ¨¡æ“¬èˆŠç‰ˆè¡Œç‚º(IP)ï¼Œæ‰‹æ©Ÿå•Ÿç”¨é«˜ç²¾åº¦(GPS)
        function getLocalWeather() {
            // å®šç¾© UI 
            const els = {
                headerLoc: document.getElementById('header-my-loc'),
                headerTemp: document.getElementById('header-my-temp'),
                tabTemp: document.getElementById('wc-my-temp'),
                titleBox: document.getElementById('wc-loc-box') 
            };

            // 1. æª¢æŸ¥ç€è¦½å™¨æ”¯æ´
            if (!navigator.geolocation) {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å®šä½');
                return;
            }

            // UI é¡¯ç¤º
            if(els.headerLoc) els.headerLoc.innerText = 'å®šä½ä¸­...';
            if(els.titleBox) els.titleBox.innerHTML = '<span class="loading-dots">å®šä½ä¸­</span>';

            // 2. åˆ¤æ–·è£ç½®é¡å‹ï¼šæ˜¯æ‰‹æ©Ÿå—ï¼Ÿ
            // å¦‚æœæ˜¯ iPhone, Android ç­‰è¡Œå‹•è£ç½®ï¼ŒisMobile æœƒæ˜¯ true
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // ç­–ç•¥ï¼šæ‰‹æ©Ÿç”¨ true (é«˜ç²¾åº¦)ï¼Œé›»è…¦å¼·åˆ¶ç”¨ false (ä½ç²¾åº¦ï¼Œåƒ index_ai ä¸€æ¨£)
            const useHighAccuracy = isMobile; 
            
            console.log(`è£ç½®åµæ¸¬: ${isMobile ? "æ‰‹æ©Ÿ (å•Ÿç”¨ GPS)" : "é›»è…¦ (ä½¿ç”¨ IP å®šä½)"}`);

            // === æˆåŠŸé‚è¼¯ ===
            const handleSuccess = async (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                
                try {
                    // A. æŠ“å¤©æ°£ (åŠ å…¥ timezone=auto ä»¥ç²å–ç²¾ç¢ºæ™‚å€)
                    const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`);
                    const weatherData = await weatherRes.json();
                    
                    currentMyTemp = weatherData.current_weather.temperature;
                    const tempStr = `${Math.round(currentMyTemp)}Â°C`;
                    const code = weatherData.current_weather.weathercode;
                    
                    // [æ–°å¢] å–å¾— API å›å‚³çš„ç•¶åœ°æ™‚å€ (ä¾‹å¦‚ "Asia/Tokyo")
                    const localTimezone = weatherData.timezone;
                    
                    // B. AI è§£æåœ°å
                    let displayZh = "æˆ‘çš„ä½ç½®";
                    try {
                        // æç¤ºè©
                        const locationPrompt = `Task: Identify the specific district/township name for ${lat},${lon} (e.g., ç«¹åŒ—å¸‚, æ–°ç«¹å¸‚æ±å€, åšå¤šå€). Output ONLY the Traditional Chinese name.`;
                        // å‘¼å« AI (è¨­å®š 10ç§’ è¶…æ™‚)
                        const aiPromise = getGeminiResponse(locationPrompt);
                        const timeoutPromise = new Promise((_, reject) => setTimeout(() => reject(new Error("Timeout")), 10000));
                        const aiCity = await Promise.race([aiPromise, timeoutPromise]);
                        if (aiCity) displayZh = aiCity.trim();
                    } catch (e) {
                        console.warn("AI è§£æç•¥é");
                    }

                    // C. æ›´æ–° UI
                    if(els.headerLoc) els.headerLoc.innerText = displayZh;
                    if(els.headerTemp) els.headerTemp.innerText = tempStr;
                    if(els.tabTemp) {
                        els.tabTemp.innerText = tempStr;
                        els.tabTemp.style.fontSize = '1.5rem';
                        els.tabTemp.style.color = '#1F2937';
                    }
                    if(els.titleBox) {
                        els.titleBox.innerHTML = `
                            <div style="display: flex; align-items: center; justify-content: center; gap: 4px;">
                                <svg class="icon-mini" style="color: #EF4444;" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                                <span>${displayZh}</span>
                            </div>`;
                    }
                    
                    // å­˜æª”èˆ‡æ¯”å°
                    window.appCache = window.appCache || {};
                    window.appCache['my_location_combined'] = {
                        timestamp: Date.now(),
                        data: { 
                            temp: currentMyTemp, 
                            city: displayZh, 
                            code: code,
                            timezone: localTimezone // [æ–°å¢] å„²å­˜æ™‚å€
                        }
                    };
                    const targetTempStr = document.getElementById('wc-temp') ? document.getElementById('wc-temp').innerText : '--Â°';
                    if (targetTempStr !== '--Â°') updateComparison(parseFloat(targetTempStr));

                } catch (e) {
                    console.error("è™•ç†å¤±æ•—", e);
                    if(els.headerLoc) els.headerLoc.innerText = 'é€£ç·šå¤±æ•—';
                }
            };

            // === å¤±æ•—è™•ç† (åªé‡å°æ‰‹æ©Ÿçš„é«˜ç²¾åº¦å¤±æ•—é€²è¡Œé™ç´š) ===
            const handleError = (err) => {
                console.warn("å®šä½å¤±æ•—:", err.code, err.message);
                
                // å¦‚æœæ˜¯æ‰‹æ©Ÿå˜—è©¦é«˜ç²¾åº¦å¤±æ•—äº†ï¼Œå†çµ¦å®ƒä¸€æ¬¡æ©Ÿæœƒç”¨ä½ç²¾åº¦
                if (useHighAccuracy) {
                    console.log("æ‰‹æ©Ÿ GPS å¤±æ•—ï¼Œå˜—è©¦åˆ‡æ› IP å®šä½...");
                    navigator.geolocation.getCurrentPosition(
                        handleSuccess,
                        (err2) => {
                             alert("å®šä½å¤±æ•—ï¼Œè«‹ç¢ºèªæ‰‹æ©Ÿå®šä½æœå‹™å·²é–‹å•Ÿã€‚");
                             if(els.headerLoc) els.headerLoc.innerText = 'å®šä½æœªé–‹';
                        },
                        { enableHighAccuracy: false, timeout: 10000, maximumAge: 0 }
                    );
                } else {
                    // é›»è…¦ä½ç²¾åº¦å¦‚æœä¹Ÿå¤±æ•—ï¼Œé‚£å°±æ˜¯çœŸçš„è¢«å°é–æˆ–æ²’ç¶²è·¯äº†
                    if(els.headerLoc) els.headerLoc.innerText = 'ç„¡æ³•å®šä½';
                    alert("é›»è…¦ç„¡æ³•å–å¾—ä½ç½®ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ¬Šé™ã€‚");
                }
            };

            // === 3. é–‹å§‹åŸ·è¡Œ ===
            // é€™è£¡ä½¿ç”¨äº†è®Šæ•¸ useHighAccuracy
            // é›»è…¦ç‰ˆï¼šuseHighAccuracy ç‚º false -> è¡Œç‚ºç­‰åŒ index_ai (ä¸æœƒå ±éŒ¯)
            // æ‰‹æ©Ÿç‰ˆï¼šuseHighAccuracy ç‚º true -> è¡Œç‚ºç­‰åŒ index (æŠ“ç«¹åŒ—)
            navigator.geolocation.getCurrentPosition(
                handleSuccess, 
                handleError, 
                { enableHighAccuracy: useHighAccuracy, timeout: 5000, maximumAge: 0 }
            );
        }

        // --- Modal Functions (å–ä»£åŸç”Ÿ alert/prompt) ---
        function openModal(msg) {
            document.getElementById('modal-msg').innerText = msg;
            document.getElementById('location-modal').style.display = 'flex';
            document.getElementById('modal-city-input').focus();
        }

        function closeModal() {
            document.getElementById('location-modal').style.display = 'none';
        }
        // [æ–°å¢] éš¨èº«ç­†è¨˜åŠŸèƒ½ (è‡ªå‹•å„²å­˜)
        const NOTE_STORAGE_KEY = 'kyushu_trip_note_2026';

        function openNoteModal() {
            const modal = document.getElementById('note-modal');
            const area = document.getElementById('note-area');
            const status = document.getElementById('note-status');
            
            // 1. è®€å–èˆŠç­†è¨˜
            area.value = localStorage.getItem(NOTE_STORAGE_KEY) || '';
            status.innerText = '';
            
            modal.style.display = 'flex';
            
            // 2. ç¶å®šè¼¸å…¥äº‹ä»¶ (å³æ™‚è‡ªå‹•å„²å­˜)
            area.oninput = function() {
                localStorage.setItem(NOTE_STORAGE_KEY, area.value);
                status.innerText = 'å·²è‡ªå‹•å„²å­˜ âœ“';
            };
        }

        function closeNoteModal() {
            document.getElementById('note-modal').style.display = 'none';
        }
/* --- åœ¨ function closeNoteModal() { ... } çµæŸå¾Œæ’å…¥ --- */

        // [æ–°å¢] åŒ¯ç‡è¨ˆç®—æ©Ÿèˆ‡ API ä¸²æ¥é‚è¼¯
        function openCalcModal() {
            document.getElementById('calc-modal').style.display = 'flex';
            
            // 1. å…ˆå˜—è©¦è®€å–å¿«å– (é¿å…æ¯æ¬¡é–‹éƒ½æ‰“ API)
            const savedRateData = JSON.parse(localStorage.getItem('live_exchange_rate_cache') || '{}');
            const now = Date.now();
            const oneHour = 3600000; // 1å°æ™‚æ¯«ç§’æ•¸
            
            // å¦‚æœæœ‰å¿«å–ä¸”åœ¨ 1 å°æ™‚å…§ï¼Œå°±ç”¨å¿«å–ï¼Œå¦å‰‡æŠ“æ–°çš„
            if (savedRateData.rate && (now - savedRateData.timestamp < oneHour)) {
                updateRateUI(savedRateData.rate, 'å¿«å–');
            } else {
                fetchLiveRate();
            }
            
            document.getElementById('inp-jpy').focus();
        }

        function closeCalcModal() {
            document.getElementById('calc-modal').style.display = 'none';
        }

        // æŠ“å–å³æ™‚åŒ¯ç‡ (ä¾†æº: å…è²»å…¬é–‹ API)
        async function fetchLiveRate() {
            const statusEl = document.getElementById('rate-status');
            statusEl.innerText = 'âŸ³ æ›´æ–°ä¸­...';
            statusEl.style.color = '#F59E0B';

            try {
                // ä½¿ç”¨ ExchangeRate-API (ä»¥æ—¥å¹£ JPY ç‚ºåŸºæº–)
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const data = await res.json();
                
                // æŠ“å–å°å°å¹£ (TWD) çš„åŒ¯ç‡
                const newRate = data.rates.TWD;
                
                if (newRate) {
                    // å„²å­˜åˆ° LocalStorage
                    localStorage.setItem('live_exchange_rate_cache', JSON.stringify({
                        rate: newRate,
                        timestamp: Date.now()
                    }));
                    updateRateUI(newRate, 'å³æ™‚');
                    
                    // å¦‚æœåŸæœ¬æœ‰è¼¸å…¥æ•¸å­—ï¼Œè‡ªå‹•é‡ç®—
                    if(document.getElementById('inp-jpy').value) calculateExchange('jpy');
                }
            } catch (e) {
                console.error("åŒ¯ç‡æ›´æ–°å¤±æ•—", e);
                statusEl.innerText = 'âš ï¸ é€£ç·šå¤±æ•—';
                statusEl.style.color = '#EF4444';
                // å¤±æ•—æ™‚è‹¥æ²’å€¼ï¼Œçµ¦å€‹é è¨­å€¼
                if(!document.getElementById('calc-rate').value) document.getElementById('calc-rate').value = 0.22;
            }
        }

        function updateRateUI(rate, type) {
            document.getElementById('calc-rate').value = rate;
            const statusEl = document.getElementById('rate-status');
            statusEl.innerText = `â— ${type}åŒ¯ç‡`;
            statusEl.style.color = '#10B981'; // ç¶ è‰²
        }

        function calculateExchange(source) {
            const rateInput = document.getElementById('calc-rate');
            const jpyInput = document.getElementById('inp-jpy');
            const twdInput = document.getElementById('inp-twd');
            
            let rate = parseFloat(rateInput.value);
            if (isNaN(rate) || rate <= 0) rate = 0.22; 

            if (source === 'jpy') {
                const jpy = parseFloat(jpyInput.value);
                if (!isNaN(jpy)) {
                    twdInput.value = Math.round(jpy * rate);
                } else {
                    twdInput.value = '';
                }
            } else if (source === 'twd') {
                const twd = parseFloat(twdInput.value);
                if (!isNaN(twd)) {
                    jpyInput.value = Math.round(twd / rate);
                } else {
                    jpyInput.value = '';
                }
            } else {
                // ä¿®æ”¹åŒ¯ç‡æ™‚ -> æ›´æ–°å°å¹£
                const jpy = parseFloat(jpyInput.value);
                if (!isNaN(jpy)) {
                    twdInput.value = Math.round(jpy * rate);
                }
            }
        }


        // é»æ“ŠèƒŒæ™¯é—œé–‰è¦–çª— (ä¿®æ”¹ç‰ˆ)
        window.onclick = function(event) {
            const nModal = document.getElementById('note-modal');
            const lModal = document.getElementById('location-modal');
            const cModal = document.getElementById('calc-modal'); // [æ–°å¢]
            
            if (event.target == nModal) nModal.style.display = "none";
            if (event.target == lModal) lModal.style.display = "none";
            if (event.target == cModal) cModal.style.display = "none"; // [æ–°å¢]
        }
        
// [ä¿®æ”¹] å…©æ®µå¼åˆ†äº«åŠŸèƒ½ (è§£æ±ºç€è¦½å™¨é˜»æ“‹è¦–çª—å•é¡Œ)
        // ç‹€æ…‹æ¨™è¨˜ï¼šç´€éŒ„ç›®å‰æ˜¯å¦å·²ç¶“åˆ†æå®Œæˆ
        // --- [æ–°å¢] Google Places API æ•‘æ´å‡½å¼ (ä¸‰éšæ®µå®šä½é‚è¼¯ç”¨) ---
    const fetchGooglePlaces = async (lat, lng, radius = 50) => {
    // [ä¿®æ”¹] æŒ‡å®šç²å– Google Places çš„ Key
    const currentKey = getKey('places'); 
    if (!currentKey) return [];

        const centerLat = Number(lat);
        const centerLng = Number(lng);
        
        // å®šç¾©è¦æœå°‹çš„åœ°æ¨™é¡å‹ (æ’é™¤å¤ªéç± çµ±çš„é¡å‹)
         const validTypes = [
      "restaurant", "cafe", "convenience_store", "tourist_attraction", 
      "park", "store", "lodging", "transit_station", "museum", "shopping_mall"
    ];

        const url = `https://places.googleapis.com/v1/places:searchNearby`;
        const body = {
            includedTypes: validTypes,
            maxResultCount: 1, // æˆ‘å€‘åªéœ€è¦æœ€æ¥è¿‘çš„é‚£ä¸€å€‹
            locationRestriction: {
                circle: {
                    center: { latitude: centerLat, longitude: centerLng },
                    radius: Number(radius), // æœå°‹åŠå¾‘ (å…¬å°º)
                },
            },
            languageCode: "zh-TW",
        };

        try {
            const res = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-Goog-Api-Key": currentKey,
                    "X-Goog-FieldMask": "places.displayName,places.addressDescriptor", 
                },
                body: JSON.stringify(body),
            });
            if (!res.ok) return [];
            const data = await res.json();
            return data.places || [];
        } catch (e) {
            console.error("Google Places API Error:", e);
            return [];
        }
    };
        let isLocReady = false;
        let pendingShareData = null;

// [ä¿®æ”¹] æ™ºæ…§åˆ†äº«åŠŸèƒ½ (å˜—è©¦ä¸€éµå®Œæˆï¼Œé‡é˜»æ“‹å‰‡å„ªé›…è®Šèº«)
        // [ä¿®æ”¹] æ™ºæ…§åˆ†äº«åŠŸèƒ½ (ä¸‰éšæ®µç²¾æº–å®šä½ç‰ˆ)
        function shareCurrentLocation() {
            const btn = document.getElementById('btn-share-loc');

            // --- [éšæ®µäºŒ] å¦‚æœæŒ‰éˆ•å·²ç¶“æ˜¯ã€Œæº–å‚™å®Œæˆã€ç‹€æ…‹ï¼Œç›´æ¥ç™¼å°„ ---
            if (btn.dataset.shareState === 'ready' && window.pendingShareData) {
                navigator.share(window.pendingShareData)
                    .then(() => {
                        resetShareButton(btn); // åˆ†äº«æˆåŠŸå¾Œå¾©åŸ
                    })
                    .catch((err) => {
                        console.log("ä½¿ç”¨è€…å–æ¶ˆåˆ†äº«", err);
                    });
                return; 
            }

            // --- [éšæ®µä¸€] æ­£å¸¸æµç¨‹ (ç¬¬ä¸€æ¬¡é»æ“Š) ---
            if (!navigator.geolocation) {
                alert("æ‚¨çš„è£ç½®ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚");
                return;
            }

            // é˜²æ­¢é‡è¤‡é»æ“Š
            if (btn.dataset.shareState === 'analyzing') return;

            // 1. é–å®šä¸¦è®Šæ›´ç‚ºã€Œé›·é”åˆ†æä¸­ã€å‹•ç•«
            if (!btn.dataset.originalHtml) {
                btn.dataset.originalHtml = btn.innerHTML;
            }
            
            btn.dataset.shareState = 'analyzing';
            btn.style.pointerEvents = "none"; 
            
            // é›·é”å‹•ç•«
            btn.innerHTML = `
                <svg viewBox="0 0 24 24" style="width: 28px; height: 28px; color: #10B981;">
                    <circle cx="12" cy="12" r="4" fill="currentColor"></circle>
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none">
                        <animate attributeName="r" from="4" to="12" dur="1.5s" repeatCount="indefinite" />
                        <animate attributeName="opacity" from="1" to="0" dur="1.5s" repeatCount="indefinite" />
                    </circle>
                </svg>
            `;
            btn.style.background = "#ECFDF5"; 
            btn.style.borderColor = "#10B981"; 
            btn.style.color = "#10B981";      
            btn.style.opacity = "0.8";

            // 2. åŸ·è¡Œå®šä½ (åŠ ä¸Š async ä»¥æ”¯æ´ await)
            navigator.geolocation.getCurrentPosition(async position => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                
                const mapUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
                
                let locationName = ""; 
                let locationSource = ""; 

                try {
                    // --- ç¬¬ä¸€é—œï¼šOSM (Nominatim) ---
                    const osmUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1&accept-language=zh-TW`;
                    const osmRes = await fetch(osmUrl);
                    const osmData = await osmRes.json();
                    
                    if (osmData && osmData.name) {
                        locationName = osmData.name;
                        locationSource = "(OSM)";
                    }

                    // --- ç¬¬äºŒé—œï¼šGoogle Places API (NEW) æ•‘æ´ ---
                    if (!locationName) {
                        console.log("OSM ç„¡åœ°æ¨™åï¼Œå•Ÿç”¨ Google Places æ•‘æ´...");
                        // å‘¼å«æˆ‘å€‘å‰›å‰›æ–°å¢çš„è¼”åŠ©å‡½å¼
                        const googlePlaces = await fetchGooglePlaces(lat, lon, 100); 
                        
                        if (googlePlaces.length > 0 && googlePlaces[0].displayName) {
                            locationName = googlePlaces[0].displayName.text;
                            locationSource = "(Google)";
                        }
                    }

                    // --- ç¬¬ä¸‰é—œï¼šOSM é–€ç‰Œåœ°å€ (Fallback) ---
                    if (!locationName && osmData && osmData.address) {
                        const addr = osmData.address;
                        const road = addr.road || addr.pedestrian || "";
                        const houseNum = addr.house_number || "";
                        const suburb = addr.suburb || addr.neighbourhood || "";
                        
                        if (road) {
                            locationName = `${road}${houseNum ? " " + houseNum + "" : ""}`;
                        } else if (suburb) {
                            locationName = suburb;
                        } else {
                            locationName = osmData.display_name.split(',')[0];
                        }
                        locationSource = "(åœ°å€)";
                    }

                    if (!locationName) locationName = "æˆ‘çš„ä½ç½®";
                    console.log(`å®šä½å®Œæˆ: ${locationName} ${locationSource}`);

                } catch (e) {
                    console.error("å®šä½è§£æå¤±æ•—", e);
                    locationName = "æˆ‘çš„ä½ç½®";
                }

                // C. æº–å‚™å…¨åŸŸè³‡æ–™
                window.pendingShareData = {
                    title: 'æˆ‘çš„å³æ™‚ä½ç½®',
                    text: `ã€å ±å¹³å®‰ã€‘æˆ‘ç›®å‰åœ¨ã€Œ${locationName}ã€é™„è¿‘`,
                    url: mapUrl
                };

                // D. å˜—è©¦è§¸ç™¼åˆ†äº«
                try {
                    await navigator.share(window.pendingShareData);
                    resetShareButton(btn);
                } catch (err) {
                    // è¢«é˜»æ“‹æ™‚ï¼Œåˆ‡æ›ç‚ºæ‰‹å‹•ç™¼é€æŒ‰éˆ•
                    console.log("è‡ªå‹•åˆ†äº«æœªè§¸ç™¼ï¼Œåˆ‡æ›ç‚ºæ‰‹å‹•æ¨¡å¼");
                    btn.style.pointerEvents = "auto";
                    btn.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:24px;height:24px; animation: popIn 0.3s;">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                        é»æ“Šç™¼é€
                    `;
                    btn.style.background = "#10B981"; 
                    btn.style.borderColor = "#10B981";
                    btn.style.color = "white";
                    btn.style.opacity = "1";
                    btn.dataset.shareState = 'ready';
                    if(navigator.vibrate) navigator.vibrate(50);
                }

            }, error => {
                console.error(error);
                alert("ç„¡æ³•å–å¾—ä½ç½®ï¼Œè«‹ç¢ºèª GPS å·²é–‹å•Ÿã€‚");
                resetShareButton(btn);
            }, { 
                enableHighAccuracy: true,
                timeout: 10000, 
                maximumAge: 0 
            });
        }
        // è¼”åŠ©å‡½å¼ï¼šé‡ç½®æŒ‰éˆ•
        // è«‹æ›´æ–°é€™å€‹è¼”åŠ©å‡½å¼ (é€šå¸¸åœ¨ç¨‹å¼ç¢¼æœ€ä¸‹æ–¹)
function resetShareButton(btn) {
    if (btn.dataset.originalHtml) {
        btn.innerHTML = btn.dataset.originalHtml;
    }
    btn.style.background = ""; 
    btn.style.borderColor = ""; 
    btn.style.color = "";
    btn.style.opacity = "";
    btn.style.pointerEvents = "auto"; // æ¢å¾©å¯é»æ“Š
    
    // æ¸…é™¤ç‹€æ…‹æ¨™è¨˜èˆ‡æš«å­˜è³‡æ–™
    delete btn.dataset.shareState;
    window.pendingShareData = null;
}
        async function submitManualLocation() {
            const manualCity = document.getElementById('modal-city-input').value.trim();
            if (!manualCity) return;
            
            closeModal();
            
            const tempEl = document.getElementById('wc-my-temp');
            tempEl.innerText = 'æŸ¥è©¢ä¸­..';
            tempEl.style.color = '#2563EB';
            tempEl.style.fontSize = '1.2rem';
            
            // --- æ–°å¢ï¼šæ™ºæ…§ç¿»è­¯é‚è¼¯ (èˆ‡å¤©æ°£æŸ¥è©¢åŒæ­¥) ---
            let searchTerm = manualCity;
            let isTranslated = false;

            // 1. æª¢æŸ¥å…§å»ºå°ç…§è¡¨
            for (const key in cityMapping) {
                if (manualCity.includes(key)) {
                    searchTerm = cityMapping[key];
                    isTranslated = true;
                    break;
                }
            }

            // 2. AI èƒŒæ™¯ç¿»è­¯ (è‹¥å°ç…§è¡¨æ²’æœ‰)
            if (!isTranslated) {
                // æç¤ºä½¿ç”¨è€…æ­£åœ¨ç¿»è­¯
                tempEl.innerText = 'ç¿»è­¯ä¸­..';
                
                const translatePrompt = `
                    Task: Translate the place name "${manualCity}" into its official English Romanization name for using in a Weather API.
                    Target: Global locations (Focus on Taiwan/Japan).
                    Rule: Output ONLY the English name. No explanations.
                    Example: "å°åŒ—" -> "Taipei", "ç”±å¸ƒé™¢" -> "Yufuin", "æ–°ç«¹" -> "Hsinchu".
                `;
                
                try {
                    const aiTranslation = await getGeminiResponse(translatePrompt);
                    if (/^[a-zA-Z\s\-,]+$/.test(aiTranslation)) {
                        searchTerm = aiTranslation;
                        isTranslated = true;
                        console.log("æ‰‹å‹•ä½ç½® AI ç¿»è­¯çµæœ:", searchTerm);
                    }
                } catch (e) {
                    console.warn("AI ç¿»è­¯å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŸå§‹ä¸­æ–‡æœå°‹");
                }
            }
            
            tempEl.innerText = 'é€£ç·šä¸­..';
            // --- é‚è¼¯çµæŸ ---

            try {
                // ä½¿ç”¨ Geocoding API æŸ¥è©¢
                // å„ªå…ˆä½¿ç”¨ç¿»è­¯å¾Œçš„è‹±æ–‡æœå°‹ (ç²¾æº–åº¦è¼ƒé«˜)
                // [ä¿®æ”¹] count=10
                let geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(searchTerm)}&count=10&language=en&format=json`;
                let geoRes = await fetch(geoUrl);
                let geoData = await geoRes.json();

                // å¦‚æœè‹±æ–‡æ‰¾ä¸åˆ°ï¼Œå˜—è©¦ç”¨åŸå§‹ä¸­æ–‡æœå°‹ (Fallback)
                if ((!geoData.results || geoData.results.length === 0) && isTranslated) {
                    geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(manualCity)}&count=10&language=zh&format=json`;
                    geoRes = await fetch(geoUrl);
                    geoData = await geoRes.json();
                }

                if (!geoData.results || geoData.results.length === 0) {
                    tempEl.innerText = 'æŸ¥ç„¡æ­¤åœ°';
                    // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹ä¸¦é¡¯ç¤ºéŒ¯èª¤
                    setTimeout(() => openModal(`æ‰¾ä¸åˆ°ã€Œ${manualCity}ã€(ç¿»è­¯: ${searchTerm})ï¼Œè«‹å˜—è©¦è¼¸å…¥å…¶ä»–åç¨±ï¼š`), 1000);
                    return;
                }

                // [æ–°å¢] ç¯©é¸é‚è¼¯ (æ‰‹å‹•è¼¸å…¥ä¹Ÿé©ç”¨)
                let targetLocation = geoData.results[0];
                const jpLocation = geoData.results.find(r => r.country_code === 'JP' || r.country === 'Japan');
                // å¦‚æœæ‰‹å‹•è¼¸å…¥çš„åœ°é»æœ‰æ‰¾åˆ°æ—¥æœ¬çš„ï¼Œä¸”ä½¿ç”¨è€…è¼¸å…¥çš„æ˜¯ä¸­æ–‡æˆ–è·Ÿæ—¥æœ¬è¡Œç¨‹ç›¸é—œï¼Œå„ªå…ˆé¸æ—¥æœ¬
                // (é€™è£¡ç°¡å–®åšï¼šåªè¦æœ‰æ—¥æœ¬é¸é …å°±é¸æ—¥æœ¬ï¼Œå› ç‚ºé€™æ˜¯ä¹å·æ—…éŠ App)
                if (jpLocation) {
                    targetLocation = jpLocation;
                }

                const { latitude, longitude } = targetLocation;
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`;
                const weatherRes = await fetch(weatherUrl);
                const weatherData = await weatherRes.json();

                currentMyTemp = weatherData.current_weather.temperature;
                
                // æ›´æ–° UI
                tempEl.innerText = `${currentMyTemp}Â°C`;
                tempEl.style.fontSize = '1.5rem';
                tempEl.style.color = '#1F2937';
                
                // æ›´æ”¹æ¨™é¡Œè®“äººçŸ¥é“æ˜¯æ‰‹å‹•çš„ (åŠ å…¥è‹±æ–‡é¡¯ç¤ºï¼Œä¸Šä¸‹åˆ†å±¤)
                const titleEl = document.querySelector('.wc-mini-card .wc-mini-title');
                
                // é è¨­ HTML çµæ§‹
                let titleHtml = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px;">
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <svg class="icon-mini" style="color: #EF4444;" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                            <span>${manualCity}</span>
                        </div>
                `;

                // è‹¥æœ‰è‹±æ–‡ç¿»è­¯ä¸”ä¸åŒï¼Œå‰‡åŠ å…¥ä¸‹ä¸€è¡Œ
                if (searchTerm && searchTerm.toLowerCase() !== manualCity.toLowerCase()) {
                    titleHtml += `<span style="font-size: 0.75rem; color: #9CA3AF; font-weight: 400; font-family: sans-serif;">${searchTerm}</span>`;
                }
                
                titleHtml += `</div>`; // Close container
                titleEl.innerHTML = titleHtml;

                const targetTempStr = document.getElementById('wc-temp').innerText;
                if (targetTempStr !== '--Â°') {
                    updateComparison(parseFloat(targetTempStr));
                }

            } catch (e) {
                console.error(e);
                tempEl.innerText = 'å¤±æ•—';
                tempEl.style.color = '#EF4444';
            }
        }

        function updateComparison(targetTemp) {
            if (currentMyTemp === null) {
                // Try to fetch local if not yet fetched
                getLocalWeather();
                return;
            }
            
            const diff = targetTemp - currentMyTemp;
            const diffTag = document.getElementById('wc-diff-tag');
            const diffText = document.getElementById('wc-diff-text');
            
            diffTag.style.display = 'inline-block';
            
            if (diff > 0) {
                diffTag.className = 'wc-diff-tag wc-diff-hot';
                diffTag.innerText = `ç†± ${diff.toFixed(1)}Â°C`;
                diffText.innerText = 'æ¯”é€™è£¡æº«æš–';
            } else {
                diffTag.className = 'wc-diff-tag wc-diff-cold';
                diffTag.innerText = `å†· ${Math.abs(diff).toFixed(1)}Â°C`;
                diffText.innerText = 'æ¯”é€™è£¡å†·';
            }
        }

        async function askAiWeatherAdvice(city, temp, condition) {
            // [æ–°å¢] 1. ç”¢ç”Ÿå¿«å–é‡‘é‘° (åœ°é» + æ°£æº«æ•´æ•¸ + å¤©æ°£ç‹€æ³)
            // é€™æ¨£å¦‚æœæº«åº¦åªå·® 0.1 åº¦ï¼Œæˆ–æ˜¯å¤©æ°£ä¸€æ¨£ï¼Œå°±ä¸ç”¨é‡æ–°å• AI
            const cacheKey = `ai_advice_${city}_${Math.round(temp)}_${condition}`;
            
            // [æ–°å¢] 2. å…ˆæŸ¥å¿«å–
            const cachedAdvice = CACHE_SYSTEM.get(cacheKey);
            if (cachedAdvice) {
                console.log("ä½¿ç”¨å¿«å–ç©¿è¡£å»ºè­°");
                document.getElementById('wc-advice').innerText = cachedAdvice;
                return;
            }

            // ç„¡å¿«å–ï¼Œæ‰åŸ·è¡Œ AI è«‹æ±‚
            const prompt = `
                ç¾åœ¨${city}çš„å³æ™‚æ°£æº«æ˜¯ ${temp}åº¦ï¼Œå¤©æ°£ç‹€æ³ç‚º${condition}ã€‚
                è«‹ä»¥ã€Œæ—…éŠå°ç§˜æ›¸ã€çš„å£å»ï¼Œçµ¦äºˆå°ç£æ—…å®¢ç°¡çŸ­çš„ç©¿è¡£å»ºè­°ï¼ˆç´„50å­—ï¼‰ã€‚
                è«‹åŒ…å«é«”æ„Ÿæè¿°ï¼ˆä¾‹å¦‚ï¼šæ˜¯å¦éœ€è¦ç™¼ç†±è¡£ã€åœå·¾ç­‰ï¼‰ã€‚
            `;
            
            try {
                const text = await getGeminiResponse(prompt);
                document.getElementById('wc-advice').innerText = text;
                
                // [æ–°å¢] 3. å­˜å…¥å¿«å– (ä¿å­˜ 60 åˆ†é˜)
                CACHE_SYSTEM.save(cacheKey, text, 30);
                
            } catch (e) {
                document.getElementById('wc-advice').innerText = 'AI é€£ç·šé€¾æ™‚ï¼Œå»ºè­°æ´‹è”¥å¼ç©¿æ­ã€‚';
            }
        }
        
        // --- END REAL-TIME WEATHER ---

        // [ä¿®æ”¹] åˆ‡æ›åˆ†é å‡½å¼ - åŠ å…¥å·¦å³æ»‘å‹•å‹•ç•«åˆ¤æ–·
        function switchTab(element) {
            // ç§»é™¤æ‰€æœ‰ active
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.container').forEach(container => {
                container.classList.remove('active');
                // æ¸…é™¤æ®˜ç•™æ¨£å¼
                container.style.transform = '';
                container.style.opacity = '';
                container.style.filter = '';
            });

            // è¨­å®š active
            element.classList.add('active');
            const targetId = element.getAttribute('data-target');
            document.getElementById(targetId).classList.add('active');
            
            window.scrollTo(0, 0);
        }

        function toggleTimeline(id, toggleElement) {
            const timeline = document.getElementById(id);
            // If opening a new day
            if (!timeline.classList.contains('show')) {
                // Collapse others
                document.querySelectorAll('.timeline.show').forEach(t => t.classList.remove('show'));
                document.querySelectorAll('.day-toggle.open').forEach(t => t.classList.remove('open'));
                
                // Show target
                timeline.classList.add('show');
                toggleElement.classList.add('open');
                
                // Update Weather!
                updateWeatherWidget(id);
            } else {
                // Closing the current day
                timeline.classList.remove('show');
                toggleElement.classList.remove('open');
            }
        }

        // AI Functions - UI Interaction Part
        const chatHistory = document.getElementById('chat-history');
        const aiInput = document.getElementById('ai-user-input');
        const aiTitle = document.getElementById('ai-modal-title');
        const aiInputArea = document.getElementById('ai-input-area');
        const btnBackTrans = document.getElementById('btn-back-trans');

        // Initial Greeting
        // [ä¿®æ”¹] åˆå§‹åŒ–æ­¡è¿è¨Šæ¯ (åŠ å…¥å°æ‡‰æŒ‰éˆ•çš„é¡è‰²èˆ‡åœ–ç¤º)
        function initAiChat() {
            if (chatHistory.children.length === 0) {
                // å®šç¾©æ¨£å¼è®Šæ•¸ï¼Œè®“ç¨‹å¼ç¢¼è¼ƒæ•´æ½”
                const iconStyle = 'width:16px; height:16px; vertical-align:text-bottom; margin-right:2px; display:inline-block;';
                const spanStyle = 'font-weight:700; display:inline-flex; align-items:center; vertical-align:middle; margin:0 2px;';
                
                // 1. è¡Œç¨‹è«®è©¢ (è—è‰²)
                const iconConsult = `<svg style="${iconStyle}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon></svg>`;
                const txtConsult = `<span style="${spanStyle} color:#2563EB;">${iconConsult}è¡Œç¨‹è«®è©¢</span>`;

                // 2. ä¸­/æ—¥ç¿»è­¯ (å¤©ç©ºè—)
                const iconTrans = `<svg style="${iconStyle}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10h14"></path><path d="M17 6l4 4-4 4"></path><path d="M17 14H3"></path><path d="M7 18l-4-4 4-4"></path></svg>`;
                const txtTrans = `<span style="${spanStyle} color:#0EA5E9;">${iconTrans}ä¸­/æ—¥ç¿»è­¯</span>`;

                // 3. èªéŸ³è¼¸å…¥ (é’è‰²)
                const iconVoice = `<svg style="${iconStyle}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>`;
                const txtVoice = `<span style="${spanStyle} color:#06B6D4;">${iconVoice}èªéŸ³è¼¸å…¥</span>`;

                // 4. æ‹ç…§è¾¨è­˜ (ç´«è‰²/ç²‰è‰²)
                const iconCam = `<svg style="${iconStyle}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>`;
                const txtCam = `<span style="${spanStyle} color:#D946EF;">${iconCam}æ‹ç…§è¾¨è­˜</span>`;

                const welcomeHtml = `
                    ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¹å·æ—…éŠ AI åŠ©æ‰‹ã€‚
                    <br><br>
                    ä½ å¯ä»¥é»é¸ä¸‹æ–¹çš„ ${txtConsult} è©¢å•è·¯ç·šï¼Œæˆ–ä½¿ç”¨ ${txtTrans} èˆ‡ç•¶åœ°äººæºé€šã€‚
                    é»é¸ ${txtVoice} æ­é…èªè¨€åˆ‡æ›é‚„èƒ½ç”¨èªªçš„å–”ï¼
                    æ›´æœ‰ ${txtCam} åŠŸèƒ½å¯ä»¥æ–¹ä¾¿é»é¤åŠç²å¾—å•†å“è³‡è¨Šã€‚
                `;
                appendMessage('ai', welcomeHtml);
            }
        }

        // Function to switch to AI tab programmatically
        function goToAiTab() {
            const aiTabBtn = document.querySelector('[data-target="view-ai"]');
            switchTab(aiTabBtn);
        }

        function showAiTranslatorMode() {
            // ä¿®æ­£ 3: JS å‹•æ…‹åˆ‡æ›æ¨™é¡Œæ™‚ä¹Ÿè¦ç”¨ SVG
            const iconSvg = '<svg class="icon-mini" style="width: 24px; height: 24px; color: #F59E0B; margin-right: 8px;" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>';
            aiTitle.innerHTML = iconSvg + '<span>éš¨èº« AI ç¿»è­¯èˆ‡åŠ©æ‰‹</span>';
            aiInputArea.style.display = 'block'; 
            btnBackTrans.style.display = 'none';
            // Scroll to bottom
            chatHistory.scrollTop = chatHistory.scrollHeight;
            setupVoiceButton();
        }
        
        // Append Message Bubble
        // [ä¿®æ”¹] è¨Šæ¯é¡¯ç¤ºå‡½å¼ï¼šç§»é™¤è‡ªå‹•æœ—è®€ï¼Œæ”¹ç‚ºå…¨æ‰‹å‹•æ’­æ”¾
        function appendMessage(sender, htmlContent, isAudio = false) {
            const row = document.createElement('div');
            row.className = `chat-row ${sender}`;
            
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${sender}`;
            bubble.innerHTML = htmlContent;
            
            // è‹¥ç‚º AI å›è¦†ä¸”æ¨™è¨˜ç‚ºå¯æœ—è®€ (isAudio=true)ï¼ŒåŠ å…¥å–‡å­æŒ‰éˆ•
            if (sender === 'ai' && isAudio) {
                const btn = document.createElement('button');
                btn.className = 'btn-audio-inline';
                // å–‡å­åœ–ç¤º
                btn.innerHTML = '<svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';
                
                // å–å¾—ç´”æ–‡å­— (ç§»é™¤ HTML æ¨™ç±¤èˆ‡åœ–ç¤ºæ–‡å­—) ä»¥ä¾›æœ—è®€
                const textToSpeak = bubble.innerText.replace('ğŸ”Š', '').trim();
                
                // ç¶å®šé»æ“Šäº‹ä»¶ (åªæœ‰é»æ“Šæ™‚æ‰ç™¼è²)
                btn.onclick = () => speakText(textToSpeak);
                
                bubble.appendChild(btn);
                
                // â˜… å·²ç§»é™¤ï¼šsetTimeout(() => speakText(textToSpeak), 200); 
                // ç¾åœ¨ä¸æœƒè‡ªå‹•æ’­æ”¾äº†ï¼
            }

            row.appendChild(bubble);
            chatHistory.appendChild(row);
            
            // è‡ªå‹•æ²å‹•åˆ°åº•éƒ¨
            chatHistory.scrollTop = chatHistory.scrollHeight;
            
            return bubble; 
        }
        
        function showLoading() {
            const row = document.createElement('div');
            row.className = 'chat-row ai loading-row';
            row.id = 'loading-indicator';
            
            const bubble = document.createElement('div');
            bubble.className = 'chat-bubble ai loading-bubble';
            bubble.innerHTML = 'AI æ­£åœ¨æ€è€ƒä¸­<span class="loading-dots"></span>';
            
            row.appendChild(bubble);
            chatHistory.appendChild(row);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function removeLoading() {
            const loading = document.getElementById('loading-indicator');
            if (loading) loading.remove();
        }
        
        // Helper to update placeholder based on selection
        function updatePlaceholder() {
            const lang = document.querySelector('input[name="voice_lang"]:checked').value;
            const input = document.getElementById('ai-user-input');
            if (lang === 'zh-TW') {
                input.placeholder = 'è«‹è¼¸å…¥ä¸­æ–‡ (æˆ–ä½¿ç”¨èªéŸ³)...';
            } else {
                input.placeholder = 'è«‹è¼¸å…¥æ—¥æ–‡ (æˆ–åˆ‡æ›èªéŸ³)...';
            }
        }

        // [ä¿®æ”¹] æ–‡å­—è½‰èªéŸ³å‡½å¼ (éæ¿¾ç¾…é¦¬æ‹¼éŸ³ï¼Œåªå”¸æ—¥æ–‡)
        // [ä¿®æ”¹] æ–‡å­—è½‰èªéŸ³å‡½å¼ (å¼·åŠ›éæ¿¾ç‰ˆ)
        // [ä¿®æ”¹] æ–‡å­—è½‰èªéŸ³å‡½å¼ (éæ¿¾ç¾…é¦¬æ‹¼éŸ³ + éæ¿¾æ˜Ÿè™Ÿ)
        // [ä¿®æ”¹] æ–‡å­—è½‰èªéŸ³å‡½å¼ (å¼·åŠ›éæ¿¾ï¼šæ‹¬è™Ÿã€æ˜Ÿè™Ÿã€æ‰€æœ‰è‹±æ–‡å­—æ¯éƒ½ä¸å”¸)
        function speakText(text) {
             speechSynthesis.cancel(); // åœæ­¢ä¸Šä¸€å¥

             let cleanText = text;

             // 1. ç§»é™¤æ‹¬è™Ÿ (...) åŠå…¶å…§å®¹
             cleanText = cleanText.replace(/\([^\)]+\)/g, '');
             
             // 2. ç§»é™¤æ˜Ÿè™Ÿ (*)
             cleanText = cleanText.replace(/\*/g, '');

             // 3. â˜… é—œéµä¿®æ­£ï¼šç§»é™¤æ‰€æœ‰ç¾…é¦¬æ‹¼éŸ³/è‹±æ–‡å­—æ¯ (å«é•·éŸ³ç¬¦è™Ÿ)
             // é€™æ¨£å°±ç®—æ‹¼éŸ³æ²’æœ‰æ‹¬è™Ÿ (å¦‚ BebÄ«chea)ï¼Œä¹Ÿæœƒè¢«åˆªé™¤ï¼Œä¸æœƒå”¸å‡ºä¾†
             cleanText = cleanText.replace(/[a-zA-ZÄÄ“Ä«ÅÅ«Ä€Ä’ÄªÅŒÅª]+/g, '');

             // 4. å»é™¤å‰å¾Œèˆ‡å¤šé¤˜ç©ºç™½
             cleanText = cleanText.trim();

             const utterance = new SpeechSynthesisUtterance(cleanText);
             utterance.lang = 'ja-JP'; // è¨­å®šèªè¨€ç‚ºæ—¥æ–‡
             utterance.rate = 0.9;     // èªé€Ÿç¨æ…¢
             
             // å˜—è©¦å–å¾—è¼ƒè‡ªç„¶çš„æ—¥æ–‡èªéŸ³åŒ…
             const voices = speechSynthesis.getVoices();
             const jaVoice = voices.find(v => v.lang.includes('ja'));
             if (jaVoice) utterance.voice = jaVoice;

             speechSynthesis.speak(utterance);
        }

       // Voice Recognition Logic
        // [ä¿®æ­£] å°‡ recognition ç§»å‡ºå‡½å¼ï¼Œé¿å…é‡è¤‡å®£å‘Š
        let recognition = null; 

        function setupVoiceButton() {
            // [ä¿®æ­£] å¦‚æœå·²ç¶“åˆå§‹åŒ–éï¼Œå°±ç›´æ¥çµæŸï¼Œé˜²æ­¢é‡è¤‡ç¶å®šäº‹ä»¶
            if (recognition) return; 

            const voiceBtn = document.getElementById('btn-voice-ja');
            if (!voiceBtn) return;
            
            // é˜²æ­¢é•·æŒ‰è·³å‡ºé¸å–®
            voiceBtn.oncontextmenu = (e) => { e.preventDefault(); return false; };

            // let recognition; <--- [ä¿®æ­£] é€™è¡Œåˆªé™¤ï¼Œæ”¹ç”¨ä¸Šé¢çš„å…¨åŸŸè®Šæ•¸
            
            // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                // è¨­å®šé€£çºŒæ¨¡å¼ï¼šè®“ iOS ä¸æœƒè¬›ä¸€å¥è©±å°±è‡ªå·±æ–·ç·šï¼Œè€Œæ˜¯ç”±æˆ‘å€‘ç¨‹å¼æ§åˆ¶ä½•æ™‚æ–·
                recognition.continuous = true;
                recognition.interimResults = true;

                // --- [é—œéµä¿®æ­£ 1] è¨­å®šèªè¨€èˆ‡ UI ç‹€æ…‹ (onstart) ---
                recognition.onstart = function() {
                    voiceBtn.classList.add('recording');
                    
                    // å–å¾—ç•¶å‰é¸æ“‡çš„èªè¨€åç¨±ï¼Œæ›´æ–°æŒ‰éˆ•æ–‡å­—
                    const selectedLang = document.querySelector('input[name="voice_lang"]:checked').value;
                    const langText = selectedLang === 'zh-TW' ? 'ä¸­æ–‡' : 'æ—¥æ–‡';
                    
                    voiceBtn.innerHTML = `<span style="animation: pulse 1s infinite;">ğŸ”´ è†è½${langText}...</span>`;
                    document.getElementById('ai-user-input').placeholder = `æ­£åœ¨è†è½${langText} (èªªå®Œè‡ªå‹•åœæ­¢)...`;
                };

                // --- [é—œéµä¿®æ­£ 2] çµæŸæ™‚é‡ç½®æŒ‰éˆ• (onend) ---
                recognition.onend = function() {
                    voiceBtn.classList.remove('recording');
                    voiceBtn.innerHTML = `
                        <svg class="icon-sprite"><use href="#icon-voice"></use></svg>
                        èªéŸ³è¼¸å…¥
                    `;
                    updatePlaceholder();
                };

                // --- [é—œéµä¿®æ­£ 3] éŒ¯èª¤è™•ç† (onerror) ---
                // éæ¿¾æ‰ iPhone å¸¸è¦‹çš„è‰¯æ€§éŒ¯èª¤ï¼Œä¸å†è·³å‡ºç…©äººçš„ Alert
                recognition.onerror = function(event) {
                    console.log('Voice Error:', event.error);
                    
                    // å¿½ç•¥ "no-speech" (æ²’è½åˆ°è²éŸ³) å’Œ "aborted" (æ‰‹å‹•åœæ­¢)
                    if (event.error === 'no-speech' || event.error === 'aborted') {
                        // éœé»˜å¤±æ•—ï¼Œåªç§»é™¤éŒ„éŸ³ç‹€æ…‹ï¼Œä¸æ“¾æ°‘
                        voiceBtn.classList.remove('recording');
                        return;
                    }
                    
                    // åªæœ‰çœŸæ­£çš„éŒ¯èª¤æ‰è·³é€šçŸ¥
                    voiceBtn.classList.remove('recording');
                    alert("èªéŸ³é€£ç·šä¸­æ–·ï¼Œè«‹é‡æ–°é»æ“ŠæŒ‰éˆ•ã€‚");
                };

                // --- [æ ¸å¿ƒé‚è¼¯] è™•ç†è¾¨è­˜çµæœ (onresult) ---
                recognition.onresult = function(event) {
                    let finalTranscript = '';
                    
                    // çµ„åˆæ‰€æœ‰å·²ç¢ºèªçš„ç‰‡æ®µ
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                    }

                    // å¦‚æœæœ‰åµæ¸¬åˆ°å®Œæ•´çš„å¥å­
                    if (finalTranscript.trim().length > 0) {
                        recognition.stop(); // 1. è½åˆ°é€™å¥è©±å°±ç«‹åˆ»åœæ­¢éŒ„éŸ³
                        
                        // 2. å¡«å…¥è¼¸å…¥æ¡†é¡¯ç¤ºçµ¦ä½¿ç”¨è€…çœ‹
                        document.getElementById('ai-user-input').value = finalTranscript;
                        
                        // 3. ç›´æ¥ç™¼é€çµ¦ AI é€²è¡Œç¿»è­¯
                        sendToGemini('voice_direct'); 
                    }
                };

                // --- [é—œéµä¿®æ­£ 4] æŒ‰éˆ•é»æ“Šäº‹ä»¶ ---
                voiceBtn.onclick = (e) => {
                    if (e && e.cancelable) e.preventDefault();
                    
                    if (voiceBtn.classList.contains('recording')) {
                        // å¦‚æœæ­£åœ¨éŒ„éŸ³ï¼ŒæŒ‰ä¸€ä¸‹å‰‡åœæ­¢
                        recognition.stop();
                    } else {
                        // â˜…â˜…â˜… ä¿®æ­£é‡é»ï¼šåœ¨ start() ä¹‹å‰è¨­å®šèªè¨€ï¼ â˜…â˜…â˜…
                        const selectedLang = document.querySelector('input[name="voice_lang"]:checked').value;
                        recognition.lang = selectedLang; 
                        
                        try {
                            recognition.start();
                        } catch (err) {
                            console.error("å•Ÿå‹•å¤±æ•—:", err);
                        }
                    }
                };
                
            } else {
                voiceBtn.style.display = 'none'; 
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¼¸å…¥åŠŸèƒ½');
            }
        }

        function askGeminiGuide(spotName, customPrompt) {
            goToAiTab();
            // ä¿®æ­£ 4: å°è¦½æ¨¡å¼æ¨™é¡Œåœ–ç¤ºä¹Ÿçµ±ä¸€
            const iconSvg = '<svg class="icon-mini" style="width: 24px; height: 24px; color: #F59E0B; margin-right: 8px;" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>';
            aiTitle.innerHTML = iconSvg + `<span>${spotName} å°æ•…äº‹</span>`;
            aiInputArea.style.display = 'none'; 
            btnBackTrans.style.display = 'block'; 
            
            // Add system message to chat indicating start
            appendMessage('ai', `æ­£åœ¨ç‚ºæ‚¨ç”Ÿæˆé—œæ–¼ã€Œ${spotName}ã€çš„æ•…äº‹...`);

            const prompt = `
                ä½ æ˜¯ä¸€ä½å¸¶é ˜è¦ªå­æ—…éŠçš„ä¹å·å°éŠã€‚
                è«‹é‡å°æ™¯é»ã€Œ${spotName}ã€ç”Ÿæˆä¸€æ®µçµ¦ 5-8 æ­²å°å­©è½çš„å°è¦½è©ã€‚
                è¦æ±‚ï¼š
                1. èªæ°£ç”Ÿå‹•æ´»æ½‘ï¼Œä½¿ç”¨å°ç£ç¹é«”ä¸­æ–‡ã€‚
                2. å…§å®¹åŒ…å«ä¸€å€‹é—œæ–¼è©²æ™¯é»çš„æœ‰è¶£å†·çŸ¥è­˜ã€‚
                3. çµ¦å­©å­ä¸€å€‹ã€Œå°å°è§€å¯Ÿä»»å‹™ã€ï¼ˆä¾‹å¦‚ï¼šæ‰¾æ‰¾çœ‹æŸå€‹é¡è‰²çš„æ±è¥¿ï¼‰ã€‚
                4. æ•´é«”é•·åº¦æ§åˆ¶åœ¨ 150 å­—ä»¥å…§ã€‚
                5. ${customPrompt}
            `;
            
            callGemini(prompt);
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendToGemini('auto');
        }

        // [ä¿®æ”¹] AI ç™¼é€é‚è¼¯ï¼šæ•´åˆç³»çµ±è¨˜æ†¶èˆ‡å¤šç¨®æ¨¡å¼
        // [ä¿®æ”¹] AI ç™¼é€é‚è¼¯ï¼šåŠ å…¥ã€Œæƒ…å¢ƒæ„ŸçŸ¥ã€èƒ½åŠ›
        // [ä¿®æ”¹] AI ç™¼é€é‚è¼¯ï¼šæ•´åˆè¨˜æ†¶ã€å¤©æ°£æ„ŸçŸ¥ã€ä»¥åŠã€Œç¾…é¦¬æ‹¼éŸ³ã€ç¿»è­¯
        // [ä¿®æ”¹] AI ç™¼é€é‚è¼¯ï¼šä¾æ“šç¿»è­¯æ–¹å‘æ±ºå®šæ˜¯å¦é¡¯ç¤ºæ‹¼éŸ³
        // [ä¿®æ”¹] AI ç™¼é€é‚è¼¯ï¼šåŠ å…¥ã€Œé€£çºŒå°è©±è¨˜æ†¶ã€åŠŸèƒ½
        // [ä¿®æ”¹] AI ç™¼é€é‚è¼¯ï¼šä¿®å¾©ã€Œè«®è©¢æ¨¡å¼ã€èª¤åˆ¤ç‚ºç¿»è­¯çš„å•é¡Œ
        async function sendToGemini(mode) {
            const text = aiInput.value.trim();
            if (!text) return;

            // é¡¯ç¤ºä½¿ç”¨è€…çš„è©±
            appendMessage('user', text);
            aiInput.value = ''; 

            let finalPrompt = "";
            
            // å–å¾—ç›®å‰é¸æ“‡çš„èªè¨€
            const selectedLang = document.querySelector('input[name="voice_lang"]:checked').value;
            const isInputZh = selectedLang === 'zh-TW';

            // --- æ¨¡å¼ A: è¡Œç¨‹è«®è©¢ ---
            if (mode === 'consult' || mode === 'auto') {
                 let liveContext = "";
                if (window.appCache && window.appCache['my_location_combined']) {
                    const d = window.appCache['my_location_combined'].data;
                    liveContext = `ç›®å‰ä½ç½®ï¼š${d.city}, å¤©æ°£ï¼š${d.code}, æ°£æº«ï¼š${d.temp}Â°C`;
                }
                const historyText = conversationHistory.join('\n');
                
                finalPrompt = `
                    ${systemPrompt}
                    ${liveContext}
                    ${historyText}
                    ã€ä½¿ç”¨è€…å•é¡Œã€‘ï¼š "${text}"
                `;
            } 
            // --- æ¨¡å¼ B: æ‰‹å‹•æŒ‰ç¿»è­¯æŒ‰éˆ• ---
            else if (mode === 'translate') {
                finalPrompt = `
                    Role: Professional JP/TW Translator.
                    Input: "${text}"
                    Rules:
                    1. If input is Chinese -> Translate to Japanese (Polite). Add Pronunciation.
                    2. If input is Japanese -> Translate to Traditional Chinese.
                    Output: Translation result ONLY.
                `;
            }
            // --- æ¨¡å¼ C: èªéŸ³ç›´é”ç¿»è­¯ (Voice Direct) ---
            else if (mode === 'voice_direct') {
                 if (isInputZh) {
                     // ä½¿ç”¨è€…èªªä¸­æ–‡ -> ç¿»æˆæ—¥æ–‡çµ¦åº—å“¡è½
                     finalPrompt = `
                        Task: Translate this Traditional Chinese text to Japanese (Polite form).
                        Input: "${text}"
                        Output: ONLY the Japanese translation text. NO Romaji. NO explanations.
                     `;
                 } else {
                     // ä½¿ç”¨è€…(æˆ–åº—å“¡)èªªæ—¥æ–‡ -> ç¿»æˆä¸­æ–‡çµ¦è‡ªå·±çœ‹
                     finalPrompt = `
                        Task: Translate this Japanese text to Traditional Chinese (Taiwan).
                        Input: "${text}"
                        Output: ONLY the Chinese translation. NO English. NO Romanization.
                     `;
                 }
            }

            showLoading();
            try {
                const responseText = await getGeminiResponse(finalPrompt);
                removeLoading();
                
                // æ±ºå®šæ˜¯å¦é¡¯ç¤ºå–‡å­æŒ‰éˆ•
                let showAudioBtn = false;
                
                if (mode === 'voice_direct') {
                    // é‚è¼¯ï¼šå¦‚æœä½ èªªä¸­æ–‡(isInputZh)ï¼Œä»£è¡¨ä½ è¦ç¿»æˆæ—¥æ–‡çµ¦åˆ¥äººè½ -> é¡¯ç¤ºå–‡å­
                    if (isInputZh) {
                        showAudioBtn = true;
                    }
                    // å¦‚æœä½ éŒ„çš„æ˜¯æ—¥æ–‡ï¼Œä»£è¡¨æ˜¯ç¿»è­¯æˆä¸­æ–‡çµ¦è‡ªå·±çœ‹ -> ä¸é¡¯ç¤ºå–‡å­
                } else {
                    // æ‰‹å‹•ç¿»è­¯æ¨¡å¼ï¼šåªè¦çµæœæœ‰æ—¥æ–‡å°±é¡¯ç¤ºå–‡å­
                    showAudioBtn = (mode === 'translate') && /[\u3040-\u309F\u30A0-\u30FF]/.test(responseText);
                }
                
                const formattedText = responseText.replace(/\n/g, '<br>');
                appendMessage('ai', formattedText, showAudioBtn);

                // å¯«å…¥æ­·å²ç´€éŒ„ (è«®è©¢æ¨¡å¼æ‰éœ€è¦)
                if (mode === 'consult' || mode === 'auto') {
                    conversationHistory.push(`User: ${text}`);
                    conversationHistory.push(`Guide: ${responseText}`);
                    if (conversationHistory.length > 20) conversationHistory = conversationHistory.slice(-20);
                }

            } catch (e) {
                removeLoading();
                appendMessage('ai', `<span style="color:red">é€£ç·šéŒ¯èª¤: ${e.message}</span>`);
            }
        }

        async function callGemini(promptText) {
            showLoading();
            
            try {
                // æ”¹ç”¨æ–°çš„å…±ç”¨å‡½æ•¸ getGeminiResponse
                let rawText = await getGeminiResponse(promptText);
                removeLoading();

                // Check for Japanese chars to decide if we show audio button
                const hasJapanese = /[\u3040-\u309F\u30A0-\u30FF]/.test(rawText);
                const isTranslation = hasJapanese && rawText.length < 500;

                // Format text (convert newlines to <br>)
                const formattedText = rawText.replace(/\n/g, '<br>');
                
                appendMessage('ai', formattedText, isTranslation);

            } catch (error) {
                removeLoading();
                console.error('Gemini API Error:', error);
                appendMessage('ai', `<span style="color:red">ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚<br>Error: ${error.message}</span>`);
            }
        }
        function resetAppPassword() {
        if (confirm("æ‚¨ç¢ºå®šè¦æ¸…é™¤å·²è¨˜æ†¶çš„å¯†ç¢¼ä¸¦é‡æ–°è¼¸å…¥å—ï¼Ÿ")) {
            localStorage.removeItem("app_password"); // æ¸…é™¤ç€è¦½å™¨è¨˜æ†¶
            alert("å¯†ç¢¼å·²æ¸…é™¤ï¼é é¢å°‡é‡æ–°æ•´ç†ï¼Œè«‹é‡æ–°è¼¸å…¥æ–°å¯†ç¢¼ã€‚");
            window.location.reload(); // é‡æ–°æ•´ç†ç¶²é 
        }
    }
    // [ä¿®æ”¹] è¡Œå‰æ¸…å–®åŠŸèƒ½ï¼šæ”¯æ´å‹•æ…‹æ–°å¢ã€åˆªé™¤èˆ‡ç‹€æ…‹å„²å­˜
        const CHECKLIST_KEY = 'kyushu_trip_checklist_v2'; // æ”¹ç”¨æ–° Key é¿å…èˆŠè³‡æ–™è¡çª
        
        // é è¨­æ¸…å–®è³‡æ–™ (è‹¥ä½¿ç”¨è€…ç¬¬ä¸€æ¬¡é–‹å•Ÿ)
        const defaultItems = [
            { id: 'c1', text: 'æ©Ÿå ´åœè»Šé ç´„ (æˆªåœ–å‚™ä»½)', checked: false },
            { id: 'c2', text: 'è­·ç…§ & æ©Ÿç¥¨ (æˆªåœ–å‚™ä»½)', checked: false },
            { id: 'c3', text: 'æ—…éŠä¿éšªå–® (ç´™æœ¬/é›»å­)', checked: false },
            { id: 'c4', text: 'æ—¥å¹£ç¾é‡‘ & ä¿¡ç”¨å¡ & è¥¿ç“œå¡', checked: false },
            { id: 'c5', text: 'eSIM / æ¼«éŠé–‹é€š', checked: false },
            { id: 'c6', text: 'Visit Japan Web å¡«å¯«', checked: false },
            { id: 'c7', text: 'è¡Œå‹•é›»æº & å……é›»ç·š & è»Šå……', checked: false },
            { id: 'c8', text: 'åœ‹éš›é§•ç…§ (æ—¥æ–‡è­¯æœ¬)', checked: false },
            { id: 'c9', text: 'ç‰™åˆ·/å¸¸å‚™è—¥å“', checked: false },
            { id: 'c10', text: 'å¥ä¿å¡ / å¤§é ­ç…§', checked: false },
            { id: 'c11', text: 'å°å·¥å…·é†«ç™‚ç®± / é›ªæ¾', checked: false },
            { id: 'c12', text: 'è€³æº«æ§ / åˆ®é¬åˆ€', checked: false },
            { id: 'c13', text: 'ç›¸æ©Ÿ / è®€å¡æ©Ÿ / æ‹ç«‹å¾—', checked: false },
            { id: 'c14', text: 'æ‰‹å¥— / è„–åœ', checked: false }
        ];

        let checklistData = [];

        function initChecklist() {
            // 1. è®€å–è³‡æ–™
            const saved = localStorage.getItem(CHECKLIST_KEY);
            if (saved) {
                try {
                    checklistData = JSON.parse(saved);
                } catch(e) {
                    checklistData = JSON.parse(JSON.stringify(defaultItems));
                }
            } else {
                checklistData = JSON.parse(JSON.stringify(defaultItems)); // æ·±æ‹·è²
            }
            renderChecklist();
        }

        // æ¸²æŸ“æ¸…å–®ç•«é¢ (åŒ…å«è¨ˆç®—é€²åº¦)
        function renderChecklist() {
            const listArea = document.getElementById('checklist-list-area');
            const progressEl = document.getElementById('checklist-progress');
            if (!listArea) return;

            listArea.innerHTML = ''; // æ¸…ç©ºç›®å‰ç•«é¢
            let checkedCount = 0;

            checklistData.forEach((item, index) => {
                if (item.checked) checkedCount++;

                const label = document.createElement('label');
                label.className = 'check-item';
                // é»æ“Š label æœ¬èº«åˆ‡æ› checkboxï¼Œé˜²æ­¢é»æ“Šåˆªé™¤æŒ‰éˆ•æ™‚è§¸ç™¼
                label.innerHTML = `
                    <div style="display:flex; align-items:center; gap:8px; flex:1; cursor:pointer;">
                        <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggleItemStatus(${index})">
                        <span>${item.text}</span>
                    </div>
                    <button class="btn-del-item" onclick="deleteCheckItem(${index}, event)">Ã—</button>
                `;
                listArea.appendChild(label);
            });

            // æ›´æ–°é€²åº¦æ–‡å­—
            if (progressEl) {
                progressEl.innerText = `${checkedCount}/${checklistData.length}`;
                if (checkedCount === checklistData.length && checklistData.length > 0) {
                    progressEl.style.background = '#ECFDF5';
                    progressEl.style.color = '#059669';
                    progressEl.innerText = 'æº–å‚™å®Œæˆï¼';
                } else {
                    progressEl.style.background = '#FFFBEB';
                    progressEl.style.color = '#D97706';
                }
            }
            
            // å„²å­˜åˆ° LocalStorage
            localStorage.setItem(CHECKLIST_KEY, JSON.stringify(checklistData));
        }

        // åˆ‡æ›å‹¾é¸ç‹€æ…‹
        function toggleItemStatus(index) {
            checklistData[index].checked = !checklistData[index].checked;
            renderChecklist(); // é‡æ–°æ¸²æŸ“ (æœƒè‡ªå‹•å„²å­˜)
        }

        // æ–°å¢é …ç›®
        function addNewCheckItem() {
            const input = document.getElementById('new-item-input');
            const text = input.value.trim();
            if (!text) return;

            checklistData.unshift({ // åŠ åœ¨æœ€ä¸Šé¢
                id: 'new_' + Date.now(),
                text: text,
                checked: false
            });
            
            input.value = '';
            renderChecklist();
        }

        // åˆªé™¤é …ç›®
        function deleteCheckItem(index, event) {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…é»æ“Šåˆªé™¤æ™‚è§¸ç™¼ label çš„å‹¾é¸
            event.stopPropagation();
            event.preventDefault();
            
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹é …ç›®å—ï¼Ÿ')) {
                checklistData.splice(index, 1);
                renderChecklist();
            }
        }

        // æŠ˜ç–Š/å±•é–‹æ§åˆ¶
        function toggleChecklist(headerEl) {
            const container = document.getElementById('checklist-container');
            const icon = headerEl.querySelector('.toggle-icon');
            
            // åˆ‡æ›é¡¯ç¤ºå®¹å™¨ (åŠ ä¸Šæˆ–ç§»é™¤ .show é¡åˆ¥)
            const isClosed = !container.classList.contains('show');
            
            if (isClosed) {
                container.classList.add('show');
                icon.style.transform = 'rotate(180deg)';
                icon.style.color = '#2563EB'; 
            } else {
                container.classList.remove('show');
                icon.style.transform = 'rotate(0deg)';
                icon.style.color = '#6B7280';
            }
        }
    // [æ–°å¢] åœ–ç‰‡é è¦½å…¨åŸŸè®Šæ•¸
    let pendingImageBase64 = null;

    // [æ–°å¢] é—œé–‰åœ–ç‰‡é è¦½
    function cancelImagePreview() {
        document.getElementById('img-preview-modal').style.display = 'none';
        pendingImageBase64 = null;
    }

    // [æ–°å¢] ç¢ºèªç™¼é€åœ–ç‰‡ (åŸæœ¬çš„é‚è¼¯ç§»åˆ°é€™è£¡)
    async function confirmImageAnalysis() {
        if (!pendingImageBase64) return;
        
        // [ä¿®æ­£] 1. ç§»é™¤é€™è£¡çš„ cancelImagePreview();
        // ä¸è¦åœ¨ä¸€é–‹å§‹å°±æ¸…é™¤è³‡æ–™ï¼
        
        // 2. å…ˆæŠŠè¦–çª—éš±è—èµ·ä¾†å°±å¥½ (è¦–è¦ºä¸Šé—œé–‰ï¼Œä½†ä¸è¦æ¸…ç©ºè®Šæ•¸)
        document.getElementById('img-preview-modal').style.display = 'none';

        showLoading();

        try {
            // 3. åœ¨èŠå¤©å®¤é¡¯ç¤ºåœ–ç‰‡
            // [ä¿®æ”¹] åŠ å…¥ onclick äº‹ä»¶èˆ‡ cursor:zoom-in æ¨£å¼
            const imgHtml = `<img src="data:image/jpeg;base64,${pendingImageBase64}" onclick="openLightbox(this.src)" style="max-width:100%; border-radius:10px; border:1px solid #ccc; margin-top:5px; cursor:zoom-in;">`;
            appendMessage('user', imgHtml);

            // è®€å–ä½ç½®
            let curLoc = ""; 
            if (window.appCache && window.appCache['my_location_combined']) {
                curLoc = window.appCache['my_location_combined'].data.city;
            }

            // è¨­å®š Prompt
            const visionPrompt = `
                ${systemPrompt}
                ã€ä½¿ç”¨è€…å‚³é€äº†ä¸€å¼µåœ–ç‰‡ã€‘
                ã€ä½¿ç”¨è€…ç›®å‰ä½ç½®ã€‘ï¼š${curLoc}
                ä»»å‹™ï¼šè«‹æ“”ä»»å°ˆæ¥­å°éŠèˆ‡è³¼ç‰©åŠ©æ‰‹ã€‚
                è«‹åˆ¤æ–·åœ–ç‰‡å…§å®¹ä¸¦æä¾›å”åŠ©ï¼š
                1. è‹¥æ˜¯å•†å“/è—¥å¦/é›¶é£Ÿï¼šèªªæ˜é€™æ˜¯ä»€éº¼ (åç¨±èˆ‡åŠŸæ•ˆ)ï¼Œä¸¦æ¨è–¦åœ¨ã€Œ${curLoc}ã€å“ªè£¡è²·å¾—åˆ°ã€‚
                2. è‹¥æ˜¯èœå–®ï¼šç¿»è­¯èœåä¸¦æ¨è–¦å¿…åƒã€‚
                3. è‹¥æ˜¯æ™¯é»/è·¯ç‰Œï¼šå‘Šè¨´æˆ‘é€™åœ¨å“ªè£¡ã€‚
                è«‹ç”¨ç°¡æ½”ã€åƒæœ‹å‹èˆ¬çš„å£å»å›ç­”ã€‚
            `;
            
            // 4. ç™¼é€ API (é€™æ™‚å€™ pendingImageBase64 é‚„æœ‰å€¼ï¼Œæ‰€ä»¥æœƒæˆåŠŸ)
            const responseText = await getGeminiResponse(visionPrompt, pendingImageBase64);
            
            removeLoading();
            const formattedText = responseText.replace(/\n/g, '<br>');
            appendMessage('ai', formattedText, false);

        } catch (e) {
            removeLoading();
            appendMessage('ai', `<span style="color:red">åœ–ç‰‡è¾¨è­˜å¤±æ•—ï¼š${e.message}</span>`);
        } finally {
            // [ä¿®æ­£] 5. ç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œæœ€å¾Œæ‰çœŸæ­£æ¸…ç©ºè®Šæ•¸
            pendingImageBase64 = null;
        }
    }
    async function handleImageSelect(event) {
        const file = event.target.files[0];
        if (!file) return;

        // 1. å£“ç¸®åœ–ç‰‡ (ä½†å…ˆä¸ç™¼é€)
        // ç‚ºäº†é è¦½æµæš¢ï¼Œé€™è£¡å…ˆåšå£“ç¸®ï¼Œå¦‚æœæª”æ¡ˆå¤ªå¤§æœƒåœ¨é€™è£¡è™•ç†æ‰
        try {
            pendingImageBase64 = await compressImage(file, 800, 0.7);
            
            // 2. é¡¯ç¤ºé è¦½å½ˆçª—
            const previewImg = document.getElementById('img-preview-content');
            previewImg.src = `data:image/jpeg;base64,${pendingImageBase64}`;
            
            document.getElementById('img-preview-modal').style.display = 'flex';
            
        } catch (e) {
            alert("åœ–ç‰‡è™•ç†å¤±æ•—ï¼Œè«‹é‡è©¦");
            console.error(e);
        }
        
        // 3. æ¸…ç©º inputï¼Œç¢ºä¿ä¸‹æ¬¡é¸åŒä¸€å¼µåœ–ä¹Ÿèƒ½è§¸ç™¼ change äº‹ä»¶
        event.target.value = '';
    }

// ğŸŸ¢ æ­£ç¢ºä½ç½®ï¼šå£“ç¸®å‡½å¼ä¹Ÿä¸€èµ·ç§»å‡ºä¾†
function compressImage(file, maxWidth, quality) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (e) => {
            const img = new Image();
            img.src = e.target.result;
            img.onload = () => {
                let w = img.width;
                let h = img.height;
                if (w > maxWidth) {
                    h = Math.round(h * (maxWidth / w));
                    w = maxWidth;
                }
                const canvas = document.createElement('canvas');
                canvas.width = w;
                canvas.height = h;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, w, h);
                const dataUrl = canvas.toDataURL('image/jpeg', quality);
                const base64 = dataUrl.split(',')[1];
                resolve(base64);
            };
            img.onerror = (err) => reject(err);
        };
        reader.onerror = (err) => reject(err);
    });
}
        document.addEventListener('DOMContentLoaded', () => {
        // [æ–°å¢] åœ–ç‰‡è™•ç†èˆ‡å£“ç¸®é‚è¼¯
        
            // --- æ™ºæ…§è‡ªå‹•å±•é–‹é‚è¼¯é–‹å§‹ ---
            
            // 1. å®šç¾©æ—¥æœŸèˆ‡è¡Œç¨‹ ID çš„å°æ‡‰è¡¨
            const scheduleMap = {
                '2026-01-25': 'd1',
                '2026-01-26': 'd2',
                '2026-01-27': 'd3',
                '2026-01-28': 'd4',
                '2026-01-29': 'd5',
                '2026-01-30': 'd6'
            };

            // 2. å–å¾—ä»Šæ—¥æ—¥æœŸ (æ ¼å¼ YYYY-MM-DD)
            const now = new Date();
            // â˜… æ¸¬è©¦ç”¨ï¼šè‹¥æƒ³ç¾åœ¨æ¸¬è©¦ã€Œæ—…é€”ä¸­ã€çš„æ•ˆæœï¼Œè«‹å–æ¶ˆä¸‹è¡Œè¨»è§£ä¸¦ä¿®æ”¹æ—¥æœŸ
             //const now = new Date('2026-01-28'); 

            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const todayStr = `${year}-${month}-${day}`;

            // 3. å–å¾— DOM å…ƒç´ 
            const checklistContainer = document.getElementById('checklist-container');
            const checklistIcon = document.querySelector('.checklist-card-header .toggle-icon');

            // 4. åŸ·è¡Œåˆ¤æ–·
            if (todayStr < '2026-01-25') {
                // ã€æƒ…å¢ƒ Aï¼šè¡Œå‰æº–å‚™æœŸã€‘(ç¾åœ¨ ~ 1/24)
                // å‹•ä½œï¼šè‡ªå‹•å±•é–‹ Checklistï¼Œæ”¶åˆæ‰€æœ‰è¡Œç¨‹
                
                if (checklistContainer) {
                    checklistContainer.classList.add('show');
                    if(checklistIcon) {
                        checklistIcon.style.transform = 'rotate(180deg)';
                        checklistIcon.style.color = '#2563EB'; // è—è‰²ç®­é ­è¡¨ç¤ºå±•é–‹
                    }
                }
                // é è¨­è¼‰å…¥ Day 1 å¤©æ°£è³‡è¨Šä¾›åƒè€ƒ
                updateWeatherWidget('d1');

            } else if (scheduleMap[todayStr]) {
                // ã€æƒ…å¢ƒ Bï¼šæ—…é€”ä¸­ã€‘(1/25 ~ 1/30)
                // å‹•ä½œï¼šChecklist ä¿æŒé—œé–‰ï¼Œè‡ªå‹•å±•é–‹ã€Œç•¶å¤©ã€çš„è¡Œç¨‹
                
                const targetDayId = scheduleMap[todayStr];
                const dayTimeline = document.getElementById(targetDayId);
                const dayToggle = document.getElementById('toggle-' + targetDayId);
                const dayIcon = dayToggle ? dayToggle.querySelector('.toggle-icon') : null;

                if (dayTimeline && dayToggle) {
                    // å±•é–‹è©²æ—¥è¡Œç¨‹
                    dayTimeline.classList.add('show');
                    dayToggle.classList.add('open'); // è®“å·¦é‚Šæ¡†è®Šè‰²
                    if (dayIcon) {
                         // é€™è£¡æ‚¨ä½¿ç”¨ div ç®­é ­ï¼Œæˆ‘å€‘é€é CSS class æ§åˆ¶æ—‹è½‰ï¼Œæˆ–è€…ç›´æ¥ç”¨ style
                         // æ‚¨çš„ CSS .day-toggle.open .toggle-icon å·²ç¶“æœ‰è¨­å®š transformï¼Œæ‰€ä»¥åŠ ä¸Š open é¡åˆ¥å³å¯
                    }
                    
                    // æ›´æ–° Header å¤©æ°£ç‚ºã€Œç•¶å¤©ã€çš„åœ°é»
                    updateWeatherWidget(targetDayId);

                    // (é¸ç”¨) è‡ªå‹•æ²å‹•åˆ°ç•¶æ—¥è¡Œç¨‹ï¼Œæå‡é«”é©—
                    setTimeout(() => {
                        dayToggle.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 500);
                }
            } else {
                // ã€æƒ…å¢ƒ Cï¼šæ—…ç¨‹çµæŸã€‘
                // å…¨éƒ¨æ”¶åˆï¼Œæˆ–è¦–éœ€æ±‚é¡¯ç¤º
                updateWeatherWidget('d1'); // é è¨­å›é¡¯ D1
            }
            
            // --- æ™ºæ…§è‡ªå‹•å±•é–‹é‚è¼¯çµæŸ ---

            initAiChat();
            setupVoiceButton(); // Init voice listener
            getLocalWeather(); // Fetch local weather on load
            initChecklist(); // Init checklist
            // [ä¿®æ­£] 1:1 æŒ‡éš¨å¿ƒå‹•ç‰©ç†ç¿»é å¼•æ“ (Physics Page Flip)
            let isDragging = false;
            let startX = 0;
            let startY = 0; // [æ–°å¢] å‚ç›´èµ·é»ï¼Œç”¨ä¾†åˆ¤æ–·æ˜¯å¦ç‚ºæ²å‹•
            let currentTranslate = 0;
            let activeContainer = null;
            let navItems = [];
            let activeIndex = 0;

            // 1. æ‰‹æŒ‡æŒ‰ä¸‹ï¼šé–å®šç›®æ¨™ï¼Œæº–å‚™æ‹–æ›³
            document.addEventListener('touchstart', (e) => {
                const active = document.querySelector('.container.active');
                if (!active || active.classList.contains('is-animating')) return;

                // [ä¿®æ­£] æ”¹ç‚ºã€Œæ½›åœ¨æ‹–æ›³ä¸­ã€ï¼Œå…ˆä¸é–æ­»ï¼Œç­‰ç§»å‹•åˆ¤æ–·æ–¹å‘å¾Œå†æ±ºå®š
                isDragging = true; 
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY; // [æ–°å¢] ç´€éŒ„å‚ç›´ä½ç½®
                activeContainer = active;
                
                navItems = Array.from(document.querySelectorAll('.nav-item'));
                const activeNavItem = document.querySelector('.nav-item.active');
                activeIndex = navItems.indexOf(activeNavItem);
            }, {passive: false});

            // 2. æ‰‹æŒ‡ç§»å‹•ï¼šè¨ˆç®—ç‰©ç†é‡ï¼Œå³æ™‚æ›´æ–°ç•«é¢
            document.addEventListener('touchmove', (e) => {
                if (!isDragging || !activeContainer) return;

                const currentX = e.touches[0].clientX;
                const currentY = e.touches[0].clientY;
                const diffX = currentX - startX;
                const diffY = currentY - startY;

                // å„ªå…ˆåˆ¤æ–·æ²å‹•ï¼šå¦‚æœå‚ç›´ç§»å‹• > æ°´å¹³ç§»å‹•ï¼Œè¦–ç‚ºæ²å‹•ç¶²é 
                if (Math.abs(diffY) > Math.abs(diffX)) {
                    isDragging = false;
                    activeContainer.classList.remove('is-dragging'); 
                    return; 
                }

                // ç¢ºå®šæ˜¯æ°´å¹³æ»‘å‹•
                activeContainer.classList.add('is-dragging');
                if (e.cancelable) e.preventDefault(); 

                // â˜… [ä¿®æ”¹] æ ¸å¿ƒç‰©ç†å…¬å¼ï¼šæ”¹ç‚º 2D å¹³ç§» (TranslateX)
                // ä½¿ç”¨ translate3d ç¢ºä¿å•Ÿç”¨ GPU åŠ é€Ÿ
                activeContainer.style.transform = `translate3d(${diffX}px, 0, 0)`;
                
                // ğŸ’¡ [é¸ç”¨] æ ¹æ“šæ»‘å‹•è·é›¢å¾®èª¿é€æ˜åº¦ (æ¨¡æ“¬æ‚¨æä¾›çš„ opacity: 0 æ•ˆæœ)
                // æ»‘å‹•è¶Šé ï¼Œé€æ˜åº¦è¶Šä½ (æœ€å¤šé™åˆ° 0.8ï¼Œä¿ç•™ä¸€é»å¯è¦‹åº¦ä»¥å…ä½¿ç”¨è€…è¿·å¤±)
                const opacity = 1 - (Math.abs(diffX) / window.innerWidth) * 0.5;
                activeContainer.style.opacity = opacity;
                activeContainer.style.filter = ''; // ç§»é™¤èˆŠçš„äº®åº¦æ¿¾é¡ï¼Œä¿æŒä¹¾æ·¨
                
                currentTranslate = diffX;
            }, {passive: false});

            
            // 3. æ‰‹æŒ‡æ”¾é–‹ï¼šåˆ¤æ–·æ˜¯ã€Œç¿»éå»ã€é‚„æ˜¯ã€Œå½ˆå›ä¾†ã€
            document.addEventListener('touchend', (e) => {
                if (!isDragging || !activeContainer) return;
                isDragging = false;
                
                // ç§»é™¤æ‹–æ›³ç‹€æ…‹ï¼ŒåŠ å…¥å‹•ç•«ç‹€æ…‹ (è®“ CSS æ¥æ‰‹å‰©ä¸‹çš„å‹•ä½œ)
                activeContainer.classList.remove('is-dragging');
                activeContainer.classList.add('is-animating');

                const threshold = 80; // æ»‘å‹•è¶…é 80px å°±è¦–ç‚ºè¦ç¿»é 
                
                // A. æ±ºå®šç¿»é  (æ»‘å‹•è·é›¢è¶³å¤ )
               // A. æ±ºå®šç¿»é  (æ»‘å‹•è·é›¢è¶³å¤ )
                if (Math.abs(currentTranslate) > threshold) {
                    const direction = currentTranslate > 0 ? 'prev' : 'next';
                    let targetIndex;

                    // [ä¿®æ­£] å¾ªç’°é‚è¼¯ï¼šä½¿ç”¨é¤˜æ•¸é‹ç®—ä¾†å¯¦ç¾ç„¡é™å¾ªç’°
                    if (direction === 'next') {
                        // å¾€å³ç¿» (ä¸‹ä¸€é ): å¦‚æœæ˜¯æœ€å¾Œä¸€é ï¼Œæœƒå›åˆ° 0
                        targetIndex = (activeIndex + 1) % navItems.length;
                    } else {
                        // å¾€å·¦ç¿» (ä¸Šä¸€é ): å¦‚æœæ˜¯ç¬¬ 0 é ï¼Œæœƒå›åˆ°æœ€å¾Œä¸€é 
                        targetIndex = (activeIndex - 1 + navItems.length) % navItems.length;
                    }

                    finishFlip(activeContainer, direction, navItems[targetIndex]);
                }
                // B. å–æ¶ˆç¿»é  (æ»‘å‹•è·é›¢ä¸å¤ ï¼Œå½ˆå›ä¾†)
                else {
                    revertFlip(activeContainer);
                }
                
                currentTranslate = 0;
            });

            // è¼”åŠ©ï¼šå½ˆå›åŸä½ (Revert)
            function revertFlip(element) {
                // å›åˆ°ä¸­å¿ƒ (x: 0)
                element.style.transform = 'translate3d(0, 0, 0)';
                element.style.opacity = '1';
                
                setTimeout(() => {
                    element.classList.remove('is-animating');
                    element.style.transform = '';
                    element.style.opacity = '';
                }, 250); // å°æ‡‰ CSS çš„ 0.25s
            }

            // è¼”åŠ©ï¼šå®Œæˆç¿»é å‹•ä½œ (Slide Out & Slide In)
            function finishFlip(oldElement, direction, nextNavItem) {
                const screenW = window.innerWidth;
                
                // 1. èˆŠé é¢æ»‘å‡ºå» (Slide Exit)
                // å¾€å·¦æ»‘(Next) -> èˆŠé é¢å» -100%ï¼Œå¾€å³æ»‘(Prev) -> èˆŠé é¢å» 100%
                const targetX = direction === 'next' ? -screenW : screenW;
                
                oldElement.style.transform = `translate3d(${targetX}px, 0, 0)`;
                oldElement.style.opacity = '0'; // æ»‘å‡ºæ™‚æ·¡å‡º

                // 2. ç­‰èˆŠé é¢æ»‘å‡ºå»å¾Œï¼Œåˆ‡æ›å…§å®¹
                setTimeout(() => {
                    switchTab(nextNavItem); 
                    
                    const newTargetId = nextNavItem.getAttribute('data-target');
                    const newContainer = document.getElementById(newTargetId);
                    
                    // 3. æ–°é é¢æº–å‚™é€²å ´ (Slide Enter)
                    // å¦‚æœæ˜¯ Nextï¼Œæ–°é é¢å¾å³é‚Š(100%)é€²ä¾†ï¼›å¦‚æœæ˜¯ Prevï¼Œå¾å·¦é‚Š(-100%)é€²ä¾†
                    const startX = direction === 'next' ? screenW : -screenW;
                    
                    newContainer.classList.add('is-dragging'); // æš«æ™‚ç§»é™¤ transition ä»¥ä¾¿ç¬é–“å®šä½
                    newContainer.style.transform = `translate3d(${startX}px, 0, 0)`;
                    newContainer.style.opacity = '0';
                    
                    // å¼·åˆ¶ç€è¦½å™¨é‡ç¹ª (Reflow) ç¢ºä¿å®šä½ç”Ÿæ•ˆ
                    void newContainer.offsetWidth;

                    // 4. åŸ·è¡Œé€²å ´å‹•ç•« (Go to Center)
                    newContainer.classList.remove('is-dragging');
                    newContainer.classList.add('is-animating');
                    newContainer.style.transform = 'translate3d(0, 0, 0)';
                    newContainer.style.opacity = '1';

                    // æ¸…ç†èˆŠå…ƒç´ 
                    oldElement.classList.remove('is-animating');
                    oldElement.style.transform = '';
                    oldElement.style.opacity = '';

                    // æ¸…ç†æ–°å…ƒç´ 
                    setTimeout(() => {
                        newContainer.classList.remove('is-animating');
                        newContainer.style.transform = '';
                    }, 250); // å°æ‡‰ CSS çš„ 0.25s

                }, 200); // ç¨å¾®ææ—©ä¸€é»åˆ‡æ›ï¼Œè®“éŠœæ¥æ›´ç·Šå¯†
            }
        });
        // [å‡ç´šç‰ˆ] åœ–ç‰‡æ”¾å¤§ç‡ˆç®±æ§åˆ¶å‡½å¼ (å«ç¸®æ”¾èˆ‡æ‹–æ›³åŠŸèƒ½)
            let lbState = {
                scale: 1,
                panning: false,
                pointX: 0, pointY: 0, // ç•¶å‰åº§æ¨™
                startX: 0, startY: 0, // æ‹–æ›³èµ·å§‹é»
                lastX: 0, lastY: 0,   // ä¸Šä¸€æ¬¡çµæŸé»
                initialDist: 0        // é›™æŒ‡åˆå§‹è·é›¢
            };

            const lbImg = document.getElementById('lightbox-img');
            const lbModal = document.getElementById('lightbox-modal');

            // 1. é–‹å•Ÿç‡ˆç®±
            window.openLightbox = function(src) {
                if(!lbImg || !lbModal) return;
                
                lbImg.src = src;
                lbModal.style.display = 'flex';
                
                // é‡ç½®ç‹€æ…‹
                resetLightbox();
                
                // é˜»æ“‹åœ–ç‰‡é»æ“Šå†’æ³¡ (é¿å…é»åœ–ç‰‡æ™‚é—œé–‰ç‡ˆç®±)
                lbImg.onclick = (e) => e.stopPropagation();
                
                // åŠ å…¥äº‹ä»¶ç›£è½
                addLightboxListeners();
            }

            // 2. é—œé–‰ç‡ˆç®±
            window.closeLightbox = function(e) {
                // åªæœ‰é»æ“ŠèƒŒæ™¯(é®ç½©)æˆ–é—œé–‰æŒ‰éˆ•æ™‚æ‰é—œé–‰
                // (å› ç‚º img å·²ç¶“é˜»æ“‹å†’æ³¡ï¼Œé€™è£¡é€šå¸¸æ˜¯é»åˆ° overlay)
                if (e && e.target !== lbModal && !e.target.classList.contains('lightbox-close')) return;

                lbModal.style.display = 'none';
                removeLightboxListeners();
            }

            function resetLightbox() {
                lbState = { scale: 1, panning: false, pointX: 0, pointY: 0, startX: 0, startY: 0, lastX: 0, lastY: 0, initialDist: 0 };
                updateTransform();
            }

            function updateTransform() {
                // é™åˆ¶ç¸®å°ä¸èƒ½å°æ–¼ 1 (åŸå°ºå¯¸)
                if (lbState.scale < 1) lbState.scale = 1;
                lbImg.style.transform = `translate(${lbState.pointX}px, ${lbState.pointY}px) scale(${lbState.scale})`;
            }

            // --- äº‹ä»¶è™•ç†å€ ---

            function addLightboxListeners() {
                // é›»è…¦ç‰ˆï¼šæ»¾è¼ªç¸®æ”¾
                lbImg.addEventListener('wheel', handleWheel, { passive: false });
                // é›»è…¦ç‰ˆï¼šæ‹–æ›³
                lbImg.addEventListener('mousedown', handleMouseDown);
                
                // æ‰‹æ©Ÿç‰ˆï¼šè§¸æ§
                lbImg.addEventListener('touchstart', handleTouchStart, { passive: false });
                lbImg.addEventListener('touchmove', handleTouchMove, { passive: false });
                lbImg.addEventListener('touchend', handleTouchEnd);
            }

            function removeLightboxListeners() {
                lbImg.removeEventListener('wheel', handleWheel);
                lbImg.removeEventListener('mousedown', handleMouseDown);
                window.removeEventListener('mousemove', handleMouseMove);
                window.removeEventListener('mouseup', handleMouseUp);
                lbImg.removeEventListener('touchstart', handleTouchStart);
                lbImg.removeEventListener('touchmove', handleTouchMove);
                lbImg.removeEventListener('touchend', handleTouchEnd);
            }

            // [é›»è…¦] æ»¾è¼ªç¸®æ”¾
            function handleWheel(e) {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -0.2 : 0.2;
                lbState.scale += delta;
                updateTransform();
            }

            // [é›»è…¦] æ»‘é¼ æ‹–æ›³
            function handleMouseDown(e) {
                if (lbState.scale <= 1) return; // æ²’æ”¾å¤§æ™‚ä¸çµ¦æ‹–
                e.preventDefault();
                lbState.startX = e.clientX - lbState.pointX;
                lbState.startY = e.clientY - lbState.pointY;
                lbState.panning = true;
                
                window.addEventListener('mousemove', handleMouseMove);
                window.addEventListener('mouseup', handleMouseUp);
            }

            function handleMouseMove(e) {
                if (!lbState.panning) return;
                e.preventDefault();
                lbState.pointX = e.clientX - lbState.startX;
                lbState.pointY = e.clientY - lbState.startY;
                updateTransform();
            }

            function handleMouseUp() {
                lbState.panning = false;
                window.removeEventListener('mousemove', handleMouseMove);
                window.removeEventListener('mouseup', handleMouseUp);
            }

            // [æ‰‹æ©Ÿ] è§¸æ§è™•ç† (å–®æŒ‡æ‹–æ›³ / é›™æŒ‡ç¸®æ”¾)
            function handleTouchStart(e) {
                if (e.touches.length === 2) {
                    // é›™æŒ‡ï¼šé–‹å§‹ç¸®æ”¾
                    e.preventDefault(); // é˜²æ­¢èƒŒæ™¯æ²å‹•
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    lbState.initialDist = Math.hypot(touch1.pageX - touch2.pageX, touch1.pageY - touch2.pageY);
                    lbState.lastScale = lbState.scale;
                } else if (e.touches.length === 1 && lbState.scale > 1) {
                    // å–®æŒ‡ä¸”å·²æ”¾å¤§ï¼šé–‹å§‹æ‹–æ›³
                    const touch = e.touches[0];
                    lbState.startX = touch.pageX - lbState.pointX;
                    lbState.startY = touch.pageY - lbState.pointY;
                    lbState.panning = true;
                }
            }

            function handleTouchMove(e) {
                if (e.touches.length === 2) {
                    // é›™æŒ‡ç¸®æ”¾ä¸­
                    e.preventDefault();
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    const dist = Math.hypot(touch1.pageX - touch2.pageX, touch1.pageY - touch2.pageY);
                    
                    // è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹
                    const delta = dist / lbState.initialDist;
                    lbState.scale = lbState.lastScale * delta;
                    updateTransform();
                } else if (e.touches.length === 1 && lbState.panning) {
                    // å–®æŒ‡æ‹–æ›³ä¸­
                    e.preventDefault(); // é˜²æ­¢èƒŒæ™¯æ²å‹•
                    const touch = e.touches[0];
                    lbState.pointX = touch.pageX - lbState.startX;
                    lbState.pointY = touch.pageY - lbState.startY;
                    updateTransform();
                }
            }

            function handleTouchEnd(e) {
                lbState.panning = false;
                if (e.touches.length < 2) {
                    lbState.initialDist = 0;
                }
            }
            // [æ–°å¢] è¤‡è£½æ–‡å­—åŠŸèƒ½ (å«å›é¥‹å‹•ç•«)
    function copyText(btn, text) {
        if (!navigator.clipboard) {
            // å‚™æ¡ˆï¼šè‹¥ç€è¦½å™¨ä¸æ”¯æ´ Clipboard API (è¼ƒèˆŠçš„å®‰å“ Webview)
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("Copy");
            document.body.removeChild(textArea);
            showCopyFeedback(btn);
            return;
        }

        navigator.clipboard.writeText(text).then(() => {
            showCopyFeedback(btn);
        }).catch(err => {
            console.error('è¤‡è£½å¤±æ•—', err);
            alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
        });
    }

    function showCopyFeedback(btn) {
        const originalHtml = btn.innerHTML;
        // è®Šæ›´ç‚ºç¶ è‰²å‹¾å‹¾
        btn.innerHTML = `<svg class="icon-mini" style="width:12px;height:12px;"><path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> å·²è¤‡è£½`;
        btn.classList.add('copied');
        
        // 2ç§’å¾Œå¾©åŸ
        setTimeout(() => {
            btn.innerHTML = originalHtml;
            btn.classList.remove('copied');
        }, 2000);
    }
    // --- PWA Service Worker Registration ---
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./service-worker.js')
                        .then(reg => console.log('PWA Service Worker registered!', reg))
                        .catch(err => console.log('PWA registration failed:', err));
                });
            }

    </script>
    </div>
</body>
</html>